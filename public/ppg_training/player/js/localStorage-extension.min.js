(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{1326:function(e,a,t){"use strict";const{registerReducer:o,registerEpics:r}=t(4),S=t(2266),{localStorageSetupEpic:l,localStorageLoadSessionEpic:n,localStorageSaveSessionEpic:s,localStorageClearSessionEpic:c,localStorageComponentCompleteEpic:i,localStorageBookmarkingCancelEpic:E,localStorageHandleResetsEpic:O,localStorageLogicStateChangeEpic:p}=t(2267);o("_localStorage",S),r(l,n,s,c,i,E,O,p)},1599:function(e,a,t){"use strict";a.LOCALSTORAGE_LOAD_SESSION="LOCALSTORAGE_LOAD_SESSION",a.LOCALSTORAGE_SAVE_SESSION="LOCALSTORAGE_SAVE_SESSION",a.LOCALSTORAGE_CLEAR_SESSION="LOCALSTORAGE_CLEAR_SESSION",a.LOCALSTORAGE_SESSION_CHANGE="LOCALSTORAGE_SESSION_CHANGE",a.localStorageLoadSession=()=>({type:a.LOCALSTORAGE_LOAD_SESSION}),a.localStorageSaveSession=e=>({type:a.LOCALSTORAGE_SAVE_SESSION,payload:e}),a.localStorageClearSession=()=>({type:a.LOCALSTORAGE_CLEAR_SESSION}),a.localStorageSessionChange=e=>({type:a.LOCALSTORAGE_SESSION_CHANGE,payload:e})},2266:function(e,a,t){"use strict";const o=t(10),{SETUP_DATA:r}=t(9),S={_isEnabled:!1,session:{}},{LOCALSTORAGE_SESSION_CHANGE:l}=t(1599);e.exports=(e=S,a)=>{if(a.type===r){const t=a.payload.course._localStorage;return t&&t._isEnabled?o({},e,t):S}if(!e._isEnabled)return S;switch(a.type){case l:return o({},e,{session:a.payload});default:return e}}},2267:function(e,a,t){"use strict";var o=t(5);const r=t(57),S=t(39),l=t(18),n=t(10),s=t(304),{DATA_READY:c,setAppReadyState:i,resetCourse:E}=t(9),{COMPONENT_COMPLETED:O,COMPONENT_TRACKABLE_CHANGE:p}=t(61),{LOGIC_STATE_CHANGE:g}=t(50),{getTracking:_,setTracking:A,restoreComponentAttributes:L}=t(487),{LOCALSTORAGE_LOAD_SESSION:C,LOCALSTORAGE_SAVE_SESSION:u,LOCALSTORAGE_CLEAR_SESSION:R,localStorageLoadSession:d,localStorageSaveSession:b,localStorageClearSession:T,localStorageSessionChange:f}=t(1599);function v(e){try{null!==localStorage.getItem(e)&&localStorage.removeItem(e)}catch(e){console.warn("Localstorage not available for saving learning data",e)}}a.localStorageSetupEpic=(e,a)=>e.filter(e=>{if(e.type!==c)return!1;const{app:t,course:o}=a.getState(),r=o._localStorage;return!t.isLivePreview&&r&&r._isEnabled}).mergeMap(()=>o.Observable.concat(o.Observable.of(i("localStorage",!1)),o.Observable.of(d()),o.Observable.of(i("localStorage",!0)))),a.localStorageLoadSessionEpic=(e,a)=>e.ofType(C).mergeMap(()=>{const{course:e,scorm:t,components:r}=a.getState(),s=t&&t._isEnabled;let c;try{c=localStorage.getItem(e._id)}catch(e){return console.warn("Localstorage not available for saving learning componentData",e)}if(c){if(c=JSON.parse(c),c.useAdvancedTracking)return o.Observable.concat(A(c,!0),f(c));const e=function(e,a,t){return S(e).keys().map(o=>{const r=e[o],S=l(a.components,{_id:o});return t&&r._isComplete||!t?n({},r,S):r}).keyBy("_id").value()}(r,c,s);return L(e),o.Observable.of(f(c))}return o.Observable.empty()}).catch(e=>o.Observable.of({type:"LOCALSTORAGE_ERROR",payload:e})),a.localStorageSaveSessionEpic=(e,a)=>e.ofType(u).map(e=>{const t=function(e,a){const{course:t}=e;return _(e=>{const o=s({},e,{useAdvancedTracking:!0,lastCompletedComponentId:a||""});try{localStorage.setItem(t._id,JSON.stringify(o))}catch(e){console.warn("Localstorage not available for saving learning componentData",e)}return o})}(a.getState(),e.payload);return f(t)}).catch(e=>o.Observable.of({type:"LOCALSTORAGE_ERROR",payload:e})),a.localStorageClearSessionEpic=(e,a)=>e.ofType(R).map(()=>{const{course:e}=a.getState();return v(e._id),f({})}).catch(e=>o.Observable.of({type:"LOCALSTORAGE_ERROR",payload:e})),a.localStorageHandleResetsEpic=(e,a)=>e.filter(e=>{if(!r(["COURSE_ASSESSMENT_COMPONENTS_RESET","ACHIEVEMENTS_RESET_COURSE"],e.type))return!1;const{app:t,course:o}=a.getState(),S=o._localStorage;return!t.isLivePreview&&S&&S._isEnabled}).map(()=>{const{course:e}=a.getState();return v(e._id),f({})}).catch(e=>o.Observable.of({type:"LOCALSTORAGE_ERROR",payload:e})),a.localStorageComponentCompleteEpic=(e,a)=>e.filter(e=>{if(!r([O,p],e.type))return!1;const{app:t,_localStorage:o}=a.getState();return!t.isLivePreview&&o&&o._isEnabled}).map(e=>b(e.payload.componentId)),a.localStorageLogicStateChangeEpic=(e,a)=>e.filter(e=>{if(e.type!==g)return!1;const{app:t,_localStorage:o}=a.getState();return!t.isLivePreview&&o&&o._isEnabled}).map(()=>b()),a.localStorageBookmarkingCancelEpic=(e,a)=>e.filter(e=>{if("BOOKMARKING_CANCEL_CONTINUE"!==e.type)return!1;const{app:t,scorm:o,_localStorage:r}=a.getState();return(!o||!o._isEnabled)&&(!t.isLivePreview&&r&&r._isEnabled&&r._shouldResetUsingBookMarking)}).mergeMap(()=>o.Observable.concat(o.Observable.of(T()),o.Observable.of(E())))}}]);