var CryptoJS = CryptoJS || function (t, e) { var n = {}, i = n.lib = {}, r = function () { }, o = i.Base = { extend: function (t) { r.prototype = this; var e = new r; return t && e.mixIn(t), e.hasOwnProperty("init") || (e.init = function () { e.$super.init.apply(this, arguments) }), e.init.prototype = e, e.$super = this, e }, create: function () { var t = this.extend(); return t.init.apply(t, arguments), t }, init: function () { }, mixIn: function (t) { for (var e in t) t.hasOwnProperty(e) && (this[e] = t[e]); t.hasOwnProperty("toString") && (this.toString = t.toString) }, clone: function () { return this.init.prototype.extend(this) } }, a = i.WordArray = o.extend({ init: function (t, e) { t = this.words = t || [], this.sigBytes = null != e ? e : 4 * t.length }, toString: function (t) { return (t || l).stringify(this) }, concat: function (t) { var e = this.words, n = t.words, i = this.sigBytes; if (t = t.sigBytes, this.clamp(), i % 4) for (var r = 0; r < t; r++)e[i + r >>> 2] |= (n[r >>> 2] >>> 24 - r % 4 * 8 & 255) << 24 - (i + r) % 4 * 8; else if (65535 < n.length) for (r = 0; r < t; r += 4)e[i + r >>> 2] = n[r >>> 2]; else e.push.apply(e, n); return this.sigBytes += t, this }, clamp: function () { var e = this.words, n = this.sigBytes; e[n >>> 2] &= 4294967295 << 32 - n % 4 * 8, e.length = t.ceil(n / 4) }, clone: function () { var t = o.clone.call(this); return t.words = this.words.slice(0), t }, random: function (e) { for (var n = [], i = 0; i < e; i += 4)n.push(4294967296 * t.random() | 0); return new a.init(n, e) } }), s = n.enc = {}, l = s.Hex = { stringify: function (t) { var e = t.words; t = t.sigBytes; for (var n = [], i = 0; i < t; i++) { var r = e[i >>> 2] >>> 24 - i % 4 * 8 & 255; n.push((r >>> 4).toString(16)), n.push((15 & r).toString(16)) } return n.join("") }, parse: function (t) { for (var e = t.length, n = [], i = 0; i < e; i += 2)n[i >>> 3] |= parseInt(t.substr(i, 2), 16) << 24 - i % 8 * 4; return new a.init(n, e / 2) } }, c = s.Latin1 = { stringify: function (t) { var e = t.words; t = t.sigBytes; for (var n = [], i = 0; i < t; i++)n.push(String.fromCharCode(e[i >>> 2] >>> 24 - i % 4 * 8 & 255)); return n.join("") }, parse: function (t) { for (var e = t.length, n = [], i = 0; i < e; i++)n[i >>> 2] |= (255 & t.charCodeAt(i)) << 24 - i % 4 * 8; return new a.init(n, e) } }, u = s.Utf8 = { stringify: function (t) { try { return decodeURIComponent(escape(c.stringify(t))) } catch (t) { throw Error("Malformed UTF-8 data") } }, parse: function (t) { return c.parse(unescape(encodeURIComponent(t))) } }, h = i.BufferedBlockAlgorithm = o.extend({ reset: function () { this._data = new a.init, this._nDataBytes = 0 }, _append: function (t) { "string" == typeof t && (t = u.parse(t)), this._data.concat(t), this._nDataBytes += t.sigBytes }, _process: function (e) { var n = this._data, i = n.words, r = n.sigBytes, o = this.blockSize, s = r / (4 * o); if (e = (s = e ? t.ceil(s) : t.max((0 | s) - this._minBufferSize, 0)) * o, r = t.min(4 * e, r), e) { for (var l = 0; l < e; l += o)this._doProcessBlock(i, l); l = i.splice(0, e), n.sigBytes -= r } return new a.init(l, r) }, clone: function () { var t = o.clone.call(this); return t._data = this._data.clone(), t }, _minBufferSize: 0 }); i.Hasher = h.extend({ cfg: o.extend(), init: function (t) { this.cfg = this.cfg.extend(t), this.reset() }, reset: function () { h.reset.call(this), this._doReset() }, update: function (t) { return this._append(t), this._process(), this }, finalize: function (t) { return t && this._append(t), this._doFinalize() }, blockSize: 16, _createHelper: function (t) { return function (e, n) { return new t.init(n).finalize(e) } }, _createHmacHelper: function (t) { return function (e, n) { return new f.HMAC.init(t, n).finalize(e) } } }); var f = n.algo = {}; return n }(Math); !function () { var t = CryptoJS, e = (r = t.lib).WordArray, n = r.Hasher, i = [], r = t.algo.SHA1 = n.extend({ _doReset: function () { this._hash = new e.init([1732584193, 4023233417, 2562383102, 271733878, 3285377520]) }, _doProcessBlock: function (t, e) { for (var n = this._hash.words, r = n[0], o = n[1], a = n[2], s = n[3], l = n[4], c = 0; 80 > c; c++) { if (16 > c) i[c] = 0 | t[e + c]; else { var u = i[c - 3] ^ i[c - 8] ^ i[c - 14] ^ i[c - 16]; i[c] = u << 1 | u >>> 31 } u = (r << 5 | r >>> 27) + l + i[c], u = 20 > c ? u + (1518500249 + (o & a | ~o & s)) : 40 > c ? u + (1859775393 + (o ^ a ^ s)) : 60 > c ? u + ((o & a | o & s | a & s) - 1894007588) : u + ((o ^ a ^ s) - 899497514), l = s, s = a, a = o << 30 | o >>> 2, o = r, r = u } n[0] = n[0] + r | 0, n[1] = n[1] + o | 0, n[2] = n[2] + a | 0, n[3] = n[3] + s | 0, n[4] = n[4] + l | 0 }, _doFinalize: function () { var t = this._data, e = t.words, n = 8 * this._nDataBytes, i = 8 * t.sigBytes; return e[i >>> 5] |= 128 << 24 - i % 32, e[14 + (i + 64 >>> 9 << 4)] = Math.floor(n / 4294967296), e[15 + (i + 64 >>> 9 << 4)] = n, t.sigBytes = 4 * e.length, this._process(), this._hash }, clone: function () { var t = n.clone.call(this); return t._hash = this._hash.clone(), t } }); t.SHA1 = n._createHelper(r), t.HmacSHA1 = n._createHmacHelper(r) }(); var CryptoJS = CryptoJS || function (t, e) { var n = {}, i = n.lib = {}, r = function () { }, o = i.Base = { extend: function (t) { r.prototype = this; var e = new r; return t && e.mixIn(t), e.hasOwnProperty("init") || (e.init = function () { e.$super.init.apply(this, arguments) }), e.init.prototype = e, e.$super = this, e }, create: function () { var t = this.extend(); return t.init.apply(t, arguments), t }, init: function () { }, mixIn: function (t) { for (var e in t) t.hasOwnProperty(e) && (this[e] = t[e]); t.hasOwnProperty("toString") && (this.toString = t.toString) }, clone: function () { return this.init.prototype.extend(this) } }, a = i.WordArray = o.extend({ init: function (t, e) { t = this.words = t || [], this.sigBytes = null != e ? e : 4 * t.length }, toString: function (t) { return (t || l).stringify(this) }, concat: function (t) { var e = this.words, n = t.words, i = this.sigBytes; if (t = t.sigBytes, this.clamp(), i % 4) for (var r = 0; r < t; r++)e[i + r >>> 2] |= (n[r >>> 2] >>> 24 - r % 4 * 8 & 255) << 24 - (i + r) % 4 * 8; else if (65535 < n.length) for (r = 0; r < t; r += 4)e[i + r >>> 2] = n[r >>> 2]; else e.push.apply(e, n); return this.sigBytes += t, this }, clamp: function () { var e = this.words, n = this.sigBytes; e[n >>> 2] &= 4294967295 << 32 - n % 4 * 8, e.length = t.ceil(n / 4) }, clone: function () { var t = o.clone.call(this); return t.words = this.words.slice(0), t }, random: function (e) { for (var n = [], i = 0; i < e; i += 4)n.push(4294967296 * t.random() | 0); return new a.init(n, e) } }), s = n.enc = {}, l = s.Hex = { stringify: function (t) { var e = t.words; t = t.sigBytes; for (var n = [], i = 0; i < t; i++) { var r = e[i >>> 2] >>> 24 - i % 4 * 8 & 255; n.push((r >>> 4).toString(16)), n.push((15 & r).toString(16)) } return n.join("") }, parse: function (t) { for (var e = t.length, n = [], i = 0; i < e; i += 2)n[i >>> 3] |= parseInt(t.substr(i, 2), 16) << 24 - i % 8 * 4; return new a.init(n, e / 2) } }, c = s.Latin1 = { stringify: function (t) { var e = t.words; t = t.sigBytes; for (var n = [], i = 0; i < t; i++)n.push(String.fromCharCode(e[i >>> 2] >>> 24 - i % 4 * 8 & 255)); return n.join("") }, parse: function (t) { for (var e = t.length, n = [], i = 0; i < e; i++)n[i >>> 2] |= (255 & t.charCodeAt(i)) << 24 - i % 4 * 8; return new a.init(n, e) } }, u = s.Utf8 = { stringify: function (t) { try { return decodeURIComponent(escape(c.stringify(t))) } catch (t) { throw Error("Malformed UTF-8 data") } }, parse: function (t) { return c.parse(unescape(encodeURIComponent(t))) } }, h = i.BufferedBlockAlgorithm = o.extend({ reset: function () { this._data = new a.init, this._nDataBytes = 0 }, _append: function (t) { "string" == typeof t && (t = u.parse(t)), this._data.concat(t), this._nDataBytes += t.sigBytes }, _process: function (e) { var n = this._data, i = n.words, r = n.sigBytes, o = this.blockSize, s = r / (4 * o); if (e = (s = e ? t.ceil(s) : t.max((0 | s) - this._minBufferSize, 0)) * o, r = t.min(4 * e, r), e) { for (var l = 0; l < e; l += o)this._doProcessBlock(i, l); l = i.splice(0, e), n.sigBytes -= r } return new a.init(l, r) }, clone: function () { var t = o.clone.call(this); return t._data = this._data.clone(), t }, _minBufferSize: 0 }); i.Hasher = h.extend({ cfg: o.extend(), init: function (t) { this.cfg = this.cfg.extend(t), this.reset() }, reset: function () { h.reset.call(this), this._doReset() }, update: function (t) { return this._append(t), this._process(), this }, finalize: function (t) { return t && this._append(t), this._doFinalize() }, blockSize: 16, _createHelper: function (t) { return function (e, n) { return new t.init(n).finalize(e) } }, _createHmacHelper: function (t) { return function (e, n) { return new f.HMAC.init(t, n).finalize(e) } } }); var f = n.algo = {}; return n }(Math), TinCan; !function (t) { for (var e = CryptoJS, n = (r = e.lib).WordArray, i = r.Hasher, r = e.algo, o = [], a = [], s = function (t) { return 4294967296 * (t - (0 | t)) | 0 }, l = 2, c = 0; 64 > c;) { var u; t: { u = l; for (var h = t.sqrt(u), f = 2; f <= h; f++)if (!(u % f)) { u = !1; break t } u = !0 } u && (8 > c && (o[c] = s(t.pow(l, .5))), a[c] = s(t.pow(l, 1 / 3)), c++), l++ } var p = []; r = r.SHA256 = i.extend({ _doReset: function () { this._hash = new n.init(o.slice(0)) }, _doProcessBlock: function (t, e) { for (var n = this._hash.words, i = n[0], r = n[1], o = n[2], s = n[3], l = n[4], c = n[5], u = n[6], h = n[7], f = 0; 64 > f; f++) { if (16 > f) p[f] = 0 | t[e + f]; else { var d = p[f - 15], g = p[f - 2]; p[f] = ((d << 25 | d >>> 7) ^ (d << 14 | d >>> 18) ^ d >>> 3) + p[f - 7] + ((g << 15 | g >>> 17) ^ (g << 13 | g >>> 19) ^ g >>> 10) + p[f - 16] } d = h + ((l << 26 | l >>> 6) ^ (l << 21 | l >>> 11) ^ (l << 7 | l >>> 25)) + (l & c ^ ~l & u) + a[f] + p[f], g = ((i << 30 | i >>> 2) ^ (i << 19 | i >>> 13) ^ (i << 10 | i >>> 22)) + (i & r ^ i & o ^ r & o), h = u, u = c, c = l, l = s + d | 0, s = o, o = r, r = i, i = d + g | 0 } n[0] = n[0] + i | 0, n[1] = n[1] + r | 0, n[2] = n[2] + o | 0, n[3] = n[3] + s | 0, n[4] = n[4] + l | 0, n[5] = n[5] + c | 0, n[6] = n[6] + u | 0, n[7] = n[7] + h | 0 }, _doFinalize: function () { var e = this._data, n = e.words, i = 8 * this._nDataBytes, r = 8 * e.sigBytes; return n[r >>> 5] |= 128 << 24 - r % 32, n[14 + (r + 64 >>> 9 << 4)] = t.floor(i / 4294967296), n[15 + (r + 64 >>> 9 << 4)] = i, e.sigBytes = 4 * n.length, this._process(), this._hash }, clone: function () { var t = i.clone.call(this); return t._hash = this._hash.clone(), t } }); e.SHA256 = i._createHelper(r), e.HmacSHA256 = i._createHmacHelper(r) }(Math), function () { var t = CryptoJS, e = t.lib.WordArray; t.enc.Base64 = { stringify: function (t) { var e = t.words, n = t.sigBytes, i = this._map; t.clamp(); for (var r = [], o = 0; o < n; o += 3)for (var a = (e[o >>> 2] >>> 24 - o % 4 * 8 & 255) << 16 | (e[o + 1 >>> 2] >>> 24 - (o + 1) % 4 * 8 & 255) << 8 | e[o + 2 >>> 2] >>> 24 - (o + 2) % 4 * 8 & 255, s = 0; s < 4 && o + .75 * s < n; s++)r.push(i.charAt(a >>> 6 * (3 - s) & 63)); var l = i.charAt(64); if (l) for (; r.length % 4;)r.push(l); return r.join("") }, parse: function (t) { var n = t.length, i = this._map, r = i.charAt(64); if (r) { var o = t.indexOf(r); -1 != o && (n = o) } for (var a = [], s = 0, l = 0; l < n; l++)if (l % 4) { var c = i.indexOf(t.charAt(l - 1)) << l % 4 * 2, u = i.indexOf(t.charAt(l)) >>> 6 - l % 4 * 2; a[s >>> 2] |= (c | u) << 24 - s % 4 * 8, s++ } return e.create(a, s) }, _map: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=" } }(), function () { if ("function" == typeof ArrayBuffer) { var t = CryptoJS.lib.WordArray, e = t.init; (t.init = function (t) { if (t instanceof ArrayBuffer && (t = new Uint8Array(t)), (t instanceof Int8Array || t instanceof Uint8ClampedArray || t instanceof Int16Array || t instanceof Uint16Array || t instanceof Int32Array || t instanceof Uint32Array || t instanceof Float32Array || t instanceof Float64Array) && (t = new Uint8Array(t.buffer, t.byteOffset, t.byteLength)), t instanceof Uint8Array) { for (var n = t.byteLength, i = [], r = 0; r < n; r++)i[r >>> 2] |= t[r] << 24 - r % 4 * 8; e.call(this, i, n) } else e.apply(this, arguments) }).prototype = t } }(), function () { "use strict"; var t = { statementId: !0, voidedStatementId: !0, verb: !0, object: !0, registration: !0, context: !0, actor: !0, since: !0, until: !0, limit: !0, authoritative: !0, sparse: !0, instructor: !0, ascending: !0, continueToken: !0, agent: !0, activityId: !0, stateId: !0, profileId: !0, activity_platform: !0, grouping: !0, "Accept-Language": !0 }; (TinCan = function (t) { this.log("constructor"), this.recordStores = [], this.actor = null, this.activity = null, this.registration = null, this.context = null, this.init(t) }).prototype = { LOG_SRC: "TinCan", log: function (t, e) { TinCan.DEBUG && "undefined" != typeof console && console.log && (e = e || this.LOG_SRC || "TinCan", console.log("TinCan." + e + ": " + t)) }, init: function (t) { var e; if (this.log("init"), (t = t || {}).hasOwnProperty("url") && "" !== t.url && this._initFromQueryString(t.url), t.hasOwnProperty("recordStores") && void 0 !== t.recordStores) for (e = 0; e < t.recordStores.length; e += 1)this.addRecordStore(t.recordStores[e]); t.hasOwnProperty("activity") && (t.activity instanceof TinCan.Activity ? this.activity = t.activity : this.activity = new TinCan.Activity(t.activity)), t.hasOwnProperty("actor") && (t.actor instanceof TinCan.Agent ? this.actor = t.actor : this.actor = new TinCan.Agent(t.actor)), t.hasOwnProperty("context") && (t.context instanceof TinCan.Context ? this.context = t.context : this.context = new TinCan.Context(t.context)), t.hasOwnProperty("registration") && (this.registration = t.registration) }, _initFromQueryString: function (e) { this.log("_initFromQueryString"); var n, i, r, o = TinCan.Utils.parseURL(e).params, a = ["endpoint", "auth"], s = {}, l = null; if (o.hasOwnProperty("actor")) { this.log("_initFromQueryString - found actor: " + o.actor); try { this.actor = TinCan.Agent.fromJSON(o.actor), delete o.actor } catch (t) { this.log("_initFromQueryString - failed to set actor: " + t) } } if (o.hasOwnProperty("activity_id") && (this.activity = new TinCan.Activity({ id: o.activity_id }), delete o.activity_id), (o.hasOwnProperty("activity_platform") || o.hasOwnProperty("registration") || o.hasOwnProperty("grouping")) && (r = {}, o.hasOwnProperty("activity_platform") && (r.platform = o.activity_platform, delete o.activity_platform), o.hasOwnProperty("registration") && (r.registration = this.registration = o.registration, delete o.registration), o.hasOwnProperty("grouping") && (r.contextActivities = {}, r.contextActivities.grouping = o.grouping, delete o.grouping), this.context = new TinCan.Context(r)), o.hasOwnProperty("endpoint")) { for (n = 0; n < a.length; n += 1)i = a[n], o.hasOwnProperty(i) && (s[i] = o[i], delete o[i]); for (n in o) o.hasOwnProperty(n) && (t.hasOwnProperty(n) ? delete o[n] : (l = l || {})[n] = o[n]); null !== l && (s.extended = l), s.allowFail = !1, this.addRecordStore(s) } }, addRecordStore: function (t) { var e; this.log("addRecordStore"), e = t instanceof TinCan.LRS ? t : new TinCan.LRS(t), this.recordStores.push(e) }, prepareStatement: function (t) { return this.log("prepareStatement"), t instanceof TinCan.Statement || (t = new TinCan.Statement(t)), null === t.actor && null !== this.actor && (t.actor = this.actor), null === t.target && null !== this.activity && (t.target = this.activity), null !== this.context && (null === t.context ? t.context = this.context : (null === t.context.registration && (t.context.registration = this.context.registration), null === t.context.platform && (t.context.platform = this.context.platform), null !== this.context.contextActivities && (null === t.context.contextActivities ? t.context.contextActivities = this.context.contextActivities : (null !== this.context.contextActivities.grouping && null === t.context.contextActivities.grouping && (t.context.contextActivities.grouping = this.context.contextActivities.grouping), null !== this.context.contextActivities.parent && null === t.context.contextActivities.parent && (t.context.contextActivities.parent = this.context.contextActivities.parent), null !== this.context.contextActivities.other && null === t.context.contextActivities.other && (t.context.contextActivities.other = this.context.contextActivities.other))))), t }, sendStatement: function (t, e) { this.log("sendStatement"); var n, i, r, o = this, a = this.prepareStatement(t), s = this.recordStores.length, l = [], c = []; if (s > 0) for ("function" == typeof e && (r = function (t, n) { var i; o.log("sendStatement - callbackWrapper: " + s), s > 1 ? (s -= 1, c.push({ err: t, xhr: n })) : 1 === s ? (c.push({ err: t, xhr: n }), i = [c, a], e.apply(this, i)) : o.log("sendStatement - unexpected record store count: " + s) }), i = 0; i < s; i += 1)n = this.recordStores[i], l.push(n.saveStatement(a, { callback: r })); else this.log("[warning] sendStatement: No LRSs added yet (statement not sent)"), "function" == typeof e && e.apply(this, [null, a]); return { statement: a, results: l } }, getStatement: function (t, e, n) { if (this.log("getStatement"), (n = n || {}).params = n.params || {}, this.recordStores.length > 0) return this.recordStores[0].retrieveStatement(t, { callback: e, params: n.params }); this.log("[warning] getStatement: No LRSs added yet (statement not retrieved)") }, voidStatement: function (t, e, n) { this.log("voidStatement"); var i, r, o, a, s, l = this, c = this.recordStores.length, u = [], h = []; if (t instanceof TinCan.Statement && (t = t.id), void 0 !== n.actor ? r = n.actor : null !== this.actor && (r = this.actor), o = new TinCan.Statement({ actor: r, verb: { id: "http://adlnet.gov/expapi/verbs/voided" }, target: { objectType: "StatementRef", id: t } }), c > 0) for ("function" == typeof e && (s = function (t, n) { var i; l.log("voidStatement - callbackWrapper: " + c), c > 1 ? (c -= 1, h.push({ err: t, xhr: n })) : 1 === c ? (h.push({ err: t, xhr: n }), i = [h, o], e.apply(this, i)) : l.log("voidStatement - unexpected record store count: " + c) }), a = 0; a < c; a += 1)i = this.recordStores[a], u.push(i.saveStatement(o, { callback: s })); else this.log("[warning] voidStatement: No LRSs added yet (statement not sent)"), "function" == typeof e && e.apply(this, [null, o]); return { statement: o, results: u } }, getVoidedStatement: function (t, e) { if (this.log("getVoidedStatement"), this.recordStores.length > 0) return this.recordStores[0].retrieveVoidedStatement(t, { callback: e }); this.log("[warning] getVoidedStatement: No LRSs added yet (statement not retrieved)") }, sendStatements: function (t, e) { this.log("sendStatements"); var n, i, r, o = this, a = [], s = this.recordStores.length, l = [], c = []; if (0 === t.length) "function" == typeof e && e.apply(this, [null, a]); else { for (i = 0; i < t.length; i += 1)a.push(this.prepareStatement(t[i])); if (s > 0) for ("function" == typeof e && (r = function (t, n) { var i; o.log("sendStatements - callbackWrapper: " + s), s > 1 ? (s -= 1, c.push({ err: t, xhr: n })) : 1 === s ? (c.push({ err: t, xhr: n }), i = [c, a], e.apply(this, i)) : o.log("sendStatements - unexpected record store count: " + s) }), i = 0; i < s; i += 1)n = this.recordStores[i], l.push(n.saveStatements(a, { callback: r })); else this.log("[warning] sendStatements: No LRSs added yet (statements not sent)"), "function" == typeof e && e.apply(this, [null, a]) } return { statements: a, results: l } }, getStatements: function (t) { this.log("getStatements"); var e, n, i = {}; if (this.recordStores.length > 0) return e = this.recordStores[0], n = (t = t || {}).params || {}, t.sendActor && null !== this.actor && ("0.9" === e.version || "0.95" === e.version ? n.actor = this.actor : n.agent = this.actor), t.sendActivity && null !== this.activity && ("0.9" === e.version || "0.95" === e.version ? n.target = this.activity : n.activity = this.activity), void 0 === n.registration && null !== this.registration && (n.registration = this.registration), i = { params: n }, void 0 !== t.callback && (i.callback = t.callback), e.queryStatements(i); this.log("[warning] getStatements: No LRSs added yet (statements not read)") }, getState: function (t, e) { var n, i; if (this.log("getState"), this.recordStores.length > 0) return i = this.recordStores[0], n = { agent: void 0 !== (e = e || {}).agent ? e.agent : this.actor, activity: void 0 !== e.activity ? e.activity : this.activity }, void 0 !== e.registration ? n.registration = e.registration : null !== this.registration && (n.registration = this.registration), void 0 !== e.callback && (n.callback = e.callback), i.retrieveState(t, n); this.log("[warning] getState: No LRSs added yet (state not retrieved)") }, setState: function (t, e, n) { var i, r; if (this.log("setState"), this.recordStores.length > 0) return r = this.recordStores[0], i = { agent: void 0 !== (n = n || {}).agent ? n.agent : this.actor, activity: void 0 !== n.activity ? n.activity : this.activity }, void 0 !== n.registration ? i.registration = n.registration : null !== this.registration && (i.registration = this.registration), void 0 !== n.lastSHA1 && (i.lastSHA1 = n.lastSHA1), void 0 !== n.contentType && (i.contentType = n.contentType, void 0 !== n.overwriteJSON && !n.overwriteJSON && TinCan.Utils.isApplicationJSON(n.contentType) && (i.method = "POST")), void 0 !== n.callback && (i.callback = n.callback), r.saveState(t, e, i); this.log("[warning] setState: No LRSs added yet (state not saved)") }, deleteState: function (t, e) { var n, i; if (this.log("deleteState"), this.recordStores.length > 0) return i = this.recordStores[0], n = { agent: void 0 !== (e = e || {}).agent ? e.agent : this.actor, activity: void 0 !== e.activity ? e.activity : this.activity }, void 0 !== e.registration ? n.registration = e.registration : null !== this.registration && (n.registration = this.registration), void 0 !== e.callback && (n.callback = e.callback), i.dropState(t, n); this.log("[warning] deleteState: No LRSs added yet (state not deleted)") }, getActivityProfile: function (t, e) { var n, i; if (this.log("getActivityProfile"), this.recordStores.length > 0) return i = this.recordStores[0], n = { activity: void 0 !== (e = e || {}).activity ? e.activity : this.activity }, void 0 !== e.callback && (n.callback = e.callback), i.retrieveActivityProfile(t, n); this.log("[warning] getActivityProfile: No LRSs added yet (activity profile not retrieved)") }, setActivityProfile: function (t, e, n) { var i, r; if (this.log("setActivityProfile"), this.recordStores.length > 0) return r = this.recordStores[0], i = { activity: void 0 !== (n = n || {}).activity ? n.activity : this.activity }, void 0 !== n.callback && (i.callback = n.callback), void 0 !== n.lastSHA1 && (i.lastSHA1 = n.lastSHA1), void 0 !== n.contentType && (i.contentType = n.contentType, void 0 !== n.overwriteJSON && !n.overwriteJSON && TinCan.Utils.isApplicationJSON(n.contentType) && (i.method = "POST")), r.saveActivityProfile(t, e, i); this.log("[warning] setActivityProfile: No LRSs added yet (activity profile not saved)") }, deleteActivityProfile: function (t, e) { var n, i; if (this.log("deleteActivityProfile"), this.recordStores.length > 0) return i = this.recordStores[0], n = { activity: void 0 !== (e = e || {}).activity ? e.activity : this.activity }, void 0 !== e.callback && (n.callback = e.callback), i.dropActivityProfile(t, n); this.log("[warning] deleteActivityProfile: No LRSs added yet (activity profile not deleted)") }, getAgentProfile: function (t, e) { var n, i; if (this.log("getAgentProfile"), this.recordStores.length > 0) return i = this.recordStores[0], n = { agent: void 0 !== (e = e || {}).agent ? e.agent : this.actor }, void 0 !== e.callback && (n.callback = e.callback), i.retrieveAgentProfile(t, n); this.log("[warning] getAgentProfile: No LRSs added yet (agent profile not retrieved)") }, setAgentProfile: function (t, e, n) { var i, r; if (this.log("setAgentProfile"), this.recordStores.length > 0) return r = this.recordStores[0], i = { agent: void 0 !== (n = n || {}).agent ? n.agent : this.actor }, void 0 !== n.callback && (i.callback = n.callback), void 0 !== n.lastSHA1 && (i.lastSHA1 = n.lastSHA1), void 0 !== n.contentType && (i.contentType = n.contentType, void 0 !== n.overwriteJSON && !n.overwriteJSON && TinCan.Utils.isApplicationJSON(n.contentType) && (i.method = "POST")), r.saveAgentProfile(t, e, i); this.log("[warning] setAgentProfile: No LRSs added yet (agent profile not saved)") }, deleteAgentProfile: function (t, e) { var n, i; if (this.log("deleteAgentProfile"), this.recordStores.length > 0) return i = this.recordStores[0], n = { agent: void 0 !== (e = e || {}).agent ? e.agent : this.actor }, void 0 !== e.callback && (n.callback = e.callback), i.dropAgentProfile(t, n); this.log("[warning] deleteAgentProfile: No LRSs added yet (agent profile not deleted)") } }, TinCan.DEBUG = !1, TinCan.enableDebug = function () { TinCan.DEBUG = !0 }, TinCan.disableDebug = function () { TinCan.DEBUG = !1 }, TinCan.versions = function () { return ["1.0.2", "1.0.1", "1.0.0", "0.95", "0.9"] }, "object" == typeof module && (module.exports = TinCan) }(), function () { "use strict"; TinCan.Utils = { defaultEncoding: "utf8", getUUID: function () { return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (t) { var e = 16 * Math.random() | 0; return ("x" == t ? e : 3 & e | 8).toString(16) }) }, getISODateString: function (t) { function e(t, e) { var n, i; for (null == t && (t = 0), null == e && (e = 2), n = Math.pow(10, e - 1), i = t.toString(); t < n && n > 1;)i = "0" + i, n /= 10; return i } return t.getUTCFullYear() + "-" + e(t.getUTCMonth() + 1) + "-" + e(t.getUTCDate()) + "T" + e(t.getUTCHours()) + ":" + e(t.getUTCMinutes()) + ":" + e(t.getUTCSeconds()) + "." + e(t.getUTCMilliseconds(), 3) + "Z" }, convertISO8601DurationToMilliseconds: function (t) { var e, n, i, r, o = t.indexOf("-") >= 0, a = t.indexOf("T"), s = t.indexOf("H"), l = t.indexOf("M"), c = t.indexOf("S"); if (-1 === a || -1 !== l && l < a || -1 !== t.indexOf("D") || -1 !== t.indexOf("Y")) throw new Error("ISO 8601 timestamps including years, months and/or days are not currently supported"); return -1 === s ? (s = a, e = 0) : e = parseInt(t.slice(a + 1, s), 10), -1 === l ? (l = a, n = 0) : n = parseInt(t.slice(s + 1, l), 10), i = parseFloat(t.slice(l + 1, c)), r = parseInt(1e3 * (60 * (60 * e + n) + i), 10), isNaN(r) && (r = 0), o && (r *= -1), r }, convertMillisecondsToISO8601Duration: function (t) { var e, n, i, r = parseInt(t, 10), o = "", a = ""; return (i = Math.round(r / 10)) < 0 && (o = "-", i *= -1), a = o + "PT", (e = parseInt(i / 36e4, 10)) > 0 && (a += e + "H"), (n = parseInt(i % 36e4 / 6e3, 10)) > 0 && (a += n + "M"), a += i % 36e4 % 6e3 / 100 + "S" }, getSHA1String: function (t) { return CryptoJS.SHA1(t).toString(CryptoJS.enc.Hex) }, getSHA256String: function (t) { return "[object ArrayBuffer]" === Object.prototype.toString.call(t) && (t = CryptoJS.lib.WordArray.create(t)), CryptoJS.SHA256(t).toString(CryptoJS.enc.Hex) }, getBase64String: function (t) { return CryptoJS.enc.Base64.stringify(CryptoJS.enc.Latin1.parse(t)) }, getLangDictionaryValue: function (t, e) { var n, i = this[t]; if (void 0 !== e && void 0 !== i[e]) return i[e]; if (void 0 !== i.und) return i.und; if (void 0 !== i["en-US"]) return i["en-US"]; for (n in i) if (i.hasOwnProperty(n)) return i[n]; return "" }, parseURL: function (t, e) { var n, i, r, o, a = "/" === t.charAt(0), s = ["(/[^?#]*)", "(\\?[^#]*|)", "(#.*|)$"], l = /\+/g, c = /([^&=]+)=?([^&]*)/g, u = function (t) { return decodeURIComponent(t.replace(l, " ")) }; if (e = e || {}, a) { if (void 0 === e.allowRelative || !e.allowRelative) throw new Error("Refusing to parse relative URL without 'allowRelative' option") } else s.unshift("^(https?:)//", "(([^:/?#]*)(?::([0-9]+))?)"), -1 === t.indexOf("/", 8) && (t += "/"); if (n = new RegExp(s.join("")), null === (i = t.match(n))) throw new Error("Unable to parse URL regular expression did not match: '" + t + "'"); if (a ? (r = { protocol: null, host: null, hostname: null, port: null, path: null, pathname: i[1], search: i[2], hash: i[3], params: {} }).path = r.pathname : (r = { protocol: i[1], host: i[2], hostname: i[3], port: i[4], pathname: i[5], search: i[6], hash: i[7], params: {} }).path = r.protocol + "//" + r.host + r.pathname, "" !== r.search) for (; o = c.exec(r.search.substring(1));)r.params[u(o[1])] = u(o[2]); return r }, getServerRoot: function (t) { var e = t.split("/"); return e[0] + "//" + e[2] }, getContentTypeFromHeader: function (t) { return String(t).split(";")[0] }, isApplicationJSON: function (t) { return 0 === TinCan.Utils.getContentTypeFromHeader(t).toLowerCase().indexOf("application/json") }, stringToArrayBuffer: function () { TinCan.prototype.log("stringToArrayBuffer not overloaded - no environment loaded?") }, stringFromArrayBuffer: function () { TinCan.prototype.log("stringFromArrayBuffer not overloaded - no environment loaded?") } } }(), function () { "use strict"; var t = TinCan.LRS = function (t) { this.log("constructor"), this.endpoint = null, this.version = null, this.auth = null, this.allowFail = !0, this.extended = null, this.init(t) }; t.prototype = { LOG_SRC: "LRS", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = TinCan.versions(), i = !1; if ((t = t || {}).hasOwnProperty("alertOnRequestFailure") && this.log("'alertOnRequestFailure' is deprecated (alerts have been removed) no need to set it now"), !t.hasOwnProperty("endpoint") || null === t.endpoint || "" === t.endpoint) throw this.log("[error] LRS invalid: no endpoint"), { code: 3, mesg: "LRS invalid: no endpoint" }; if (this.endpoint = String(t.endpoint), "/" !== this.endpoint.slice(-1) && (this.log("adding trailing slash to endpoint"), this.endpoint += "/"), t.hasOwnProperty("allowFail") && (this.allowFail = t.allowFail), t.hasOwnProperty("auth") ? this.auth = t.auth : t.hasOwnProperty("username") && t.hasOwnProperty("password") && (this.auth = "Basic " + TinCan.Utils.getBase64String(t.username + ":" + t.password)), t.hasOwnProperty("extended") && (this.extended = t.extended), this._initByEnvironment(t), void 0 !== t.version) { for (this.log("version: " + t.version), e = 0; e < n.length; e += 1)if (n[e] === t.version) { i = !0; break } if (!i) throw this.log("[error] LRS invalid: version not supported (" + t.version + ")"), { code: 5, mesg: "LRS invalid: version not supported (" + t.version + ")" }; this.version = t.version } else this.version = n[0] }, _getBoundary: function () { return TinCan.Utils.getUUID().replace(/-/g, "") }, _initByEnvironment: function () { this.log("_initByEnvironment not overloaded - no environment loaded?") }, _makeRequest: function () { this.log("_makeRequest not overloaded - no environment loaded?") }, _getMultipartRequestData: function () { this.log("_getMultipartRequestData not overloaded - no environment loaded?") }, _IEModeConversion: function () { this.log("_IEModeConversion not overloaded - browser environment not loaded.") }, _processGetStatementResult: function (t, e) { var n, i, r, o, a = {}; if (!e.attachments) return TinCan.Statement.fromJSON(t.responseText); for (n = t.getResponseHeader("Content-Type").split("boundary=")[1], i = this._parseMultipart(n, t.response), r = JSON.parse(i[0].body), o = 1; o < i.length; o += 1)a[i[o].headers["X-Experience-API-Hash"]] = i[o].body; return this._assignAttachmentContent([r], a), new TinCan.Statement(r) }, sendRequest: function (t) { this.log("sendRequest"); var e, n = this.endpoint + t.url, i = {}; if (0 === t.url.indexOf("http") && (n = t.url), null !== this.extended) for (e in t.params = t.params || {}, this.extended) this.extended.hasOwnProperty(e) && (t.params.hasOwnProperty(e) || null !== this.extended[e] && (t.params[e] = this.extended[e])); for (e in i.Authorization = this.auth, "0.9" !== this.version && (i["X-Experience-API-Version"] = this.version), t.headers) t.headers.hasOwnProperty(e) && (i[e] = t.headers[e]); return this._makeRequest(n, i, t) }, about: function (t) { var e, n, i; if (this.log("about"), e = { url: "about", method: "GET", params: {} }, void 0 !== (t = t || {}).callback && (i = function (e, n) { var i = n; null === e && (i = TinCan.About.fromJSON(n.responseText)), t.callback(e, i) }, e.callback = i), n = this.sendRequest(e), !i) return null === n.err && (n.xhr = TinCan.About.fromJSON(n.xhr.responseText)), n }, saveStatement: function (t, e) { this.log("saveStatement"); var n, i, r, o = { url: "statements", headers: {} }, a = []; e = e || {}; try { n = t.asVersion(this.version) } catch (t) { return this.allowFail ? (this.log("[warning] statement could not be serialized in version (" + this.version + "): " + t), void 0 !== e.callback ? void e.callback(null, null) : { err: null, xhr: null }) : (this.log("[error] statement could not be serialized in version (" + this.version + "): " + t), void 0 !== e.callback ? void e.callback(t, null) : { err: t, xhr: null }) } if (n.hasOwnProperty("attachments") && t.hasAttachmentWithContent()) { for (i = this._getBoundary(), o.headers["Content-Type"] = "multipart/mixed; boundary=" + i, r = 0; r < t.attachments.length; r += 1)null !== t.attachments[r].content && a.push(t.attachments[r]); try { o.data = this._getMultipartRequestData(i, n, a) } catch (t) { return this.allowFail ? (this.log("[warning] multipart request data could not be created (attachments probably not supported): " + t), void 0 !== e.callback ? void e.callback(null, null) : { err: null, xhr: null }) : (this.log("[error] multipart request data could not be created (attachments probably not supported): " + t), void 0 !== e.callback ? void e.callback(t, null) : { err: t, xhr: null }) } } else o.headers["Content-Type"] = "application/json", o.data = JSON.stringify(n); return null !== t.id ? (o.method = "PUT", o.params = { statementId: t.id }) : o.method = "POST", void 0 !== e.callback && (o.callback = e.callback), this.sendRequest(o) }, retrieveStatement: function (t, e) { this.log("retrieveStatement"); var n, i, r, o = this; return (e = e || {}).params = e.params || {}, n = { url: "statements", method: "GET", params: { statementId: t } }, e.params.attachments && (n.params.attachments = !0, n.expectMultipart = !0), void 0 !== e.callback && (r = function (t, n) { var i = n; null === t && (i = o._processGetStatementResult(n, e.params)), e.callback(t, i) }, n.callback = r), i = this.sendRequest(n), r || (i.statement = null, null === i.err && (i.statement = o._processGetStatementResult(i.xhr, e.params))), i }, retrieveVoidedStatement: function (t, e) { this.log("retrieveVoidedStatement"); var n, i, r, o = this; return (e = e || {}).params = e.params || {}, n = { url: "statements", method: "GET", params: {} }, "0.9" === this.version || "0.95" === this.version ? n.params.statementId = t : (n.params.voidedStatementId = t, e.params.attachments && (n.params.attachments = !0, n.expectMultipart = !0)), void 0 !== e.callback && (r = function (t, n) { var i = n; null === t && (i = o._processGetStatementResult(n, e.params)), e.callback(t, i) }, n.callback = r), i = this.sendRequest(n), r || (i.statement = null, null === i.err && (i.statement = o._processGetStatementResult(i.xhr, e.params))), i }, saveStatements: function (t, e) { this.log("saveStatements"); var n, i, r, o, a = { url: "statements", method: "POST", headers: {} }, s = [], l = []; if (e = e || {}, 0 === t.length) return void 0 !== e.callback ? void e.callback(new Error("no statements"), null) : { err: new Error("no statements"), xhr: null }; for (r = 0; r < t.length; r += 1) { try { n = t[r].asVersion(this.version) } catch (t) { return this.allowFail ? (this.log("[warning] statement could not be serialized in version (" + this.version + "): " + t), void 0 !== e.callback ? void e.callback(null, null) : { err: null, xhr: null }) : (this.log("[error] statement could not be serialized in version (" + this.version + "): " + t), void 0 !== e.callback ? void e.callback(t, null) : { err: t, xhr: null }) } if (t[r].hasAttachmentWithContent()) for (o = 0; o < t[r].attachments.length; o += 1)null !== t[r].attachments[o].content && l.push(t[r].attachments[o]); s.push(n) } if (0 !== l.length) { i = this._getBoundary(), a.headers["Content-Type"] = "multipart/mixed; boundary=" + i; try { a.data = this._getMultipartRequestData(i, s, l) } catch (t) { return this.allowFail ? (this.log("[warning] multipart request data could not be created (attachments probably not supported): " + t), void 0 !== e.callback ? void e.callback(null, null) : { err: null, xhr: null }) : (this.log("[error] multipart request data could not be created (attachments probably not supported): " + t), void 0 !== e.callback ? void e.callback(t, null) : { err: t, xhr: null }) } } else a.headers["Content-Type"] = "application/json", a.data = JSON.stringify(s); return void 0 !== e.callback && (a.callback = e.callback), this.sendRequest(a) }, queryStatements: function (t) { this.log("queryStatements"); var e, n, i, r = this; (t = t || {}).params = t.params || {}; try { e = this._queryStatementsRequestCfg(t), t.params.attachments && (e.expectMultipart = !0) } catch (e) { return this.log("[error] Query statements failed - " + e), void 0 !== t.callback && t.callback(e, {}), { err: e, statementsResult: null } } return void 0 !== t.callback && (i = function (e, n) { var i, o, a, s, l = n, c = {}; if (null === e) if (t.params.attachments) { for (o = n.getResponseHeader("Content-Type").split("boundary=")[1], i = r._parseMultipart(o, n.response), a = JSON.parse(i[0].body), s = 1; s < i.length; s += 1)c[i[s].headers["X-Experience-API-Hash"]] = i[s].body; for (r._assignAttachmentContent(a.statements, c), l = new TinCan.StatementsResult({ statements: a.statements }), s = 0; s < l.statements.length; s += 1)l.statements[s] instanceof TinCan.Statement || (l.statements[s] = new TinCan.Statement(l.statements[s])) } else l = TinCan.StatementsResult.fromJSON(n.responseText); t.callback(e, l) }, e.callback = i), (n = this.sendRequest(e)).config = e, i || (n.statementsResult = null, null === n.err && (n.statementsResult = TinCan.StatementsResult.fromJSON(n.xhr.responseText))), n }, _queryStatementsRequestCfg: function (t) { this.log("_queryStatementsRequestCfg"); var e, n, i = {}, r = { url: "statements", method: "GET", params: i }, o = ["agent", "actor", "object", "instructor"], a = ["verb", "activity"], s = ["registration", "context", "since", "until", "limit", "authoritative", "sparse", "ascending", "related_activities", "related_agents", "format", "attachments"], l = { verb: !0, registration: !0, since: !0, until: !0, limit: !0, ascending: !0 }, c = { .9: { supported: { actor: !0, instructor: !0, target: !0, object: !0, context: !0, authoritative: !0, sparse: !0 } }, "1.0.0": { supported: { agent: !0, activity: !0, related_activities: !0, related_agents: !0, format: !0, attachments: !0 } } }; for (n in c[.95] = c[.9], c["1.0.1"] = c["1.0.0"], c["1.0.2"] = c["1.0.0"], t.params.hasOwnProperty("target") && (t.params.object = t.params.target), t.params) if (t.params.hasOwnProperty(n) && void 0 === l[n] && void 0 === c[this.version].supported[n]) throw "Unrecognized query parameter configured: " + n; for (e = 0; e < o.length; e += 1)void 0 !== t.params[o[e]] && (i[o[e]] = JSON.stringify(t.params[o[e]].asVersion(this.version))); for (e = 0; e < a.length; e += 1)void 0 !== t.params[a[e]] && (void 0 === t.params[a[e]].id ? i[a[e]] = t.params[a[e]] : i[a[e]] = t.params[a[e]].id); for (e = 0; e < s.length; e += 1)void 0 !== t.params[s[e]] && null !== t.params[s[e]] && (i[s[e]] = t.params[s[e]]); return r }, _assignAttachmentContent: function (t, e) { var n, i; for (n = 0; n < t.length; n += 1)if (t[n].hasOwnProperty("attachments") && null !== t[n].attachments) for (i = 0; i < t[n].attachments.length; i += 1)e.hasOwnProperty(t[n].attachments[i].sha2) && (t[n].attachments[i].content = e[t[n].attachments[i].sha2]) }, _parseMultipart: function (t, e) { var n, i, r, o, a, s, l, c, u, h, f, p = "--" + t, d = []; for (n = new Uint8Array(e), r = (i = this.__uint8ToString(n)).indexOf(p + "--"), o = i.indexOf(p); -1 !== o;)a = i.indexOf(p, o + p.length), s = o + p.length + 2, c = (l = i.indexOf("\r\n\r\n", o)) + 2 + 2, u = a - 2, h = this._parseHeaders(this.__uint8ToString(new Uint8Array(e.slice(s, l)))), f = e.slice(c, u), 0 === d.length && (f = TinCan.Utils.stringFromArrayBuffer(f)), d.push({ headers: h, body: f }), o = a === r ? -1 : a; return d }, __uint8ToString: function (t) { var e, n = "", i = t.byteLength; for (e = 0; e < i; e += 1)n += String.fromCharCode(t[e]); return n }, _parseHeaders: function (t) { var e, n, i, r = {}; for (e = t.split("\n"), i = 0; i < e.length; i += 1)null !== (n = e[i].split(":", 2))[1] ? (r[n[0]] = n[1].replace(/^\s+|\s+$/g, ""), n[0]) : "\t" === n[0].substring(0, 1) && (r[n[0]] = n[1].replace(/^\s+|\s+$/g, "")); return r }, moreStatements: function (t) { var e, n, i, r, o; return this.log("moreStatements: " + t.url), t = t || {}, r = TinCan.Utils.parseURL(t.url, { allowRelative: !0 }), o = TinCan.Utils.getServerRoot(this.endpoint), 0 === r.path.indexOf("/statements") && (r.path = this.endpoint.replace(o, "") + r.path, this.log("converting non-standard more URL to " + r.path)), 0 !== r.path.indexOf("/") && (r.path = "/" + r.path), e = { method: "GET", url: o + r.path, params: r.params }, void 0 !== t.callback && (i = function (e, n) { var i = n; null === e && (i = TinCan.StatementsResult.fromJSON(n.responseText)), t.callback(e, i) }, e.callback = i), (n = this.sendRequest(e)).config = e, i || (n.statementsResult = null, null === n.err && (n.statementsResult = TinCan.StatementsResult.fromJSON(n.xhr.responseText))), n }, retrieveState: function (t, e) { this.log("retrieveState"); var n, i, r, o = {}, a = {}, s = this; if (r = e.requestHeaders || {}, o = { stateId: t, activityId: e.activity.id }, "0.9" === this.version ? o.actor = JSON.stringify(e.agent.asVersion(this.version)) : o.agent = JSON.stringify(e.agent.asVersion(this.version)), void 0 !== e.registration && null !== e.registration && ("0.9" === this.version ? o.registrationId = e.registration : o.registration = e.registration), a = { url: "activities/state", method: "GET", params: o, ignore404: !0, headers: r }, void 0 !== e.callback && (i = function (n, i) { var r = i; if (null === n) if (404 === i.status) r = null; else if (r = new TinCan.State({ id: t, contents: i.responseText }), void 0 !== i.getResponseHeader && null !== i.getResponseHeader("ETag") && "" !== i.getResponseHeader("ETag") ? r.etag = i.getResponseHeader("ETag") : r.etag = '"' + TinCan.Utils.getSHA1String(i.responseText) + '"', void 0 !== i.contentType ? r.contentType = i.contentType : void 0 !== i.getResponseHeader && null !== i.getResponseHeader("Content-Type") && "" !== i.getResponseHeader("Content-Type") && (r.contentType = i.getResponseHeader("Content-Type")), TinCan.Utils.isApplicationJSON(r.contentType)) try { r.contents = JSON.parse(r.contents) } catch (t) { s.log("retrieveState - failed to deserialize JSON: " + t) } e.callback(n, r) }, a.callback = i), n = this.sendRequest(a), !i && (n.state = null, null === n.err && 404 !== n.xhr.status && (n.state = new TinCan.State({ id: t, contents: n.xhr.responseText }), void 0 !== n.xhr.getResponseHeader && null !== n.xhr.getResponseHeader("ETag") && "" !== n.xhr.getResponseHeader("ETag") ? n.state.etag = n.xhr.getResponseHeader("ETag") : n.state.etag = '"' + TinCan.Utils.getSHA1String(n.xhr.responseText) + '"', void 0 !== n.xhr.contentType ? n.state.contentType = n.xhr.contentType : void 0 !== n.xhr.getResponseHeader && null !== n.xhr.getResponseHeader("Content-Type") && "" !== n.xhr.getResponseHeader("Content-Type") && (n.state.contentType = n.xhr.getResponseHeader("Content-Type")), TinCan.Utils.isApplicationJSON(n.state.contentType)))) try { n.state.contents = JSON.parse(n.state.contents) } catch (t) { this.log("retrieveState - failed to deserialize JSON: " + t) } return n }, retrieveStateIds: function (t) { this.log("retrieveStateIds"); var e, n, i, r, o = {}; if (n = (t = t || {}).requestHeaders || {}, o.activityId = t.activity.id, "0.9" === this.version ? o.actor = JSON.stringify(t.agent.asVersion(this.version)) : o.agent = JSON.stringify(t.agent.asVersion(this.version)), void 0 !== t.registration && null !== t.registration && ("0.9" === this.version ? o.registrationId = t.registration : o.registration = t.registration), e = { url: "activities/state", method: "GET", params: o, headers: n, ignore404: !0 }, void 0 !== t.callback && (r = function (e, n) { var i = n; if (null === e) { if (404 === n.status) i = []; else try { i = JSON.parse(n.responseText) } catch (t) { e = "Response JSON parse error: " + t } t.callback(e, i) } else t.callback(e, i) }, e.callback = r), void 0 !== t.since && (e.params.since = t.since), i = this.sendRequest(e), !r) { if (i.profileIds = null, null !== i.err) return i; if (404 === i.xhr.status) i.profileIds = []; else try { i.profileIds = JSON.parse(i.xhr.responseText) } catch (t) { i.err = "retrieveStateIds - JSON parse error: " + t } } return i }, saveState: function (t, e, n) { var i, r, o; return this.log("saveState"), o = n.requestHeaders || {}, void 0 === n.contentType && (n.contentType = "application/octet-stream"), o["Content-Type"] = n.contentType, "object" == typeof e && TinCan.Utils.isApplicationJSON(n.contentType) && (e = JSON.stringify(e)), void 0 !== n.method && "POST" === n.method || (n.method = "PUT"), i = { stateId: t, activityId: n.activity.id }, "0.9" === this.version ? i.actor = JSON.stringify(n.agent.asVersion(this.version)) : i.agent = JSON.stringify(n.agent.asVersion(this.version)), void 0 !== n.registration && null !== n.registration && ("0.9" === this.version ? i.registrationId = n.registration : i.registration = n.registration), r = { url: "activities/state", method: n.method, params: i, data: e, headers: o }, void 0 !== n.callback && (r.callback = n.callback), void 0 !== n.lastSHA1 && null !== n.lastSHA1 && (r.headers["If-Match"] = n.lastSHA1), this.sendRequest(r) }, dropState: function (t, e) { var n, i, r; return this.log("dropState"), r = e.requestHeaders || {}, n = { activityId: e.activity.id }, "0.9" === this.version ? n.actor = JSON.stringify(e.agent.asVersion(this.version)) : n.agent = JSON.stringify(e.agent.asVersion(this.version)), null !== t && (n.stateId = t), void 0 !== e.registration && null !== e.registration && ("0.9" === this.version ? n.registrationId = e.registration : n.registration = e.registration), i = { url: "activities/state", method: "DELETE", params: n, headers: r }, void 0 !== e.callback && (i.callback = e.callback), this.sendRequest(i) }, retrieveActivity: function (t, e) { this.log("retrieveActivity"); var n, i, r, o = {}; return r = e.requestHeaders || {}, o = { url: "activities", method: "GET", params: { activityId: t }, ignore404: !0, headers: r }, void 0 !== e.callback && (i = function (n, i) { var r = i; null === n && (r = 404 === i.status ? new TinCan.Activity({ id: t }) : TinCan.Activity.fromJSON(i.responseText)), e.callback(n, r) }, o.callback = i), n = this.sendRequest(o), i || (n.activity = null, null === n.err && (404 === n.xhr.status ? n.activity = new TinCan.Activity({ id: t }) : n.activity = TinCan.Activity.fromJSON(n.xhr.responseText))), n }, retrieveActivityProfile: function (t, e) { this.log("retrieveActivityProfile"); var n, i, r, o = {}, a = this; if (r = e.requestHeaders || {}, o = { url: "activities/profile", method: "GET", params: { profileId: t, activityId: e.activity.id }, ignore404: !0, headers: r }, void 0 !== e.callback && (i = function (n, i) { var r = i; if (null === n) if (404 === i.status) r = null; else if (r = new TinCan.ActivityProfile({ id: t, activity: e.activity, contents: i.responseText }), void 0 !== i.getResponseHeader && null !== i.getResponseHeader("ETag") && "" !== i.getResponseHeader("ETag") ? r.etag = i.getResponseHeader("ETag") : r.etag = '"' + TinCan.Utils.getSHA1String(i.responseText) + '"', void 0 !== i.contentType ? r.contentType = i.contentType : void 0 !== i.getResponseHeader && null !== i.getResponseHeader("Content-Type") && "" !== i.getResponseHeader("Content-Type") && (r.contentType = i.getResponseHeader("Content-Type")), TinCan.Utils.isApplicationJSON(r.contentType)) try { r.contents = JSON.parse(r.contents) } catch (t) { a.log("retrieveActivityProfile - failed to deserialize JSON: " + t) } e.callback(n, r) }, o.callback = i), n = this.sendRequest(o), !i && (n.profile = null, null === n.err && 404 !== n.xhr.status && (n.profile = new TinCan.ActivityProfile({ id: t, activity: e.activity, contents: n.xhr.responseText }), void 0 !== n.xhr.getResponseHeader && null !== n.xhr.getResponseHeader("ETag") && "" !== n.xhr.getResponseHeader("ETag") ? n.profile.etag = n.xhr.getResponseHeader("ETag") : n.profile.etag = '"' + TinCan.Utils.getSHA1String(n.xhr.responseText) + '"', void 0 !== n.xhr.contentType ? n.profile.contentType = n.xhr.contentType : void 0 !== n.xhr.getResponseHeader && null !== n.xhr.getResponseHeader("Content-Type") && "" !== n.xhr.getResponseHeader("Content-Type") && (n.profile.contentType = n.xhr.getResponseHeader("Content-Type")), TinCan.Utils.isApplicationJSON(n.profile.contentType)))) try { n.profile.contents = JSON.parse(n.profile.contents) } catch (t) { this.log("retrieveActivityProfile - failed to deserialize JSON: " + t) } return n }, retrieveActivityProfileIds: function (t) { var e, n, i, r; if (this.log("retrieveActivityProfileIds"), n = (t = t || {}).requestHeaders || {}, e = { url: "activities/profile", method: "GET", params: { activityId: t.activity.id }, headers: n, ignore404: !0 }, void 0 !== t.callback && (r = function (e, n) { var i = n; if (null === e) { if (404 === n.status) i = []; else try { i = JSON.parse(n.responseText) } catch (t) { e = "Response JSON parse error: " + t } t.callback(e, i) } else t.callback(e, i) }, e.callback = r), void 0 !== t.since && (e.params.since = t.since), i = this.sendRequest(e), !r) { if (i.profileIds = null, null !== i.err) return i; if (404 === i.xhr.status) i.profileIds = []; else try { i.profileIds = JSON.parse(i.xhr.responseText) } catch (t) { i.err = "retrieveActivityProfileIds - JSON parse error: " + t } } return i }, saveActivityProfile: function (t, e, n) { var i, r; return this.log("saveActivityProfile"), r = n.requestHeaders || {}, void 0 === n.contentType && (n.contentType = "application/octet-stream"), r["Content-Type"] = n.contentType, void 0 !== n.method && "POST" === n.method || (n.method = "PUT"), "object" == typeof e && TinCan.Utils.isApplicationJSON(n.contentType) && (e = JSON.stringify(e)), i = { url: "activities/profile", method: n.method, params: { profileId: t, activityId: n.activity.id }, data: e, headers: r }, void 0 !== n.callback && (i.callback = n.callback), void 0 !== n.lastSHA1 && null !== n.lastSHA1 ? i.headers["If-Match"] = n.lastSHA1 : i.headers["If-None-Match"] = "*", this.sendRequest(i) }, dropActivityProfile: function (t, e) { var n, i; return this.log("dropActivityProfile"), i = e.requestHeaders || {}, n = { url: "activities/profile", method: "DELETE", params: { profileId: t, activityId: e.activity.id }, headers: i }, void 0 !== e.callback && (n.callback = e.callback), this.sendRequest(n) }, retrieveAgentProfile: function (t, e) { this.log("retrieveAgentProfile"); var n, i, r, o = {}, a = this; if (r = e.requestHeaders || {}, o = { method: "GET", params: { profileId: t }, ignore404: !0, headers: r }, "0.9" === this.version ? (o.url = "actors/profile", o.params.actor = JSON.stringify(e.agent.asVersion(this.version))) : (o.url = "agents/profile", o.params.agent = JSON.stringify(e.agent.asVersion(this.version))), void 0 !== e.callback && (i = function (n, i) { var r = i; if (null === n) if (404 === i.status) r = null; else if (r = new TinCan.AgentProfile({ id: t, agent: e.agent, contents: i.responseText }), void 0 !== i.getResponseHeader && null !== i.getResponseHeader("ETag") && "" !== i.getResponseHeader("ETag") ? r.etag = i.getResponseHeader("ETag") : r.etag = '"' + TinCan.Utils.getSHA1String(i.responseText) + '"', void 0 !== i.contentType ? r.contentType = i.contentType : void 0 !== i.getResponseHeader && null !== i.getResponseHeader("Content-Type") && "" !== i.getResponseHeader("Content-Type") && (r.contentType = i.getResponseHeader("Content-Type")), TinCan.Utils.isApplicationJSON(r.contentType)) try { r.contents = JSON.parse(r.contents) } catch (t) { a.log("retrieveAgentProfile - failed to deserialize JSON: " + t) } e.callback(n, r) }, o.callback = i), n = this.sendRequest(o), !i && (n.profile = null, null === n.err && 404 !== n.xhr.status && (n.profile = new TinCan.AgentProfile({ id: t, agent: e.agent, contents: n.xhr.responseText }), void 0 !== n.xhr.getResponseHeader && null !== n.xhr.getResponseHeader("ETag") && "" !== n.xhr.getResponseHeader("ETag") ? n.profile.etag = n.xhr.getResponseHeader("ETag") : n.profile.etag = '"' + TinCan.Utils.getSHA1String(n.xhr.responseText) + '"', void 0 !== n.xhr.contentType ? n.profile.contentType = n.xhr.contentType : void 0 !== n.xhr.getResponseHeader && null !== n.xhr.getResponseHeader("Content-Type") && "" !== n.xhr.getResponseHeader("Content-Type") && (n.profile.contentType = n.xhr.getResponseHeader("Content-Type")), TinCan.Utils.isApplicationJSON(n.profile.contentType)))) try { n.profile.contents = JSON.parse(n.profile.contents) } catch (t) { this.log("retrieveAgentProfile - failed to deserialize JSON: " + t) } return n }, retrieveAgentProfileIds: function (t) { this.log("retrieveAgentProfileIds"); var e, n, i, r = {}; if (e = { method: "GET", params: r, headers: (t = t || {}).requestHeaders || {}, ignore404: !0 }, "0.9" === this.version ? (e.url = "actors/profile", r.actor = JSON.stringify(t.agent.asVersion(this.version))) : (e.url = "agents/profile", r.agent = JSON.stringify(t.agent.asVersion(this.version))), void 0 !== t.callback && (i = function (e, n) { var i = n; if (null === e) { if (404 === n.status) i = []; else try { i = JSON.parse(n.responseText) } catch (t) { e = "Response JSON parse error: " + t } t.callback(e, i) } else t.callback(e, i) }, e.callback = i), void 0 !== t.since && (e.params.since = t.since), n = this.sendRequest(e), !i) { if (n.profileIds = null, null !== n.err) return n; if (404 === n.xhr.status) n.profileIds = []; else try { n.profileIds = JSON.parse(n.xhr.responseText) } catch (t) { n.err = "retrieveAgentProfileIds - JSON parse error: " + t } } return n }, saveAgentProfile: function (t, e, n) { var i, r; return this.log("saveAgentProfile"), r = n.requestHeaders || {}, void 0 === n.contentType && (n.contentType = "application/octet-stream"), r["Content-Type"] = n.contentType, void 0 !== n.method && "POST" === n.method || (n.method = "PUT"), "object" == typeof e && TinCan.Utils.isApplicationJSON(n.contentType) && (e = JSON.stringify(e)), i = { method: n.method, params: { profileId: t }, data: e, headers: r }, "0.9" === this.version ? (i.url = "actors/profile", i.params.actor = JSON.stringify(n.agent.asVersion(this.version))) : (i.url = "agents/profile", i.params.agent = JSON.stringify(n.agent.asVersion(this.version))), void 0 !== n.callback && (i.callback = n.callback), void 0 !== n.lastSHA1 && null !== n.lastSHA1 ? i.headers["If-Match"] = n.lastSHA1 : i.headers["If-None-Match"] = "*", this.sendRequest(i) }, dropAgentProfile: function (t, e) { var n, i; return this.log("dropAgentProfile"), i = { method: "DELETE", params: n = { profileId: t }, headers: e.requestHeaders || {} }, "0.9" === this.version ? (i.url = "actors/profile", n.actor = JSON.stringify(e.agent.asVersion(this.version))) : (i.url = "agents/profile", n.agent = JSON.stringify(e.agent.asVersion(this.version))), void 0 !== e.callback && (i.callback = e.callback), this.sendRequest(i) } }, t.syncEnabled = null }(), function () { "use strict"; var t = TinCan.AgentAccount = function (t) { this.log("constructor"), this.homePage = null, this.name = null, this.init(t) }; t.prototype = { LOG_SRC: "AgentAccount", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["name", "homePage"]; for (void 0 !== (t = t || {}).accountServiceHomePage && (t.homePage = t.accountServiceHomePage), void 0 !== t.accountName && (t.name = t.accountName), e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]) }, toString: function () { this.log("toString"); var t = ""; return null !== this.name || null !== this.homePage ? (t += null !== this.name ? this.name : "-", t += ":", t += null !== this.homePage ? this.homePage : "-") : t = "AgentAccount: unidentified", t }, asVersion: function (t) { this.log("asVersion: " + t); var e = {}; return "0.9" === (t = t || TinCan.versions()[0]) ? (e.accountName = this.name, e.accountServiceHomePage = this.homePage) : (e.name = this.name, e.homePage = this.homePage), e } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.Agent = function (t) { this.log("constructor"), this.name = null, this.mbox = null, this.mbox_sha1sum = null, this.openid = null, this.account = null, this.degraded = !1, this.init(t) }; t.prototype = { objectType: "Agent", LOG_SRC: "Agent", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n, i = ["name", "mbox", "mbox_sha1sum", "openid"]; for (void 0 !== (t = t || {}).lastName || void 0 !== t.firstName ? (t.name = "", void 0 !== t.firstName && t.firstName.length > 0 && (t.name = t.firstName[0], t.firstName.length > 1 && (this.degraded = !0)), "" !== t.name && (t.name += " "), void 0 !== t.lastName && t.lastName.length > 0 && (t.name += t.lastName[0], t.lastName.length > 1 && (this.degraded = !0))) : void 0 === t.familyName && void 0 === t.givenName || (t.name = "", void 0 !== t.givenName && t.givenName.length > 0 && (t.name = t.givenName[0], t.givenName.length > 1 && (this.degraded = !0)), "" !== t.name && (t.name += " "), void 0 !== t.familyName && t.familyName.length > 0 && (t.name += t.familyName[0], t.familyName.length > 1 && (this.degraded = !0))), "object" == typeof t.name && null !== t.name && (t.name.length > 1 && (this.degraded = !0), t.name = t.name[0]), "object" == typeof t.mbox && null !== t.mbox && (t.mbox.length > 1 && (this.degraded = !0), t.mbox = t.mbox[0]), "object" == typeof t.mbox_sha1sum && null !== t.mbox_sha1sum && (t.mbox_sha1sum.length > 1 && (this.degraded = !0), t.mbox_sha1sum = t.mbox_sha1sum[0]), "object" == typeof t.openid && null !== t.openid && (t.openid.length > 1 && (this.degraded = !0), t.openid = t.openid[0]), "object" == typeof t.account && null !== t.account && void 0 === t.account.homePage && void 0 === t.account.name && (0 === t.account.length ? delete t.account : (t.account.length > 1 && (this.degraded = !0), t.account = t.account[0])), t.hasOwnProperty("account") && (t.account instanceof TinCan.AgentAccount ? this.account = t.account : this.account = new TinCan.AgentAccount(t.account)), e = 0; e < i.length; e += 1)t.hasOwnProperty(i[e]) && null !== t[i[e]] && (n = t[i[e]], "mbox" === i[e] && -1 === n.indexOf("mailto:") && (n = "mailto:" + n), this[i[e]] = n) }, toString: function () { return this.log("toString"), null !== this.name ? this.name : null !== this.mbox ? this.mbox.replace("mailto:", "") : null !== this.mbox_sha1sum ? this.mbox_sha1sum : null !== this.openid ? this.openid : null !== this.account ? this.account.toString() : this.objectType + ": unidentified" }, asVersion: function (t) { this.log("asVersion: " + t); var e = { objectType: this.objectType }; return "0.9" === (t = t || TinCan.versions()[0]) ? (null !== this.mbox ? e.mbox = [this.mbox] : null !== this.mbox_sha1sum ? e.mbox_sha1sum = [this.mbox_sha1sum] : null !== this.openid ? e.openid = [this.openid] : null !== this.account && (e.account = [this.account.asVersion(t)]), null !== this.name && (e.name = [this.name])) : (null !== this.mbox ? e.mbox = this.mbox : null !== this.mbox_sha1sum ? e.mbox_sha1sum = this.mbox_sha1sum : null !== this.openid ? e.openid = this.openid : null !== this.account && (e.account = this.account.asVersion(t)), null !== this.name && (e.name = this.name)), e } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.Group = function (t) { this.log("constructor"), this.name = null, this.mbox = null, this.mbox_sha1sum = null, this.openid = null, this.account = null, this.member = [], this.init(t) }; t.prototype = { objectType: "Group", LOG_SRC: "Group", log: TinCan.prototype.log, init: function (t) { var e; if (this.log("init"), t = t || {}, TinCan.Agent.prototype.init.call(this, t), void 0 !== t.member) for (e = 0; e < t.member.length; e += 1)t.member[e] instanceof TinCan.Agent ? this.member.push(t.member[e]) : this.member.push(new TinCan.Agent(t.member[e])) }, toString: function (t) { this.log("toString"); var e = TinCan.Agent.prototype.toString.call(this, t); return e !== this.objectType + ": unidentified" && (e = this.objectType + ": " + e), e }, asVersion: function (t) { var e, n; if (this.log("asVersion: " + t), t = t || TinCan.versions()[0], e = TinCan.Agent.prototype.asVersion.call(this, t), this.member.length > 0) for (e.member = [], n = 0; n < this.member.length; n += 1)e.member.push(this.member[n].asVersion(t)); return e } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = { "http://adlnet.gov/expapi/verbs/experienced": "experienced", "http://adlnet.gov/expapi/verbs/attended": "attended", "http://adlnet.gov/expapi/verbs/attempted": "attempted", "http://adlnet.gov/expapi/verbs/completed": "completed", "http://adlnet.gov/expapi/verbs/passed": "passed", "http://adlnet.gov/expapi/verbs/failed": "failed", "http://adlnet.gov/expapi/verbs/answered": "answered", "http://adlnet.gov/expapi/verbs/interacted": "interacted", "http://adlnet.gov/expapi/verbs/imported": "imported", "http://adlnet.gov/expapi/verbs/created": "created", "http://adlnet.gov/expapi/verbs/shared": "shared", "http://adlnet.gov/expapi/verbs/voided": "voided" }, e = TinCan.Verb = function (t) { this.log("constructor"), this.id = null, this.display = null, this.init(t) }; e.prototype = { LOG_SRC: "Verb", log: TinCan.prototype.log, init: function (e) { this.log("init"); var n, i, r = ["id", "display"]; if ("string" == typeof e) { for (i in this.id = e, this.display = { und: this.id }, t) if (t.hasOwnProperty(i) && t[i] === e) { this.id = i; break } } else { for (e = e || {}, n = 0; n < r.length; n += 1)e.hasOwnProperty(r[n]) && null !== e[r[n]] && (this[r[n]] = e[r[n]]); null === this.display && void 0 !== t[this.id] && (this.display = { und: t[this.id] }) } }, toString: function (t) { return this.log("toString"), null !== this.display ? this.getLangDictionaryValue("display", t) : this.id }, asVersion: function (e) { var n; return this.log("asVersion"), "0.9" === (e = e || TinCan.versions()[0]) ? n = t[this.id] : (n = { id: this.id }, null !== this.display && (n.display = this.display)), n }, getLangDictionaryValue: TinCan.Utils.getLangDictionaryValue }, e.fromJSON = function (t) { e.prototype.log("fromJSON"); var n = JSON.parse(t); return new e(n) } }(), function () { "use strict"; var t = TinCan.Result = function (t) { this.log("constructor"), this.score = null, this.success = null, this.completion = null, this.duration = null, this.response = null, this.extensions = null, this.init(t) }; t.prototype = { LOG_SRC: "Result", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["completion", "duration", "extensions", "response", "success"]; for ((t = t || {}).hasOwnProperty("score") && null !== t.score && (t.score instanceof TinCan.Score ? this.score = t.score : this.score = new TinCan.Score(t.score)), e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]); "Completed" === this.completion && (this.completion = !0) }, asVersion: function (t) { this.log("asVersion"); var e, n = {}, i = ["success", "duration", "response", "extensions"], r = ["score"]; for (t = t || TinCan.versions()[0], e = 0; e < i.length; e += 1)null !== this[i[e]] && (n[i[e]] = this[i[e]]); for (e = 0; e < r.length; e += 1)null !== this[r[e]] && (n[r[e]] = this[r[e]].asVersion(t)); return null !== this.completion && ("0.9" === t ? this.completion && (n.completion = "Completed") : n.completion = this.completion), n } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.Score = function (t) { this.log("constructor"), this.scaled = null, this.raw = null, this.min = null, this.max = null, this.init(t) }; t.prototype = { LOG_SRC: "Score", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["scaled", "raw", "min", "max"]; for (t = t || {}, e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]) }, asVersion: function (t) { this.log("asVersion"); var e, n = {}, i = ["scaled", "raw", "min", "max"]; for (t = t || TinCan.versions()[0], e = 0; e < i.length; e += 1)null !== this[i[e]] && (n[i[e]] = this[i[e]]); return n } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.InteractionComponent = function (t) { this.log("constructor"), this.id = null, this.description = null, this.init(t) }; t.prototype = { LOG_SRC: "InteractionComponent", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["id", "description"]; for (t = t || {}, e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]) }, asVersion: function (t) { this.log("asVersion"); var e, n, i = { id: this.id }, r = ["description"]; for (t = t || TinCan.versions()[0], e = 0; e < r.length; e += 1)null !== this[n = r[e]] && (i[n] = this[n]); return i }, getLangDictionaryValue: TinCan.Utils.getLangDictionaryValue }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = { "http://adlnet.gov/expapi/activities/course": "course", "http://adlnet.gov/expapi/activities/module": "module", "http://adlnet.gov/expapi/activities/meeting": "meeting", "http://adlnet.gov/expapi/activities/media": "media", "http://adlnet.gov/expapi/activities/performance": "performance", "http://adlnet.gov/expapi/activities/simulation": "simulation", "http://adlnet.gov/expapi/activities/assessment": "assessment", "http://adlnet.gov/expapi/activities/interaction": "interaction", "http://adlnet.gov/expapi/activities/cmi.interaction": "cmi.interaction", "http://adlnet.gov/expapi/activities/question": "question", "http://adlnet.gov/expapi/activities/objective": "objective", "http://adlnet.gov/expapi/activities/link": "link" }, e = TinCan.ActivityDefinition = function (t) { this.log("constructor"), this.name = null, this.description = null, this.type = null, this.moreInfo = null, this.extensions = null, this.interactionType = null, this.correctResponsesPattern = null, this.choices = null, this.scale = null, this.source = null, this.target = null, this.steps = null, this.init(t) }; e.prototype = { LOG_SRC: "ActivityDefinition", log: TinCan.prototype.log, init: function (e) { this.log("init"); var n, i, r, o = ["name", "description", "moreInfo", "extensions", "correctResponsesPattern"], a = []; if ((e = e || {}).hasOwnProperty("type") && null !== e.type) { for (r in t) t.hasOwnProperty(r) && t[r] === e.type && (e.type = t[r]); this.type = e.type } if (e.hasOwnProperty("interactionType") && null !== e.interactionType && (this.interactionType = e.interactionType, "choice" === e.interactionType || "sequencing" === e.interactionType ? a.push("choices") : "likert" === e.interactionType ? a.push("scale") : "matching" === e.interactionType ? (a.push("source"), a.push("target")) : "performance" === e.interactionType && a.push("steps"), a.length > 0)) for (n = 0; n < a.length; n += 1)if (r = a[n], e.hasOwnProperty(r) && null !== e[r]) for (this[r] = [], i = 0; i < e[r].length; i += 1)e[r][i] instanceof TinCan.InteractionComponent ? this[r].push(e[r][i]) : this[r].push(new TinCan.InteractionComponent(e[r][i])); for (n = 0; n < o.length; n += 1)e.hasOwnProperty(o[n]) && null !== e[o[n]] && (this[o[n]] = e[o[n]]) }, toString: function (t) { return this.log("toString"), null !== this.name ? this.getLangDictionaryValue("name", t) : null !== this.description ? this.getLangDictionaryValue("description", t) : "" }, asVersion: function (e) { this.log("asVersion"); var n, i, r, o = {}, a = ["name", "description", "interactionType", "correctResponsesPattern", "extensions"], s = ["choices", "scale", "source", "target", "steps"]; for (e = e || TinCan.versions()[0], null !== this.type && (o.type = "0.9" === e ? t[this.type] : this.type), n = 0; n < a.length; n += 1)null !== this[r = a[n]] && (o[r] = this[r]); for (n = 0; n < s.length; n += 1)if (null !== this[r = s[n]]) for (o[r] = [], i = 0; i < this[r].length; i += 1)o[r].push(this[r][i].asVersion(e)); return 0 !== e.indexOf("0.9") && null !== this.moreInfo && (o.moreInfo = this.moreInfo), o }, getLangDictionaryValue: TinCan.Utils.getLangDictionaryValue }, e.fromJSON = function (t) { e.prototype.log("fromJSON"); var n = JSON.parse(t); return new e(n) } }(), function () { "use strict"; var t = TinCan.Activity = function (t) { this.log("constructor"), this.objectType = "Activity", this.id = null, this.definition = null, this.init(t) }; t.prototype = { LOG_SRC: "Activity", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["id"]; for ((t = t || {}).hasOwnProperty("definition") && (t.definition instanceof TinCan.ActivityDefinition ? this.definition = t.definition : this.definition = new TinCan.ActivityDefinition(t.definition)), e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]) }, toString: function (t) { this.log("toString"); var e = ""; return null !== this.definition && "" !== (e = this.definition.toString(t)) ? e : null !== this.id ? this.id : "Activity: unidentified" }, asVersion: function (t) { this.log("asVersion"); var e = { id: this.id, objectType: this.objectType }; return t = t || TinCan.versions()[0], null !== this.definition && (e.definition = this.definition.asVersion(t)), e } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.ContextActivities = function (t) { this.log("constructor"), this.category = null, this.parent = null, this.grouping = null, this.other = null, this.init(t) }; t.prototype = { LOG_SRC: "ContextActivities", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n, i, r, o = ["category", "parent", "grouping", "other"]; for (t = t || {}, e = 0; e < o.length; e += 1)if (i = o[e], t.hasOwnProperty(i) && null !== t[i]) if ("[object Array]" === Object.prototype.toString.call(t[i])) for (n = 0; n < t[i].length; n += 1)this.add(i, t[i][n]); else r = t[i], this.add(i, r) }, add: function (t, e) { if ("category" === t || "parent" === t || "grouping" === t || "other" === t) return null === this[t] && (this[t] = []), e instanceof TinCan.Activity || (e = "string" == typeof e ? { id: e } : e, e = new TinCan.Activity(e)), this[t].push(e), this[t].length - 1 }, asVersion: function (t) { this.log("asVersion"); var e, n, i = {}, r = ["parent", "grouping", "other"]; for (t = t || TinCan.versions()[0], e = 0; e < r.length; e += 1)if (null !== this[r[e]] && this[r[e]].length > 0) if ("0.9" === t || "0.95" === t) this[r[e]].length > 1 && this.log("[warning] version does not support multiple values in: " + r[e]), i[r[e]] = this[r[e]][0].asVersion(t); else for (i[r[e]] = [], n = 0; n < this[r[e]].length; n += 1)i[r[e]].push(this[r[e]][n].asVersion(t)); if (null !== this.category && this.category.length > 0) { if ("0.9" === t || "0.95" === t) throw this.log("[error] version does not support the 'category' property: " + t), new Error(t + " does not support the 'category' property"); for (i.category = [], e = 0; e < this.category.length; e += 1)i.category.push(this.category[e].asVersion(t)) } return i } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.Context = function (t) { this.log("constructor"), this.registration = null, this.instructor = null, this.team = null, this.contextActivities = null, this.revision = null, this.platform = null, this.language = null, this.statement = null, this.extensions = null, this.init(t) }; t.prototype = { LOG_SRC: "Context", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n, i, r = ["registration", "revision", "platform", "language", "extensions"], o = ["instructor", "team"]; for (t = t || {}, e = 0; e < r.length; e += 1)n = r[e], t.hasOwnProperty(n) && null !== t[n] && (this[n] = t[n]); for (e = 0; e < o.length; e += 1)n = o[e], t.hasOwnProperty(n) && null !== t[n] && (void 0 !== (i = t[n]).objectType && "Person" !== i.objectType || (i.objectType = "Agent"), "Agent" !== i.objectType || i instanceof TinCan.Agent ? "Group" !== i.objectType || i instanceof TinCan.Group || (i = new TinCan.Group(i)) : i = new TinCan.Agent(i), this[n] = i); t.hasOwnProperty("contextActivities") && null !== t.contextActivities && (t.contextActivities instanceof TinCan.ContextActivities ? this.contextActivities = t.contextActivities : this.contextActivities = new TinCan.ContextActivities(t.contextActivities)), t.hasOwnProperty("statement") && null !== t.statement && (t.statement instanceof TinCan.StatementRef ? this.statement = t.statement : t.statement instanceof TinCan.SubStatement ? this.statement = t.statement : "StatementRef" === t.statement.objectType ? this.statement = new TinCan.StatementRef(t.statement) : "SubStatement" === t.statement.objectType ? this.statement = new TinCan.SubStatement(t.statement) : this.log("Unable to parse statement.context.statement property.")) }, asVersion: function (t) { this.log("asVersion"); var e, n = {}, i = ["registration", "revision", "platform", "language", "extensions"], r = ["instructor", "team", "contextActivities", "statement"]; if (t = t || TinCan.versions()[0], this.statement instanceof TinCan.SubStatement && "0.9" !== t && "0.95" !== t) throw this.log("[error] version does not support SubStatements in the 'statement' property: " + t), new Error(t + " does not support SubStatements in the 'statement' property"); for (e = 0; e < i.length; e += 1)null !== this[i[e]] && (n[i[e]] = this[i[e]]); for (e = 0; e < r.length; e += 1)null !== this[r[e]] && (n[r[e]] = this[r[e]].asVersion(t)); return n } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.StatementRef = function (t) { this.log("constructor"), this.id = null, this.init(t) }; t.prototype = { objectType: "StatementRef", LOG_SRC: "StatementRef", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["id"]; for (t = t || {}, e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]) }, toString: function () { return this.log("toString"), this.id }, asVersion: function (t) { this.log("asVersion"); var e = { objectType: this.objectType, id: this.id }; return "0.9" === t && (e.objectType = "Statement"), e } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.SubStatement = function (t) { this.log("constructor"), this.actor = null, this.verb = null, this.target = null, this.result = null, this.context = null, this.timestamp = null, this.init(t) }; t.prototype = { objectType: "SubStatement", LOG_SRC: "SubStatement", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["timestamp"]; for ((t = t || {}).hasOwnProperty("object") && (t.target = t.object), t.hasOwnProperty("actor") && (void 0 !== t.actor.objectType && "Person" !== t.actor.objectType || (t.actor.objectType = "Agent"), "Agent" === t.actor.objectType ? t.actor instanceof TinCan.Agent ? this.actor = t.actor : this.actor = new TinCan.Agent(t.actor) : "Group" === t.actor.objectType && (t.actor instanceof TinCan.Group ? this.actor = t.actor : this.actor = new TinCan.Group(t.actor))), t.hasOwnProperty("verb") && (t.verb instanceof TinCan.Verb ? this.verb = t.verb : this.verb = new TinCan.Verb(t.verb)), t.hasOwnProperty("target") && (t.target instanceof TinCan.Activity || t.target instanceof TinCan.Agent || t.target instanceof TinCan.Group || t.target instanceof TinCan.SubStatement || t.target instanceof TinCan.StatementRef ? this.target = t.target : (void 0 === t.target.objectType && (t.target.objectType = "Activity"), "Activity" === t.target.objectType ? this.target = new TinCan.Activity(t.target) : "Agent" === t.target.objectType ? this.target = new TinCan.Agent(t.target) : "Group" === t.target.objectType ? this.target = new TinCan.Group(t.target) : "SubStatement" === t.target.objectType ? this.target = new TinCan.SubStatement(t.target) : "StatementRef" === t.target.objectType ? this.target = new TinCan.StatementRef(t.target) : this.log("Unrecognized target type: " + t.target.objectType))), t.hasOwnProperty("result") && (t.result instanceof TinCan.Result ? this.result = t.result : this.result = new TinCan.Result(t.result)), t.hasOwnProperty("context") && (t.context instanceof TinCan.Context ? this.context = t.context : this.context = new TinCan.Context(t.context)), e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]) }, toString: function (t) { return this.log("toString"), (null !== this.actor ? this.actor.toString(t) : "") + " " + (null !== this.verb ? this.verb.toString(t) : "") + " " + (null !== this.target ? this.target.toString(t) : "") }, asVersion: function (t) { this.log("asVersion"); var e, n, i = ["timestamp"], r = ["actor", "verb", "result", "context"]; for (e = { objectType: this.objectType }, t = t || TinCan.versions()[0], n = 0; n < i.length; n += 1)null !== this[i[n]] && (e[i[n]] = this[i[n]]); for (n = 0; n < r.length; n += 1)null !== this[r[n]] && (e[r[n]] = this[r[n]].asVersion(t)); return null !== this.target && (e.object = this.target.asVersion(t)), "0.9" === t && (e.objectType = "Statement"), e } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.Statement = function (t, e) { this.log("constructor"), void 0 === (e = "number" == typeof e ? { storeOriginal: e } : e || {}).storeOriginal && (e.storeOriginal = null), void 0 === e.doStamp && (e.doStamp = !0), this.id = null, this.actor = null, this.verb = null, this.target = null, this.result = null, this.context = null, this.timestamp = null, this.stored = null, this.authority = null, this.attachments = null, this.version = null, this.degraded = !1, this.voided = null, this.inProgress = null, this.originalJSON = null, this.init(t, e) }; t.prototype = { LOG_SRC: "Statement", log: TinCan.prototype.log, init: function (t, e) { this.log("init"); var n, i = ["id", "stored", "timestamp", "version", "inProgress", "voided"]; if (t = t || {}, e.storeOriginal && (this.originalJSON = JSON.stringify(t, null, e.storeOriginal)), t.hasOwnProperty("object") && (t.target = t.object), t.hasOwnProperty("actor") && (void 0 !== t.actor.objectType && "Person" !== t.actor.objectType || (t.actor.objectType = "Agent"), "Agent" === t.actor.objectType ? t.actor instanceof TinCan.Agent ? this.actor = t.actor : this.actor = new TinCan.Agent(t.actor) : "Group" === t.actor.objectType && (t.actor instanceof TinCan.Group ? this.actor = t.actor : this.actor = new TinCan.Group(t.actor))), t.hasOwnProperty("authority") && (void 0 !== t.authority.objectType && "Person" !== t.authority.objectType || (t.authority.objectType = "Agent"), "Agent" === t.authority.objectType ? t.authority instanceof TinCan.Agent ? this.authority = t.authority : this.authority = new TinCan.Agent(t.authority) : "Group" === t.authority.objectType && (t.actor instanceof TinCan.Group ? this.authority = t.authority : this.authority = new TinCan.Group(t.authority))), t.hasOwnProperty("verb") && (t.verb instanceof TinCan.Verb ? this.verb = t.verb : this.verb = new TinCan.Verb(t.verb)), t.hasOwnProperty("target") && (t.target instanceof TinCan.Activity || t.target instanceof TinCan.Agent || t.target instanceof TinCan.Group || t.target instanceof TinCan.SubStatement || t.target instanceof TinCan.StatementRef ? this.target = t.target : (void 0 === t.target.objectType && (t.target.objectType = "Activity"), "Activity" === t.target.objectType ? this.target = new TinCan.Activity(t.target) : "Agent" === t.target.objectType ? this.target = new TinCan.Agent(t.target) : "Group" === t.target.objectType ? this.target = new TinCan.Group(t.target) : "SubStatement" === t.target.objectType ? this.target = new TinCan.SubStatement(t.target) : "StatementRef" === t.target.objectType ? this.target = new TinCan.StatementRef(t.target) : this.log("Unrecognized target type: " + t.target.objectType))), t.hasOwnProperty("result") && (t.result instanceof TinCan.Result ? this.result = t.result : this.result = new TinCan.Result(t.result)), t.hasOwnProperty("context") && (t.context instanceof TinCan.Context ? this.context = t.context : this.context = new TinCan.Context(t.context)), t.hasOwnProperty("attachments") && null !== t.attachments) for (this.attachments = [], n = 0; n < t.attachments.length; n += 1)t.attachments[n] instanceof TinCan.Attachment ? this.attachments.push(t.attachments[n]) : this.attachments.push(new TinCan.Attachment(t.attachments[n])); for (n = 0; n < i.length; n += 1)t.hasOwnProperty(i[n]) && null !== t[i[n]] && (this[i[n]] = t[i[n]]); e.doStamp && this.stamp() }, toString: function (t) { return this.log("toString"), (null !== this.actor ? this.actor.toString(t) : "") + " " + (null !== this.verb ? this.verb.toString(t) : "") + " " + (null !== this.target ? this.target.toString(t) : "") }, asVersion: function (t) { this.log("asVersion"); var e, n = {}, i = ["id", "timestamp"], r = ["actor", "verb", "result", "context", "authority"]; for (t = t || TinCan.versions()[0], e = 0; e < i.length; e += 1)null !== this[i[e]] && (n[i[e]] = this[i[e]]); for (e = 0; e < r.length; e += 1)null !== this[r[e]] && (n[r[e]] = this[r[e]].asVersion(t)); if (null !== this.target && (n.object = this.target.asVersion(t)), "0.9" !== t && "0.95" !== t || null !== this.voided && (n.voided = this.voided), "0.9" === t && null !== this.inProgress && (n.inProgress = this.inProgress), null !== this.attachments && "0.9" !== t && "0.95" !== t) for (n.attachments = [], e = 0; e < this.attachments.length; e += 1)this.attachments[e] instanceof TinCan.Attachment ? n.attachments.push(this.attachments[e].asVersion(t)) : n.attachments.push(new TinCan.Attachment(this.attachments[e]).asVersion(t)); return n }, stamp: function () { this.log("stamp"), null === this.id && (this.id = TinCan.Utils.getUUID()), null === this.timestamp && (this.timestamp = TinCan.Utils.getISODateString(new Date)) }, hasAttachmentWithContent: function () { var t; if (this.log("hasAttachmentWithContent"), null === this.attachments) return !1; for (t = 0; t < this.attachments.length; t += 1)if (null !== this.attachments[t].content) return !0; return !1 } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.StatementsResult = function (t) { this.log("constructor"), this.statements = null, this.more = null, this.init(t) }; t.prototype = { LOG_SRC: "StatementsResult", log: TinCan.prototype.log, init: function (t) { this.log("init"), (t = t || {}).hasOwnProperty("statements") && (this.statements = t.statements), t.hasOwnProperty("more") && (this.more = t.more) } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n, i, r, o = []; try { n = JSON.parse(e) } catch (e) { t.prototype.log("fromJSON - JSON.parse error: " + e) } if (n) { for (r = 0; r < n.statements.length; r += 1) { try { i = new TinCan.Statement(n.statements[r], 4) } catch (e) { t.prototype.log("fromJSON - statement instantiation failed: " + e + " (" + JSON.stringify(n.statements[r]) + ")"), i = new TinCan.Statement({ id: n.statements[r].id }, 4) } o.push(i) } n.statements = o } return new t(n) } }(), function () { "use strict"; var t = TinCan.State = function (t) { this.log("constructor"), this.id = null, this.updated = null, this.contents = null, this.etag = null, this.contentType = null, this.init(t) }; t.prototype = { LOG_SRC: "State", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["id", "contents", "etag", "contentType"]; for (t = t || {}, e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]); this.updated = !1 } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.ActivityProfile = function (t) { this.log("constructor"), this.id = null, this.activity = null, this.updated = null, this.contents = null, this.etag = null, this.contentType = null, this.init(t) }; t.prototype = { LOG_SRC: "ActivityProfile", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["id", "contents", "etag", "contentType"]; for ((t = t || {}).hasOwnProperty("activity") && (t.activity instanceof TinCan.Activity ? this.activity = t.activity : this.activity = new TinCan.Activity(t.activity)), e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]); this.updated = !1 } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.AgentProfile = function (t) { this.log("constructor"), this.id = null, this.agent = null, this.updated = null, this.contents = null, this.etag = null, this.contentType = null, this.init(t) }; t.prototype = { LOG_SRC: "AgentProfile", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["id", "contents", "etag", "contentType"]; for ((t = t || {}).hasOwnProperty("agent") && (t.agent instanceof TinCan.Agent ? this.agent = t.agent : this.agent = new TinCan.Agent(t.agent)), e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]); this.updated = !1 } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.About = function (t) { this.log("constructor"), this.version = null, this.init(t) }; t.prototype = { LOG_SRC: "About", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["version"]; for (t = t || {}, e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]) } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) } }(), function () { "use strict"; var t = TinCan.Attachment = function (t) { this.log("constructor"), this.usageType = null, this.display = null, this.contentType = null, this.length = null, this.sha2 = null, this.description = null, this.fileUrl = null, this.content = null, this.init(t) }; t.prototype = { LOG_SRC: "Attachment", log: TinCan.prototype.log, init: function (t) { this.log("init"); var e, n = ["contentType", "length", "sha2", "usageType", "display", "description", "fileUrl"]; for (t = t || {}, e = 0; e < n.length; e += 1)t.hasOwnProperty(n[e]) && null !== t[n[e]] && (this[n[e]] = t[n[e]]); t.hasOwnProperty("content") && null !== t.content && ("string" == typeof t.content ? this.setContentFromString(t.content) : this.setContent(t.content)) }, asVersion: function (t) { var e; return this.log("asVersion"), "0.9" === (t = t || TinCan.versions()[0]) || "0.95" === t ? e = null : (e = { contentType: this.contentType, display: this.display, length: this.length, sha2: this.sha2, usageType: this.usageType }, null !== this.fileUrl && (e.fileUrl = this.fileUrl), null !== this.description && (e.description = this.description)), e }, getLangDictionaryValue: TinCan.Utils.getLangDictionaryValue, setContent: function (t) { this.content = t, this.length = t.byteLength, this.sha2 = TinCan.Utils.getSHA256String(t) }, setContentFromString: function (t) { var e; e = TinCan.Utils.stringToArrayBuffer(t), this.setContent(e) }, getContentAsString: function () { return TinCan.Utils.stringFromArrayBuffer(this.content) } }, t.fromJSON = function (e) { t.prototype.log("fromJSON"); var n = JSON.parse(e); return new t(n) }, t._defaultEncoding = "utf-8" }(), function () { "use strict"; var LOG_SRC = "Environment.Browser", requestComplete, __IEModeConversion, nativeRequest, xdrRequest, __createJSONSegment, __createAttachmentSegment, __delay, env = {}, log = TinCan.prototype.log; "undefined" != typeof window ? (window.JSON || (window.JSON = { parse: function (sJSON) { return eval("(" + sJSON + ")") }, stringify: function (t) { var e, n, i = ""; if (t instanceof Object) { if (t.constructor === Array) { for (e = 0; e < t.length; e += 1)i += this.stringify(t[e]) + ","; return "[" + i.substr(0, i.length - 1) + "]" } if (t.toString !== Object.prototype.toString) return '"' + t.toString().replace(/"/g, "\\$&") + '"'; for (n in t) t.hasOwnProperty(n) && (i += '"' + n.replace(/"/g, "\\$&") + '":' + this.stringify(t[n]) + ","); return "{" + i.substr(0, i.length - 1) + "}" } return "string" == typeof t ? '"' + t.replace(/"/g, "\\$&") + '"' : String(t) } }), Date.now || (Date.now = function () { return +new Date }), Array.prototype.forEach || (Array.prototype.forEach = function (t) { if (null == this) throw new TypeError; var e = Object(this), n = e.length >>> 0; if ("function" != typeof t) throw new TypeError; var i, r = arguments[1]; for (i = 0; i < n; i += 1)i in e && t.call(r, e[i], i, e) }), env.hasCORS = !1, env.useXDR = !1, "undefined" != typeof XMLHttpRequest && void 0 !== (new XMLHttpRequest).withCredentials ? env.hasCORS = !0 : "undefined" != typeof XDomainRequest && (env.hasCORS = !0, env.useXDR = !0), requestComplete = function (t, e, n) { var i, r, o; return log("requestComplete: " + n.finished + ", xhr.status: " + t.status, LOG_SRC), o = void 0 === t.status ? n.fakeStatus : 1223 === t.status ? 204 : t.status, n.finished ? i : (n.finished = !0, r = e.ignore404 && 404 === o, o >= 200 && o < 400 || r ? e.callback ? void e.callback(null, t) : i = { err: null, xhr: t } : (i = { err: o, xhr: t }, log(0 === o ? "[warning] There was a problem communicating with the Learning Record Store. Aborted, offline, or invalid CORS endpoint (" + o + ")" : "[warning] There was a problem communicating with the Learning Record Store. (" + o + " | " + t.responseText + ")", LOG_SRC), e.callback && e.callback(o, t), i)) }, __IEModeConversion = function (t, e, n, i) { var r; for (r in e) e.hasOwnProperty(r) && n.push(r + "=" + encodeURIComponent(e[r])); return void 0 !== i.data && n.push("content=" + encodeURIComponent(i.data)), e["Content-Type"] = "application/x-www-form-urlencoded", t += "?method=" + i.method, i.method = "POST", i.params = {}, n.length > 0 && (i.data = n.join("&")), t }, nativeRequest = function (t, e, n) { log("sendRequest using XMLHttpRequest", LOG_SRC); var i, r, o, a, s = this, l = [], c = { finished: !1, fakeStatus: null }, u = void 0 !== n.callback, h = t; for (r in log("sendRequest using XMLHttpRequest - async: " + u, LOG_SRC), n.params) n.params.hasOwnProperty(r) && l.push(r + "=" + encodeURIComponent(n.params[r])); if (l.length > 0 && (h += "?" + l.join("&")), h.length >= 2048) { if (void 0 === n.method) return a = new Error("method must not be undefined for an IE Mode Request conversion"), void 0 !== n.callback && n.callback(a, null), { err: a, xhr: null }; t = __IEModeConversion(t, e, l, n) } else t = h; if ("undefined" != typeof XMLHttpRequest) i = new XMLHttpRequest; else if (i = new ActiveXObject("Microsoft.XMLHTTP"), n.expectMultipart) return a = new Error("Attachment support not available"), void 0 !== n.callback && n.callback(a, null), { err: a, xhr: null }; for (r in i.open(n.method, t, u), n.expectMultipart && (i.responseType = "arraybuffer"), e) e.hasOwnProperty(r) && i.setRequestHeader(r, e[r]); o = n.data, u && (i.onreadystatechange = function () { log("xhr.onreadystatechange - xhr.readyState: " + i.readyState, LOG_SRC), 4 === i.readyState && requestComplete.call(s, i, n, c) }); try { i.send(o) } catch (t) { log("sendRequest caught send exception: " + t, LOG_SRC) } return u ? i : requestComplete.call(this, i, n, c) }, xdrRequest = function (t, e, n) { log("sendRequest using XDomainRequest", LOG_SRC); var i, r, o, a, s, l = this, c = [], u = { finished: !1, fakeStatus: null }; if (n.expectMultipart) return s = new Error("Attachment support not available"), void 0 !== n.callback && n.callback(s, null), { err: s, xhr: null }; for (o in t += "?method=" + n.method, n.params) n.params.hasOwnProperty(o) && c.push(o + "=" + encodeURIComponent(n.params[o])); for (o in e) e.hasOwnProperty(o) && c.push(o + "=" + encodeURIComponent(e[o])); void 0 !== n.data && c.push("content=" + encodeURIComponent(n.data)), r = c.join("&"), (i = new XDomainRequest).open("POST", t), n.callback ? (i.onload = function () { u.fakeStatus = 200, requestComplete.call(l, i, n, u) }, i.onerror = function () { u.fakeStatus = 400, requestComplete.call(l, i, n, u) }, i.ontimeout = function () { u.fakeStatus = 0, requestComplete.call(l, i, n, u) }) : (i.onload = function () { u.fakeStatus = 200 }, i.onerror = function () { u.fakeStatus = 400 }, i.ontimeout = function () { u.fakeStatus = 0 }), i.onprogress = function () { }, i.timeout = 0; try { i.send(r) } catch (t) { log("sendRequest caught send exception: " + t, LOG_SRC) } if (!n.callback) { for (a = 1e4 + Date.now(), log("sendRequest - until: " + a + ", finished: " + u.finished, LOG_SRC); Date.now() < a && null === u.fakeStatus;)__delay(); return requestComplete.call(l, i, n, u) } return i }, TinCan.LRS.prototype._initByEnvironment = function (t) { var e, n, i; if (log("_initByEnvironment", LOG_SRC), t = t || {}, this._makeRequest = nativeRequest, this._IEModeConversion = __IEModeConversion, null === (e = this.endpoint.toLowerCase().match(/([A-Za-z]+:)\/\/([^:\/]+):?(\d+)?(\/.*)?$/))) throw log("[error] LRS invalid: failed to divide URL parts", LOG_SRC), { code: 4, mesg: "LRS invalid: failed to divide URL parts" }; if (i = location.port, n = location.protocol.toLowerCase() === e[1], "" === i && (i = "http:" === location.protocol.toLowerCase() ? "80" : "https:" === location.protocol.toLowerCase() ? "443" : ""), !n || location.hostname.toLowerCase() !== e[2] || i !== (null !== e[3] && void 0 !== e[3] && "" !== e[3] ? e[3] : "http:" === e[1] ? "80" : "https:" === e[1] ? "443" : "")) if (env.hasCORS) { if (env.useXDR && n) this._makeRequest = xdrRequest; else if (env.useXDR && !n) { if (!t.allowFail) throw log("[error] LRS invalid: cross domain request for differing scheme in IE with XDR", LOG_SRC), { code: 2, mesg: "LRS invalid: cross domain request for differing scheme in IE with XDR" }; log("[warning] LRS invalid: cross domain request for differing scheme in IE with XDR (allowed to fail)", LOG_SRC) } } else { if (!t.allowFail) throw log("[error] LRS invalid: cross domain requests not supported in this browser", LOG_SRC), { code: 1, mesg: "LRS invalid: cross domain requests not supported in this browser" }; log("[warning] LRS invalid: cross domain requests not supported in this browser (allowed to fail)", LOG_SRC) } }, __delay = function () { var t = new XMLHttpRequest, e = window.location + "?forcenocache=" + TinCan.Utils.getUUID(); t.open("GET", e, !1), t.send(null) }, TinCan.LRS.syncEnabled = !0, TinCan.LRS.prototype._getMultipartRequestData = function (t, e, n) { var i, r = []; for (r.push(__createJSONSegment(t, e)), i = 0; i < n.length; i += 1)null !== n[i].content && r.push(__createAttachmentSegment(t, n[i].content, n[i].sha2, n[i].contentType)); return r.push("\r\n--" + t + "--\r\n"), new Blob(r) }, __createJSONSegment = function (t, e) { var n = ["--" + t, "Content-Type: application/json", "", JSON.stringify(e)].join("\r\n"); return n += "\r\n" }, __createAttachmentSegment = function (t, e, n, i) { var r = [], o = ["--" + t, "Content-Type: " + i, "Content-Transfer-Encoding: binary", "X-Experience-API-Hash: " + n].join("\r\n"); return o += "\r\n\r\n", r.push(o), r.push(e), new Blob(r) }, TinCan.Utils.stringToArrayBuffer = function (t, e) { return e || (e = TinCan.Utils.defaultEncoding), new TextEncoder(e).encode(t).buffer }, TinCan.Utils.stringFromArrayBuffer = function (t, e) { return e || (e = TinCan.Utils.defaultEncoding), new TextDecoder(e).decode(t) }) : log("'window' not defined", LOG_SRC) }(), function (t) { "use strict"; var e = void 0, n = 1e5; function i(t) { switch (typeof t) { case "undefined": return "undefined"; case "boolean": return "boolean"; case "number": return "number"; case "string": return "string"; default: return null === t ? "null" : "object" } } function r(t) { return Object.prototype.toString.call(t).replace(/^\[object *|\]$/g, "") } function o(t) { return "function" == typeof t } function a(t) { if (null === t || t === e) throw TypeError(); return Object(t) } function s(t) { return t >> 0 } function l(t) { return t >>> 0 } var c, u, h = Math.LN2, f = Math.abs, p = Math.floor, d = Math.log, g = Math.max, y = Math.min, v = Math.pow, m = Math.round; function b(t, e) { var n = 32 - e; return t << n >> n } function S(t, e) { var n = 32 - e; return t << n >>> n } function T(t) { return [255 & t] } function w(t) { return b(t[0], 8) } function O(t) { return [255 & t] } function x(t) { return S(t[0], 8) } function C(t) { return [(t = m(Number(t))) < 0 ? 0 : t > 255 ? 255 : 255 & t] } function _(t) { return [255 & t, t >> 8 & 255] } function A(t) { return b(t[1] << 8 | t[0], 16) } function R(t) { return [255 & t, t >> 8 & 255] } function P(t) { return S(t[1] << 8 | t[0], 16) } function E(t) { return [255 & t, t >> 8 & 255, t >> 16 & 255, t >> 24 & 255] } function j(t) { return b(t[3] << 24 | t[2] << 16 | t[1] << 8 | t[0], 32) } function N(t) { return [255 & t, t >> 8 & 255, t >> 16 & 255, t >> 24 & 255] } function k(t) { return S(t[3] << 24 | t[2] << 16 | t[1] << 8 | t[0], 32) } function L(t, e, n) { var i, r, o, a = (1 << e - 1) - 1; function s(t) { var e = p(t), n = t - e; return n < .5 ? e : n > .5 ? e + 1 : e % 2 ? e + 1 : e } if (t != t) r = (1 << e) - 1, o = v(2, n - 1), i = 0; else if (t === 1 / 0 || t === -1 / 0) r = (1 << e) - 1, o = 0, i = t < 0 ? 1 : 0; else if (0 === t) r = 0, o = 0, i = 1 / t == -1 / 0 ? 1 : 0; else if (i = t < 0, (t = f(t)) >= v(2, 1 - a)) { r = y(p(d(t) / h), 1023); var l = t / v(2, r); l < 1 && (r -= 1, l *= 2), l >= 2 && (r += 1, l /= 2); var c = v(2, n); r += a, (o = s(l * c) - c) / c >= 1 && (r += 1, o = 0), r > 2 * a && (r = (1 << e) - 1, o = 0) } else r = 0, o = s(t / v(2, 1 - a - n)); var u, g = []; for (u = n; u; u -= 1)g.push(o % 2 ? 1 : 0), o = p(o / 2); for (u = e; u; u -= 1)g.push(r % 2 ? 1 : 0), r = p(r / 2); g.push(i ? 1 : 0), g.reverse(); for (var m = g.join(""), b = []; m.length;)b.unshift(parseInt(m.substring(0, 8), 2)), m = m.substring(8); return b } function J(t, e, n) { var i, r, o, a, s, l, c, u, h = []; for (i = 0; i < t.length; ++i)for (o = t[i], r = 8; r; r -= 1)h.push(o % 2 ? 1 : 0), o >>= 1; return h.reverse(), a = h.join(""), s = (1 << e - 1) - 1, l = parseInt(a.substring(0, 1), 2) ? -1 : 1, c = parseInt(a.substring(1, 1 + e), 2), u = parseInt(a.substring(1 + e), 2), c === (1 << e) - 1 ? 0 !== u ? NaN : l * (1 / 0) : c > 0 ? l * v(2, c - s) * (1 + u / v(2, n)) : 0 !== u ? l * v(2, -(s - 1)) * (u / v(2, n)) : l < 0 ? -0 : 0 } function I(t) { return J(t, 11, 52) } function U(t) { return L(t, 11, 52) } function B(t) { return J(t, 8, 23) } function H(t) { return L(t, 8, 23) } c = Object.defineProperty, u = !function () { try { return Object.defineProperty({}, "x", {}) } catch (t) { return !1 } }(), c && !u || (Object.defineProperty = function (t, e, n) { if (c) try { return c(t, e, n) } catch (t) { } if (t !== Object(t)) throw TypeError("Object.defineProperty called on non-object"); return Object.prototype.__defineGetter__ && "get" in n && Object.prototype.__defineGetter__.call(t, e, n.get), Object.prototype.__defineSetter__ && "set" in n && Object.prototype.__defineSetter__.call(t, e, n.set), "value" in n && (t[e] = n.value), t }), function () { function c(t) { if ((t = s(t)) < 0) throw RangeError("ArrayBuffer size is not a small enough positive integer."); Object.defineProperty(this, "byteLength", { value: t }), Object.defineProperty(this, "_bytes", { value: Array(t) }); for (var e = 0; e < t; e += 1)this._bytes[e] = 0 } function u() { if (!arguments.length || "object" != typeof arguments[0]) return function (t) { if ((t = s(t)) < 0) throw RangeError("length is not a small enough positive integer."); Object.defineProperty(this, "length", { value: t }), Object.defineProperty(this, "byteLength", { value: t * this.BYTES_PER_ELEMENT }), Object.defineProperty(this, "buffer", { value: new c(this.byteLength) }), Object.defineProperty(this, "byteOffset", { value: 0 }) }.apply(this, arguments); if (arguments.length >= 1 && "object" === i(arguments[0]) && arguments[0] instanceof u) return function (t) { if (this.constructor !== t.constructor) throw TypeError(); var e = t.length * this.BYTES_PER_ELEMENT; Object.defineProperty(this, "buffer", { value: new c(e) }), Object.defineProperty(this, "byteLength", { value: e }), Object.defineProperty(this, "byteOffset", { value: 0 }), Object.defineProperty(this, "length", { value: t.length }); for (var n = 0; n < this.length; n += 1)this._setter(n, t._getter(n)) }.apply(this, arguments); if (arguments.length >= 1 && "object" === i(arguments[0]) && !(arguments[0] instanceof u) && !(arguments[0] instanceof c || "ArrayBuffer" === r(arguments[0]))) return function (t) { var e = t.length * this.BYTES_PER_ELEMENT; Object.defineProperty(this, "buffer", { value: new c(e) }), Object.defineProperty(this, "byteLength", { value: e }), Object.defineProperty(this, "byteOffset", { value: 0 }), Object.defineProperty(this, "length", { value: t.length }); for (var n = 0; n < this.length; n += 1) { var i = t[n]; this._setter(n, Number(i)) } }.apply(this, arguments); if (arguments.length >= 1 && "object" === i(arguments[0]) && (arguments[0] instanceof c || "ArrayBuffer" === r(arguments[0]))) return function (t, n, i) { if ((n = l(n)) > t.byteLength) throw RangeError("byteOffset out of range"); if (n % this.BYTES_PER_ELEMENT) throw RangeError("buffer length minus the byteOffset is not a multiple of the element size."); if (i === e) { var r = t.byteLength - n; if (r % this.BYTES_PER_ELEMENT) throw RangeError("length of buffer minus byteOffset not a multiple of the element size"); i = r / this.BYTES_PER_ELEMENT } else r = (i = l(i)) * this.BYTES_PER_ELEMENT; if (n + r > t.byteLength) throw RangeError("byteOffset and length reference an area beyond the end of the buffer"); Object.defineProperty(this, "buffer", { value: t }), Object.defineProperty(this, "byteLength", { value: r }), Object.defineProperty(this, "byteOffset", { value: n }), Object.defineProperty(this, "length", { value: i }) }.apply(this, arguments); throw TypeError() } t.ArrayBuffer = t.ArrayBuffer || c, Object.defineProperty(u, "from", { value: function (t) { return new this(t) } }), Object.defineProperty(u, "of", { value: function () { return new this(arguments) } }); var h = {}; function d(e, i, r) { var o = function () { Object.defineProperty(this, "constructor", { value: o }), u.apply(this, arguments), function (e) { if (!("TYPED_ARRAY_POLYFILL_NO_ARRAY_ACCESSORS" in t)) { if (e.length > n) throw RangeError("Array too large for polyfill"); var i; for (i = 0; i < e.length; i += 1)r(i) } function r(t) { Object.defineProperty(e, t, { get: function () { return e._getter(t) }, set: function (n) { e._setter(t, n) }, enumerable: !0, configurable: !1 }) } }(this) }; "__proto__" in o ? o.__proto__ = u : (o.from = u.from, o.of = u.of), o.BYTES_PER_ELEMENT = e; var a = function () { }; return a.prototype = h, o.prototype = new a, Object.defineProperty(o.prototype, "BYTES_PER_ELEMENT", { value: e }), Object.defineProperty(o.prototype, "_pack", { value: i }), Object.defineProperty(o.prototype, "_unpack", { value: r }), o } u.prototype = h, Object.defineProperty(u.prototype, "_getter", { value: function (t) { if (arguments.length < 1) throw SyntaxError("Not enough arguments"); if ((t = l(t)) >= this.length) return e; var n, i, r = []; for (n = 0, i = this.byteOffset + t * this.BYTES_PER_ELEMENT; n < this.BYTES_PER_ELEMENT; n += 1, i += 1)r.push(this.buffer._bytes[i]); return this._unpack(r) } }), Object.defineProperty(u.prototype, "get", { value: u.prototype._getter }), Object.defineProperty(u.prototype, "_setter", { value: function (t, e) { if (arguments.length < 2) throw SyntaxError("Not enough arguments"); if (!((t = l(t)) >= this.length)) { var n, i, r = this._pack(e); for (n = 0, i = this.byteOffset + t * this.BYTES_PER_ELEMENT; n < this.BYTES_PER_ELEMENT; n += 1, i += 1)this.buffer._bytes[i] = r[n] } } }), Object.defineProperty(u.prototype, "constructor", { value: u }), Object.defineProperty(u.prototype, "copyWithin", { value: function (t, n) { var i = arguments[2], r = a(this), o = l(r.length); o = g(o, 0); var c, u = s(t); c = u < 0 ? g(o + u, 0) : y(u, o); var h, f, p, d = s(n); h = d < 0 ? g(o + d, 0) : y(d, o), p = (f = i === e ? o : s(i)) < 0 ? g(o + f, 0) : y(f, o); var v, m = y(p - h, o - c); for (h < c && c < h + m ? (v = -1, h = h + m - 1, c = c + m - 1) : v = 1; m > 0;)r._setter(c, r._getter(h)), h += v, c += v, m -= 1; return r } }), Object.defineProperty(u.prototype, "every", { value: function (t) { if (this === e || null === this) throw TypeError(); var n = Object(this), i = l(n.length); if (!o(t)) throw TypeError(); for (var r = arguments[1], a = 0; a < i; a++)if (!t.call(r, n._getter(a), a, n)) return !1; return !0 } }), Object.defineProperty(u.prototype, "fill", { value: function (t) { var n = arguments[1], i = arguments[2], r = a(this), o = l(r.length); o = g(o, 0); var c, u, h, f = s(n); for (c = f < 0 ? g(o + f, 0) : y(f, o), h = (u = i === e ? o : s(i)) < 0 ? g(o + u, 0) : y(u, o); c < h;)r._setter(c, t), c += 1; return r } }), Object.defineProperty(u.prototype, "filter", { value: function (t) { if (this === e || null === this) throw TypeError(); var n = Object(this), i = l(n.length); if (!o(t)) throw TypeError(); for (var r = [], a = arguments[1], s = 0; s < i; s++) { var c = n._getter(s); t.call(a, c, s, n) && r.push(c) } return new this.constructor(r) } }), Object.defineProperty(u.prototype, "find", { value: function (t) { var n = a(this), i = l(n.length); if (!o(t)) throw TypeError(); for (var r = arguments.length > 1 ? arguments[1] : e, s = 0; s < i;) { var c = n._getter(s), u = t.call(r, c, s, n); if (Boolean(u)) return c; ++s } return e } }), Object.defineProperty(u.prototype, "findIndex", { value: function (t) { var n = a(this), i = l(n.length); if (!o(t)) throw TypeError(); for (var r = arguments.length > 1 ? arguments[1] : e, s = 0; s < i;) { var c = n._getter(s), u = t.call(r, c, s, n); if (Boolean(u)) return s; ++s } return -1 } }), Object.defineProperty(u.prototype, "forEach", { value: function (t) { if (this === e || null === this) throw TypeError(); var n = Object(this), i = l(n.length); if (!o(t)) throw TypeError(); for (var r = arguments[1], a = 0; a < i; a++)t.call(r, n._getter(a), a, n) } }), Object.defineProperty(u.prototype, "indexOf", { value: function (t) { if (this === e || null === this) throw TypeError(); var n = Object(this), i = l(n.length); if (0 === i) return -1; var r = 0; if (arguments.length > 0 && ((r = Number(arguments[1])) != r ? r = 0 : 0 !== r && r !== 1 / 0 && r !== -1 / 0 && (r = (r > 0 || -1) * p(f(r)))), r >= i) return -1; for (var o = r >= 0 ? r : g(i - f(r), 0); o < i; o++)if (n._getter(o) === t) return o; return -1 } }), Object.defineProperty(u.prototype, "join", { value: function (t) { if (this === e || null === this) throw TypeError(); for (var n = Object(this), i = l(n.length), r = Array(i), o = 0; o < i; ++o)r[o] = n._getter(o); return r.join(t === e ? "," : t) } }), Object.defineProperty(u.prototype, "lastIndexOf", { value: function (t) { if (this === e || null === this) throw TypeError(); var n = Object(this), i = l(n.length); if (0 === i) return -1; var r = i; arguments.length > 1 && ((r = Number(arguments[1])) != r ? r = 0 : 0 !== r && r !== 1 / 0 && r !== -1 / 0 && (r = (r > 0 || -1) * p(f(r)))); for (var o = r >= 0 ? y(r, i - 1) : i - f(r); o >= 0; o--)if (n._getter(o) === t) return o; return -1 } }), Object.defineProperty(u.prototype, "map", { value: function (t) { if (this === e || null === this) throw TypeError(); var n = Object(this), i = l(n.length); if (!o(t)) throw TypeError(); var r = []; r.length = i; for (var a = arguments[1], s = 0; s < i; s++)r[s] = t.call(a, n._getter(s), s, n); return new this.constructor(r) } }), Object.defineProperty(u.prototype, "reduce", { value: function (t) { if (this === e || null === this) throw TypeError(); var n = Object(this), i = l(n.length); if (!o(t)) throw TypeError(); if (0 === i && 1 === arguments.length) throw TypeError(); var r, a = 0; for (r = arguments.length >= 2 ? arguments[1] : n._getter(a++); a < i;)r = t.call(e, r, n._getter(a), a, n), a++; return r } }), Object.defineProperty(u.prototype, "reduceRight", { value: function (t) { if (this === e || null === this) throw TypeError(); var n = Object(this), i = l(n.length); if (!o(t)) throw TypeError(); if (0 === i && 1 === arguments.length) throw TypeError(); var r, a = i - 1; for (r = arguments.length >= 2 ? arguments[1] : n._getter(a--); a >= 0;)r = t.call(e, r, n._getter(a), a, n), a--; return r } }), Object.defineProperty(u.prototype, "reverse", { value: function () { if (this === e || null === this) throw TypeError(); for (var t = Object(this), n = l(t.length), i = p(n / 2), r = 0, o = n - 1; r < i; ++r, --o) { var a = t._getter(r); t._setter(r, t._getter(o)), t._setter(o, a) } return t } }), Object.defineProperty(u.prototype, "set", { value: function (t, e) { if (arguments.length < 1) throw SyntaxError("Not enough arguments"); var n, i, r, o, a, s, c, u, h, f; if ("object" == typeof arguments[0] && arguments[0].constructor === this.constructor) { if (n = arguments[0], (r = l(arguments[1])) + n.length > this.length) throw RangeError("Offset plus length of array is out of range"); if (u = this.byteOffset + r * this.BYTES_PER_ELEMENT, h = n.length * this.BYTES_PER_ELEMENT, n.buffer === this.buffer) { for (f = [], a = 0, s = n.byteOffset; a < h; a += 1, s += 1)f[a] = n.buffer._bytes[s]; for (a = 0, c = u; a < h; a += 1, c += 1)this.buffer._bytes[c] = f[a] } else for (a = 0, s = n.byteOffset, c = u; a < h; a += 1, s += 1, c += 1)this.buffer._bytes[c] = n.buffer._bytes[s] } else { if ("object" != typeof arguments[0] || void 0 === arguments[0].length) throw TypeError("Unexpected argument type(s)"); if (o = l((i = arguments[0]).length), (r = l(arguments[1])) + o > this.length) throw RangeError("Offset plus length of array is out of range"); for (a = 0; a < o; a += 1)s = i[a], this._setter(r + a, Number(s)) } } }), Object.defineProperty(u.prototype, "slice", { value: function (t, n) { for (var i = a(this), r = l(i.length), o = s(t), c = o < 0 ? g(r + o, 0) : y(o, r), u = n === e ? r : s(n), h = u < 0 ? g(r + u, 0) : y(u, r), f = h - c, p = new (0, i.constructor)(f), d = 0; c < h;) { var v = i._getter(c); p._setter(d, v), ++c, ++d } return p } }), Object.defineProperty(u.prototype, "some", { value: function (t) { if (this === e || null === this) throw TypeError(); var n = Object(this), i = l(n.length); if (!o(t)) throw TypeError(); for (var r = arguments[1], a = 0; a < i; a++)if (t.call(r, n._getter(a), a, n)) return !0; return !1 } }), Object.defineProperty(u.prototype, "sort", { value: function (t) { if (this === e || null === this) throw TypeError(); for (var n = Object(this), i = l(n.length), r = Array(i), o = 0; o < i; ++o)r[o] = n._getter(o); for (t ? r.sort(t) : r.sort(), o = 0; o < i; ++o)n._setter(o, r[o]); return n } }), Object.defineProperty(u.prototype, "subarray", { value: function (t, e) { function n(t, e, n) { return t < e ? e : t > n ? n : t } t = s(t), e = s(e), arguments.length < 1 && (t = 0), arguments.length < 2 && (e = this.length), t < 0 && (t = this.length + t), e < 0 && (e = this.length + e), t = n(t, 0, this.length); var i = (e = n(e, 0, this.length)) - t; return i < 0 && (i = 0), new this.constructor(this.buffer, this.byteOffset + t * this.BYTES_PER_ELEMENT, i) } }); var v = d(1, T, w), m = d(1, O, x), b = d(1, C, x), S = d(2, _, A), L = d(2, R, P), J = d(4, E, j), q = d(4, N, k), M = d(4, H, B), V = d(8, U, I); t.Int8Array = t.Int8Array || v, t.Uint8Array = t.Uint8Array || m, t.Uint8ClampedArray = t.Uint8ClampedArray || b, t.Int16Array = t.Int16Array || S, t.Uint16Array = t.Uint16Array || L, t.Int32Array = t.Int32Array || J, t.Uint32Array = t.Uint32Array || q, t.Float32Array = t.Float32Array || M, t.Float64Array = t.Float64Array || V }(), function () { function n(t, e) { return o(t.get) ? t.get(e) : t[e] } var i, a = (i = new Uint16Array([4660]), 18 === n(new Uint8Array(i.buffer), 0)); function s(t, n, i) { if (!(t instanceof ArrayBuffer || "ArrayBuffer" === r(t))) throw TypeError(); if ((n = l(n)) > t.byteLength) throw RangeError("byteOffset out of range"); if (n + (i = i === e ? t.byteLength - n : l(i)) > t.byteLength) throw RangeError("byteOffset and length reference an area beyond the end of the buffer"); Object.defineProperty(this, "buffer", { value: t }), Object.defineProperty(this, "byteLength", { value: i }), Object.defineProperty(this, "byteOffset", { value: n }) } function c(t) { return function (e, i) { if ((e = l(e)) + t.BYTES_PER_ELEMENT > this.byteLength) throw RangeError("Array index out of range"); e += this.byteOffset; for (var r = new Uint8Array(this.buffer, e, t.BYTES_PER_ELEMENT), o = [], s = 0; s < t.BYTES_PER_ELEMENT; s += 1)o.push(n(r, s)); return Boolean(i) === Boolean(a) && o.reverse(), n(new t(new Uint8Array(o).buffer), 0) } } function u(t) { return function (e, i, r) { if ((e = l(e)) + t.BYTES_PER_ELEMENT > this.byteLength) throw RangeError("Array index out of range"); var o, s = new t([i]), c = new Uint8Array(s.buffer), u = []; for (o = 0; o < t.BYTES_PER_ELEMENT; o += 1)u.push(n(c, o)); Boolean(r) === Boolean(a) && u.reverse(), new Uint8Array(this.buffer, e, t.BYTES_PER_ELEMENT).set(u) } } Object.defineProperty(s.prototype, "getUint8", { value: c(Uint8Array) }), Object.defineProperty(s.prototype, "getInt8", { value: c(Int8Array) }), Object.defineProperty(s.prototype, "getUint16", { value: c(Uint16Array) }), Object.defineProperty(s.prototype, "getInt16", { value: c(Int16Array) }), Object.defineProperty(s.prototype, "getUint32", { value: c(Uint32Array) }), Object.defineProperty(s.prototype, "getInt32", { value: c(Int32Array) }), Object.defineProperty(s.prototype, "getFloat32", { value: c(Float32Array) }), Object.defineProperty(s.prototype, "getFloat64", { value: c(Float64Array) }), Object.defineProperty(s.prototype, "setUint8", { value: u(Uint8Array) }), Object.defineProperty(s.prototype, "setInt8", { value: u(Int8Array) }), Object.defineProperty(s.prototype, "setUint16", { value: u(Uint16Array) }), Object.defineProperty(s.prototype, "setInt16", { value: u(Int16Array) }), Object.defineProperty(s.prototype, "setUint32", { value: u(Uint32Array) }), Object.defineProperty(s.prototype, "setInt32", { value: u(Int32Array) }), Object.defineProperty(s.prototype, "setFloat32", { value: u(Float32Array) }), Object.defineProperty(s.prototype, "setFloat64", { value: u(Float64Array) }), t.DataView = t.DataView || s }() }(self), function (t) { "use strict"; function e(t, e) { return (t = 0 | t || 0) < 0 ? Math.max(t + e, 0) : Math.min(t, e) } ArrayBuffer.prototype.slice || (ArrayBuffer.prototype.slice = function (t, n) { var i = this.byteLength, r = e(t, i), o = i; if (void 0 !== n && (o = e(n, i)), r > o) return new ArrayBuffer(0); var a = o - r, s = new ArrayBuffer(a), l = new Uint8Array(s), c = new Uint8Array(this, r, a); return l.set(c), s }) }(), "undefined" != typeof module && module.exports && (this["encoding-indexes"] = require("./encoding-indexes.js")["encoding-indexes"]), function (t) { "use strict"; function e(t, e, n) { return e <= t && t <= n } var n = Math.floor; function i(t) { if (void 0 === t) return {}; if (t === Object(t)) return t; throw TypeError("Could not convert argument to dictionary") } function r(t) { return 0 <= t && t <= 127 } var o = r, a = -1; function s(t) { this.tokens = [].slice.call(t), this.tokens.reverse() } s.prototype = { endOfStream: function () { return !this.tokens.length }, read: function () { return this.tokens.length ? this.tokens.pop() : a }, prepend: function (t) { if (Array.isArray(t)) for (var e = t; e.length;)this.tokens.push(e.pop()); else this.tokens.push(t) }, push: function (t) { if (Array.isArray(t)) for (var e = t; e.length;)this.tokens.unshift(e.shift()); else this.tokens.unshift(t) } }; var l = -1; function c(t, e) { if (t) throw TypeError("Decoder error"); return e || 65533 } function u(t) { throw TypeError("The code point " + t + " could not be encoded.") } function h(t) { return t = String(t).trim().toLowerCase(), Object.prototype.hasOwnProperty.call(p, t) ? p[t] : null } var f = [{ encodings: [{ labels: ["unicode-1-1-utf-8", "utf-8", "utf8"], name: "UTF-8" }], heading: "The Encoding" }, { encodings: [{ labels: ["866", "cp866", "csibm866", "ibm866"], name: "IBM866" }, { labels: ["csisolatin2", "iso-8859-2", "iso-ir-101", "iso8859-2", "iso88592", "iso_8859-2", "iso_8859-2:1987", "l2", "latin2"], name: "ISO-8859-2" }, { labels: ["csisolatin3", "iso-8859-3", "iso-ir-109", "iso8859-3", "iso88593", "iso_8859-3", "iso_8859-3:1988", "l3", "latin3"], name: "ISO-8859-3" }, { labels: ["csisolatin4", "iso-8859-4", "iso-ir-110", "iso8859-4", "iso88594", "iso_8859-4", "iso_8859-4:1988", "l4", "latin4"], name: "ISO-8859-4" }, { labels: ["csisolatincyrillic", "cyrillic", "iso-8859-5", "iso-ir-144", "iso8859-5", "iso88595", "iso_8859-5", "iso_8859-5:1988"], name: "ISO-8859-5" }, { labels: ["arabic", "asmo-708", "csiso88596e", "csiso88596i", "csisolatinarabic", "ecma-114", "iso-8859-6", "iso-8859-6-e", "iso-8859-6-i", "iso-ir-127", "iso8859-6", "iso88596", "iso_8859-6", "iso_8859-6:1987"], name: "ISO-8859-6" }, { labels: ["csisolatingreek", "ecma-118", "elot_928", "greek", "greek8", "iso-8859-7", "iso-ir-126", "iso8859-7", "iso88597", "iso_8859-7", "iso_8859-7:1987", "sun_eu_greek"], name: "ISO-8859-7" }, { labels: ["csiso88598e", "csisolatinhebrew", "hebrew", "iso-8859-8", "iso-8859-8-e", "iso-ir-138", "iso8859-8", "iso88598", "iso_8859-8", "iso_8859-8:1988", "visual"], name: "ISO-8859-8" }, { labels: ["csiso88598i", "iso-8859-8-i", "logical"], name: "ISO-8859-8-I" }, { labels: ["csisolatin6", "iso-8859-10", "iso-ir-157", "iso8859-10", "iso885910", "l6", "latin6"], name: "ISO-8859-10" }, { labels: ["iso-8859-13", "iso8859-13", "iso885913"], name: "ISO-8859-13" }, { labels: ["iso-8859-14", "iso8859-14", "iso885914"], name: "ISO-8859-14" }, { labels: ["csisolatin9", "iso-8859-15", "iso8859-15", "iso885915", "iso_8859-15", "l9"], name: "ISO-8859-15" }, { labels: ["iso-8859-16"], name: "ISO-8859-16" }, { labels: ["cskoi8r", "koi", "koi8", "koi8-r", "koi8_r"], name: "KOI8-R" }, { labels: ["koi8-ru", "koi8-u"], name: "KOI8-U" }, { labels: ["csmacintosh", "mac", "macintosh", "x-mac-roman"], name: "macintosh" }, { labels: ["dos-874", "iso-8859-11", "iso8859-11", "iso885911", "tis-620", "windows-874"], name: "windows-874" }, { labels: ["cp1250", "windows-1250", "x-cp1250"], name: "windows-1250" }, { labels: ["cp1251", "windows-1251", "x-cp1251"], name: "windows-1251" }, { labels: ["ansi_x3.4-1968", "ascii", "cp1252", "cp819", "csisolatin1", "ibm819", "iso-8859-1", "iso-ir-100", "iso8859-1", "iso88591", "iso_8859-1", "iso_8859-1:1987", "l1", "latin1", "us-ascii", "windows-1252", "x-cp1252"], name: "windows-1252" }, { labels: ["cp1253", "windows-1253", "x-cp1253"], name: "windows-1253" }, { labels: ["cp1254", "csisolatin5", "iso-8859-9", "iso-ir-148", "iso8859-9", "iso88599", "iso_8859-9", "iso_8859-9:1989", "l5", "latin5", "windows-1254", "x-cp1254"], name: "windows-1254" }, { labels: ["cp1255", "windows-1255", "x-cp1255"], name: "windows-1255" }, { labels: ["cp1256", "windows-1256", "x-cp1256"], name: "windows-1256" }, { labels: ["cp1257", "windows-1257", "x-cp1257"], name: "windows-1257" }, { labels: ["cp1258", "windows-1258", "x-cp1258"], name: "windows-1258" }, { labels: ["x-mac-cyrillic", "x-mac-ukrainian"], name: "x-mac-cyrillic" }], heading: "Legacy single-byte encodings" }, { encodings: [{ labels: ["chinese", "csgb2312", "csiso58gb231280", "gb2312", "gb_2312", "gb_2312-80", "gbk", "iso-ir-58", "x-gbk"], name: "GBK" }, { labels: ["gb18030"], name: "gb18030" }], heading: "Legacy multi-byte Chinese (simplified) encodings" }, { encodings: [{ labels: ["big5", "big5-hkscs", "cn-big5", "csbig5", "x-x-big5"], name: "Big5" }], heading: "Legacy multi-byte Chinese (traditional) encodings" }, { encodings: [{ labels: ["cseucpkdfmtjapanese", "euc-jp", "x-euc-jp"], name: "EUC-JP" }, { labels: ["csiso2022jp", "iso-2022-jp"], name: "ISO-2022-JP" }, { labels: ["csshiftjis", "ms932", "ms_kanji", "shift-jis", "shift_jis", "sjis", "windows-31j", "x-sjis"], name: "Shift_JIS" }], heading: "Legacy multi-byte Japanese encodings" }, { encodings: [{ labels: ["cseuckr", "csksc56011987", "euc-kr", "iso-ir-149", "korean", "ks_c_5601-1987", "ks_c_5601-1989", "ksc5601", "ksc_5601", "windows-949"], name: "EUC-KR" }], heading: "Legacy multi-byte Korean encodings" }, { encodings: [{ labels: ["csiso2022kr", "hz-gb-2312", "iso-2022-cn", "iso-2022-cn-ext", "iso-2022-kr"], name: "replacement" }, { labels: ["utf-16be"], name: "UTF-16BE" }, { labels: ["utf-16", "utf-16le"], name: "UTF-16LE" }, { labels: ["x-user-defined"], name: "x-user-defined" }], heading: "Legacy miscellaneous encodings" }], p = {}; f.forEach(function (t) { t.encodings.forEach(function (t) { t.labels.forEach(function (e) { p[e] = t }) }) }); var d = {}, g = {}; function y(t, e) { return e && e[t] || null } function v(t, e) { var n = e.indexOf(t); return -1 === n ? null : n } function m(e) { if (!("encoding-indexes" in t)) throw Error("Indexes missing. Did you forget to include encoding-indexes.js?"); return t["encoding-indexes"][e] } var b = "utf-8"; function S(t, e) { if (!(this instanceof S)) throw TypeError("Called as a function. Did you forget 'new'?"); t = void 0 !== t ? String(t) : b, e = i(e), this._encoding = null, this._decoder = null, this._ignoreBOM = !1, this._BOMseen = !1, this._error_mode = "replacement", this._do_not_flush = !1; var n = h(t); if (null === n || "replacement" === n.name) throw RangeError("Unknown encoding: " + t); if (!g[n.name]) throw Error("Decoder not present. Did you forget to include encoding-indexes.js?"); return this._encoding = n, Boolean(e.fatal) && (this._error_mode = "fatal"), Boolean(e.ignoreBOM) && (this._ignoreBOM = !0), Object.defineProperty || (this.encoding = this._encoding.name.toLowerCase(), this.fatal = "fatal" === this._error_mode, this.ignoreBOM = this._ignoreBOM), this } function T(e, n) { if (!(this instanceof T)) throw TypeError("Called as a function. Did you forget 'new'?"); n = i(n), this._encoding = null, this._encoder = null, this._do_not_flush = !1, this._fatal = Boolean(n.fatal) ? "fatal" : "replacement"; if (Boolean(n.NONSTANDARD_allowLegacyEncoding)) { var r = h(e = void 0 !== e ? String(e) : b); if (null === r || "replacement" === r.name) throw RangeError("Unknown encoding: " + e); if (!d[r.name]) throw Error("Encoder not present. Did you forget to include encoding-indexes.js?"); this._encoding = r } else this._encoding = h("utf-8"), void 0 !== e && "console" in t && console.warn("TextEncoder constructor called with encoding label, which is ignored."); return Object.defineProperty || (this.encoding = this._encoding.name.toLowerCase()), this } function w(t) { var n = t.fatal, i = 0, r = 0, o = 0, s = 128, u = 191; this.handler = function (t, h) { if (h === a && 0 !== o) return o = 0, c(n); if (h === a) return l; if (0 === o) { if (e(h, 0, 127)) return h; if (e(h, 194, 223)) o = 1, i = h - 192; else if (e(h, 224, 239)) 224 === h && (s = 160), 237 === h && (u = 159), o = 2, i = h - 224; else { if (!e(h, 240, 244)) return c(n); 240 === h && (s = 144), 244 === h && (u = 143), o = 3, i = h - 240 } return i <<= 6 * o, null } if (!e(h, s, u)) return i = o = r = 0, s = 128, u = 191, t.prepend(h), c(n); if (s = 128, u = 191, i += h - 128 << 6 * (o - (r += 1)), r !== o) return null; var f = i; return i = o = r = 0, f } } function O(t) { t.fatal; this.handler = function (t, n) { if (n === a) return l; if (e(n, 0, 127)) return n; var i, r; e(n, 128, 2047) ? (i = 1, r = 192) : e(n, 2048, 65535) ? (i = 2, r = 224) : e(n, 65536, 1114111) && (i = 3, r = 240); for (var o = [(n >> 6 * i) + r]; i > 0;) { var s = n >> 6 * (i - 1); o.push(128 | 63 & s), i -= 1 } return o } } function x(t, e) { var n = e.fatal; this.handler = function (e, i) { if (i === a) return l; if (r(i)) return i; var o = t[i - 128]; return null === o ? c(n) : o } } function C(t, e) { e.fatal; this.handler = function (e, n) { if (n === a) return l; if (o(n)) return n; var i = v(n, t); return null === i && u(n), i + 128 } } function _(t) { var n = t.fatal, i = 0, o = 0, s = 0; this.handler = function (t, u) { if (u === a && 0 === i && 0 === o && 0 === s) return l; var h; if (u !== a || 0 === i && 0 === o && 0 === s || (i = 0, o = 0, s = 0, c(n)), 0 !== s) { h = null, e(u, 48, 57) && (h = function (t) { if (t > 39419 && t < 189e3 || t > 1237575) return null; if (7457 === t) return 59335; var e, n = 0, i = 0, r = m("gb18030"); for (e = 0; e < r.length; ++e) { var o = r[e]; if (!(o[0] <= t)) break; n = o[0], i = o[1] } return i + t - n }(10 * (126 * (10 * (i - 129) + (o - 48)) + (s - 129)) + u - 48)); var f = [o, s, u]; return i = 0, o = 0, s = 0, null === h ? (t.prepend(f), c(n)) : h } if (0 !== o) return e(u, 129, 254) ? (s = u, null) : (t.prepend([o, u]), i = 0, o = 0, c(n)); if (0 !== i) { if (e(u, 48, 57)) return o = u, null; var p = i, d = null; i = 0; var g = u < 127 ? 64 : 65; return (e(u, 64, 126) || e(u, 128, 254)) && (d = 190 * (p - 129) + (u - g)), null === (h = null === d ? null : y(d, m("gb18030"))) && r(u) && t.prepend(u), null === h ? c(n) : h } return r(u) ? u : 128 === u ? 8364 : e(u, 129, 254) ? (i = u, null) : c(n) } } function A(t, e) { t.fatal; this.handler = function (t, i) { if (i === a) return l; if (o(i)) return i; if (58853 === i) return u(i); if (e && 8364 === i) return 128; var r = v(i, m("gb18030")); if (null !== r) { var s = r % 190; return [n(r / 190) + 129, s + (s < 63 ? 64 : 65)] } if (e) return u(i); r = function (t) { if (59335 === t) return 7457; var e, n = 0, i = 0, r = m("gb18030"); for (e = 0; e < r.length; ++e) { var o = r[e]; if (!(o[1] <= t)) break; n = o[1], i = o[0] } return i + t - n }(i); var c = n(r / 10 / 126 / 10), h = n((r -= 10 * c * 126 * 10) / 10 / 126), f = n((r -= 10 * h * 126) / 10); return [c + 129, h + 48, f + 129, r - 10 * f + 48] } } function R(t) { var n = t.fatal, i = 0; this.handler = function (t, o) { if (o === a && 0 !== i) return i = 0, c(n); if (o === a && 0 === i) return l; if (0 !== i) { var s = i, u = null; i = 0; var h = o < 127 ? 64 : 98; switch ((e(o, 64, 126) || e(o, 161, 254)) && (u = 157 * (s - 129) + (o - h)), u) { case 1133: return [202, 772]; case 1135: return [202, 780]; case 1164: return [234, 772]; case 1166: return [234, 780] }var f = null === u ? null : y(u, m("big5")); return null === f && r(o) && t.prepend(o), null === f ? c(n) : f } return r(o) ? o : e(o, 129, 254) ? (i = o, null) : c(n) } } function P(t) { t.fatal; this.handler = function (t, e) { if (e === a) return l; if (o(e)) return e; var i = function (t) { var e = m("big5"); return 9552 === t || 9566 === t || 9569 === t || 9578 === t || 21313 === t || 21317 === t ? e.lastIndexOf(t) : v(t, e) }(e); if (null === i) return u(e); var r = n(i / 157) + 129; if (r < 161) return u(e); var s = i % 157; return [r, s + (s < 63 ? 64 : 98)] } } function E(t) { var n = t.fatal, i = !1, o = 0; this.handler = function (t, s) { if (s === a && 0 !== o) return o = 0, c(n); if (s === a && 0 === o) return l; if (142 === o && e(s, 161, 223)) return o = 0, 65377 + s - 161; if (143 === o && e(s, 161, 254)) return i = !0, o = s, null; if (0 !== o) { var u = o; o = 0; var h = null; return e(u, 161, 254) && e(s, 161, 254) && (h = y(94 * (u - 161) + (s - 161), m(i ? "jis0212" : "jis0208"))), i = !1, e(s, 161, 254) || t.prepend(s), null === h ? c(n) : h } return r(s) ? s : 142 === s || 143 === s || e(s, 161, 254) ? (o = s, null) : c(n) } } function j(t) { t.fatal; this.handler = function (t, i) { if (i === a) return l; if (o(i)) return i; if (165 === i) return 92; if (8254 === i) return 126; if (e(i, 65377, 65439)) return [142, i - 65377 + 161]; 8722 === i && (i = 65293); var r = v(i, m("jis0208")); return null === r ? u(i) : [n(r / 94) + 161, r % 94 + 161] } } function N(t) { var n = t.fatal, i = 0, r = 1, o = 2, s = 3, u = 4, h = 5, f = 6, p = i, d = i, g = 0, v = !1; this.handler = function (t, b) { switch (p) { default: case i: return 27 === b ? (p = h, null) : e(b, 0, 127) && 14 !== b && 15 !== b && 27 !== b ? (v = !1, b) : b === a ? l : (v = !1, c(n)); case r: return 27 === b ? (p = h, null) : 92 === b ? (v = !1, 165) : 126 === b ? (v = !1, 8254) : e(b, 0, 127) && 14 !== b && 15 !== b && 27 !== b && 92 !== b && 126 !== b ? (v = !1, b) : b === a ? l : (v = !1, c(n)); case o: return 27 === b ? (p = h, null) : e(b, 33, 95) ? (v = !1, 65377 + b - 33) : b === a ? l : (v = !1, c(n)); case s: return 27 === b ? (p = h, null) : e(b, 33, 126) ? (v = !1, g = b, p = u, null) : b === a ? l : (v = !1, c(n)); case u: if (27 === b) return p = h, c(n); if (e(b, 33, 126)) { p = s; var S = y(94 * (g - 33) + b - 33, m("jis0208")); return null === S ? c(n) : S } return b === a ? (p = s, t.prepend(b), c(n)) : (p = s, c(n)); case h: return 36 === b || 40 === b ? (g = b, p = f, null) : (t.prepend(b), v = !1, p = d, c(n)); case f: var T = g; g = 0; var w = null; if (40 === T && 66 === b && (w = i), 40 === T && 74 === b && (w = r), 40 === T && 73 === b && (w = o), 36 !== T || 64 !== b && 66 !== b || (w = s), null !== w) { p = p = w; var O = v; return v = !0, O ? c(n) : null } return t.prepend([T, b]), v = !1, p = d, c(n) } } } function k(t) { t.fatal; var e = 0, i = 1, r = 2, s = e; this.handler = function (t, c) { if (c === a && s !== e) return t.prepend(c), s = e, [27, 40, 66]; if (c === a && s === e) return l; if (!(s !== e && s !== i || 14 !== c && 15 !== c && 27 !== c)) return u(65533); if (s === e && o(c)) return c; if (s === i && (o(c) && 92 !== c && 126 !== c || 165 == c || 8254 == c)) { if (o(c)) return c; if (165 === c) return 92; if (8254 === c) return 126 } if (o(c) && s !== e) return t.prepend(c), s = e, [27, 40, 66]; if ((165 === c || 8254 === c) && s !== i) return t.prepend(c), s = i, [27, 40, 74]; 8722 === c && (c = 65293); var h = v(c, m("jis0208")); return null === h ? u(c) : s !== r ? (t.prepend(c), s = r, [27, 36, 66]) : [n(h / 94) + 33, h % 94 + 33] } } function L(t) { var n = t.fatal, i = 0; this.handler = function (t, o) { if (o === a && 0 !== i) return i = 0, c(n); if (o === a && 0 === i) return l; if (0 !== i) { var s = i, u = null; i = 0; var h = o < 127 ? 64 : 65, f = s < 160 ? 129 : 193; (e(o, 64, 126) || e(o, 128, 252)) && (u = 188 * (s - f) + o - h); var p = null === u ? null : y(u, m("jis0208")); return null === p && null !== u && e(u, 8836, 10528) ? 57344 + u - 8836 : (null === p && r(o) && t.prepend(o), null === p ? c(n) : p) } return r(o) || 128 === o ? o : e(o, 161, 223) ? 65377 + o - 161 : e(o, 129, 159) || e(o, 224, 252) ? (i = o, null) : c(n) } } function J(t) { t.fatal; this.handler = function (t, i) { if (i === a) return l; if (o(i) || 128 === i) return i; if (165 === i) return 92; if (8254 === i) return 126; if (e(i, 65377, 65439)) return i - 65377 + 161; 8722 === i && (i = 65293); var r = function (t) { var n = v(t, m("jis0208")); return null === n || e(n, 8272, 8835) ? null : n }(i); if (null === r) return u(i); var s = n(r / 188), c = r % 188; return [s + (s < 31 ? 129 : 193), c + (c < 63 ? 64 : 65)] } } function I(t) { var n = t.fatal, i = 0; this.handler = function (t, o) { if (o === a && 0 !== i) return i = 0, c(n); if (o === a && 0 === i) return l; if (0 !== i) { var s = i, u = null; i = 0, e(o, 65, 254) && (u = 190 * (s - 129) + (o - 65)); var h = null === u ? null : y(u, m("euc-kr")); return null === u && r(o) && t.prepend(o), null === h ? c(n) : h } return r(o) ? o : e(o, 129, 254) ? (i = o, null) : c(n) } } function U(t) { t.fatal; this.handler = function (t, e) { if (e === a) return l; if (o(e)) return e; var i = v(e, m("euc-kr")); return null === i ? u(e) : [n(i / 190) + 129, i % 190 + 65] } } function B(t, e) { var n = t >> 8, i = 255 & t; return e ? [n, i] : [i, n] } function H(t, n) { var i = n.fatal, r = null, o = null; this.handler = function (n, s) { if (s === a && (null !== r || null !== o)) return c(i); if (s === a && null === r && null === o) return l; if (null === r) return r = s, null; var u; if (u = t ? (r << 8) + s : (s << 8) + r, r = null, null !== o) { var h = o; return o = null, e(u, 56320, 57343) ? 65536 + 1024 * (h - 55296) + (u - 56320) : (n.prepend(B(u, t)), c(i)) } return e(u, 55296, 56319) ? (o = u, null) : e(u, 56320, 57343) ? c(i) : u } } function q(t, n) { n.fatal; this.handler = function (n, i) { if (i === a) return l; if (e(i, 0, 65535)) return B(i, t); var r = B(55296 + (i - 65536 >> 10), t), o = B(56320 + (i - 65536 & 1023), t); return r.concat(o) } } function M(t) { t.fatal; this.handler = function (t, e) { return e === a ? l : r(e) ? e : 63360 + e - 128 } } function V(t) { t.fatal; this.handler = function (t, n) { return n === a ? l : o(n) ? n : e(n, 63360, 63487) ? n - 63360 + 128 : u(n) } } Object.defineProperty && (Object.defineProperty(S.prototype, "encoding", { get: function () { return this._encoding.name.toLowerCase() } }), Object.defineProperty(S.prototype, "fatal", { get: function () { return "fatal" === this._error_mode } }), Object.defineProperty(S.prototype, "ignoreBOM", { get: function () { return this._ignoreBOM } })), S.prototype.decode = function (t, e) { var n; n = "object" == typeof t && t instanceof ArrayBuffer ? new Uint8Array(t) : "object" == typeof t && "buffer" in t && t.buffer instanceof ArrayBuffer ? new Uint8Array(t.buffer, t.byteOffset, t.byteLength) : new Uint8Array(0), e = i(e), this._do_not_flush || (this._decoder = g[this._encoding.name]({ fatal: "fatal" === this._error_mode }), this._BOMseen = !1), this._do_not_flush = Boolean(e.stream); for (var r, o = new s(n), c = []; ;) { var u = o.read(); if (u === a) break; if ((r = this._decoder.handler(o, u)) === l) break; null !== r && (Array.isArray(r) ? c.push.apply(c, r) : c.push(r)) } if (!this._do_not_flush) { do { if ((r = this._decoder.handler(o, o.read())) === l) break; null !== r && (Array.isArray(r) ? c.push.apply(c, r) : c.push(r)) } while (!o.endOfStream()); this._decoder = null } return function (t) { var e, n; return e = ["UTF-8", "UTF-16LE", "UTF-16BE"], n = this._encoding.name, -1 === e.indexOf(n) || this._ignoreBOM || this._BOMseen || (t.length > 0 && 65279 === t[0] ? (this._BOMseen = !0, t.shift()) : t.length > 0 && (this._BOMseen = !0)), function (t) { for (var e = "", n = 0; n < t.length; ++n) { var i = t[n]; i <= 65535 ? e += String.fromCharCode(i) : (i -= 65536, e += String.fromCharCode(55296 + (i >> 10), 56320 + (1023 & i))) } return e }(t) }.call(this, c) }, Object.defineProperty && Object.defineProperty(T.prototype, "encoding", { get: function () { return this._encoding.name.toLowerCase() } }), T.prototype.encode = function (t, e) { t = t ? String(t) : "", e = i(e), this._do_not_flush || (this._encoder = d[this._encoding.name]({ fatal: "fatal" === this._fatal })), this._do_not_flush = Boolean(e.stream); for (var n, r = new s(function (t) { for (var e = String(t), n = e.length, i = 0, r = []; i < n;) { var o = e.charCodeAt(i); if (o < 55296 || o > 57343) r.push(o); else if (56320 <= o && o <= 57343) r.push(65533); else if (55296 <= o && o <= 56319) if (i === n - 1) r.push(65533); else { var a = t.charCodeAt(i + 1); if (56320 <= a && a <= 57343) { var s = 1023 & o, l = 1023 & a; r.push(65536 + (s << 10) + l), i += 1 } else r.push(65533) } i += 1 } return r }(t)), o = []; ;) { var c = r.read(); if (c === a) break; if ((n = this._encoder.handler(r, c)) === l) break; Array.isArray(n) ? o.push.apply(o, n) : o.push(n) } if (!this._do_not_flush) { for (; (n = this._encoder.handler(r, r.read())) !== l;)Array.isArray(n) ? o.push.apply(o, n) : o.push(n); this._encoder = null } return new Uint8Array(o) }, d["UTF-8"] = function (t) { return new O(t) }, g["UTF-8"] = function (t) { return new w(t) }, "encoding-indexes" in t && f.forEach(function (t) { "Legacy single-byte encodings" === t.heading && t.encodings.forEach(function (t) { var e = t.name, n = m(e.toLowerCase()); g[e] = function (t) { return new x(n, t) }, d[e] = function (t) { return new C(n, t) } }) }), g.GBK = function (t) { return new _(t) }, d.GBK = function (t) { return new A(t, !0) }, d.gb18030 = function (t) { return new A(t) }, g.gb18030 = function (t) { return new _(t) }, d.Big5 = function (t) { return new P(t) }, g.Big5 = function (t) { return new R(t) }, d["EUC-JP"] = function (t) { return new j(t) }, g["EUC-JP"] = function (t) { return new E(t) }, d["ISO-2022-JP"] = function (t) { return new k(t) }, g["ISO-2022-JP"] = function (t) { return new N(t) }, d.Shift_JIS = function (t) { return new J(t) }, g.Shift_JIS = function (t) { return new L(t) }, d["EUC-KR"] = function (t) { return new U(t) }, g["EUC-KR"] = function (t) { return new I(t) }, d["UTF-16BE"] = function (t) { return new q(!0, t) }, g["UTF-16BE"] = function (t) { return new H(!0, t) }, d["UTF-16LE"] = function (t) { return new q(!1, t) }, g["UTF-16LE"] = function (t) { return new H(!1, t) }, d["x-user-defined"] = function (t) { return new V(t) }, g["x-user-defined"] = function (t) { return new M(t) }, t.TextEncoder || (t.TextEncoder = T), t.TextDecoder || (t.TextDecoder = S), "undefined" != typeof module && module.exports && (module.exports = { TextEncoder: t.TextEncoder, TextDecoder: t.TextDecoder, EncodingIndexes: t["encoding-indexes"] }) }(this);