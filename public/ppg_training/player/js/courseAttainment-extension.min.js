(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{1321:function(e,t,n){"use strict";const{registerReducer:o,registerEpics:i}=n(4),r=n(1377),s=n(2245),{courseAttainmentSetupEpic:a,attainmentComponentCompletedEpic:c,attainmentAchievementComponentCompletedEpic:l,attainmentCompletionEpic:m,registerTrackingMapEpic:p,setVariableOnProgressChangedEpic:u}=n(2246);o("courseAttainment",s),i(a,c,l,m,p,u,r("courseAttainment"))},1377:function(e,t,n){"use strict";const o=n(8),{Observable:i}=n(5),{setLocationReadyState:r,PUSH_LOCATION:s}=n(9),a=n(303),c=n(218);e.exports=(e,t)=>(n,l)=>n.filter(({type:t})=>{if(t!==s)return;const{navigationStatus:n,path:o}=l.getState().location;return"plugin"===n&&o[0]===e}).switchMap(()=>{const n=l.getState(),{device:s,course:m}=n;let p;if(p=t?t(n):o(m,["_"+e,"_heroImage"]),!p||!p._graphic)return i.empty();const u=a(p._graphic.src,p._graphic.srcAdvanced,!0);return u?i.concat(i.of(r(!1)),i.bindCallback(c)(u,!1).map(()=>r(!0))):i.empty()})},1379:function(e,t,n){"use strict";const o=n(8),{store:i}=n(4);e.exports=function(e,t,n){const{course:r,theme:s}=i.getState(),a=r[e],c=o(a,t),l=o(s,["_extensions",e,"_settings",t]);return c||l||n}},2245:function(e,t,n){"use strict";const o=n(32),i=n(502),r=n(10),{SETUP_APP:s}=n(9),{RESTORE_EXTENSION:a}=n(96),{COURSE_ATTAINMENT_COMPONENT_COMPLETED:c,COURSE_ATTAINMENT_ACHIEVEMENTS_UPDATED:l}=n(488),m={_isComplete:!1,_progress:0,contentCount:0};function p(e,{components:t,blocks:n,achievements:r}){switch(e._attainmentMethod){case"components":return function({_shouldUseCorrectQuestions:e},t){const n=o(t,e=>e._courseAttainment&&e._courseAttainment._isEnabled);if(!n.length)return!1;const i=o(n,t=>!!t._isComplete&&!(e&&t._isQuestionType&&!t._isCorrect));return{_isComplete:n.length===i.length,_progress:100/n.length*i.length,contentCount:n.length}}(e,t);case"blocks":return function(e,t){const n=o(e,e=>e._courseAttainment&&e._courseAttainment._isEnabled);if(!n.length)return!1;const r=o(n,e=>i(e._childrenIds,e=>t[e]._isComplete));return{_isComplete:n.length===r.length,_progress:100/n.length*r.length,contentCount:n.length}}(n,t);case"points":return function({_attainmentAttributes:e},t){const n=t&&t._points;return n&&n._isEnabled&&e?{_isComplete:n._currentPoints>=e,_progress:100/e*n._currentPoints}:{_isComplete:!1,_progress:0,contentCount:e}}(e,r);case"stars":return function({_attainmentAttributes:e},t){const n=t&&t._stars;return n&&n._isEnabled&&e?{_isComplete:n._currentStarsCollected>=e,_progress:100/e*n._currentStarsCollected}:{_isComplete:!1,_progress:0,contentCount:e}}(e,r);default:return{_isComplete:!1,_progress:0}}}e.exports=(e=m,t)=>{if(t.type===s){const n=t.payload.course._courseAttainment;return n&&n._isEnabled?r({},e,n,p(n,t.payload)):m}if(!e._isEnabled)return m;if(e._isComplete)return e;switch(t.type){case c:return"points"===e._attainmentMethod||"stars"===e._attainmentMethod?e:r({},e,p(e,t.payload));case l:return"components"===e._attainmentMethod||"blocks"===e._attainmentMethod?e:r({},e,p(e,t.payload));case a:if("courseAttainment"===t.payload.extensionName)return r({},e,t.payload.extensionData);default:return e}}},2246:function(e,t,n){"use strict";const o=n(8),i=n(10),{Observable:r}=n(5),{SETUP_APP:s}=n(9),{COMPONENT_COMPLETED:a,UPDATE_COMPONENTS:c}=n(61),{addElement:l}=n(42),{addPrompt:m}=n(95),{NavigationSideItem:p}=n(475),{updateVariable:u}=n(50),d=n(1379),{registerTrackingMap:_}=n(4),h=n(2247),{COURSE_ATTAINMENT_COMPONENT_COMPLETED:E,COURSE_ATTAINMENT_ACHIEVEMENTS_UPDATED:g,attainmentComponentCompleted:C,attainmentAchievementComponentCompleted:A,attainmentComplete:v}=n(488),y=n(2248);t.courseAttainmentSetupEpic=(e,t)=>e.filter(e=>{const n=t.getState();if(e.type!==s)return!1;const{courseAttainment:o}=n;return o&&o._isEnabled&&o._isComplete&&!o._shouldHideSummaryAndIcon}).map(()=>{const e=t.getState(),{courseAttainment:n}=e;return l({parent:"navigationSide",name:"courseAttainment",component:p,props:{link:"/courseAttainment",icon:d("_courseAttainment","_navigationIcon","license2"),label:n.title}})}),t.registerTrackingMapEpic=(e,t)=>e.filter(e=>{const n=t.getState();if(e.type!==s)return!1;const{courseAttainment:o}=n;return o&&o._isEnabled}).do(()=>{_("courseAttainment",y,"extensions")}).ignoreElements(),t.attainmentComponentCompletedEpic=(e,t)=>e.filter(e=>{const n=t.getState();if(!n.app.isDataReady||e.type!==a)return!1;const{courseAttainment:o}=n;return o&&o._isEnabled}).map(()=>{const e=i({},t.getState());return e._prevIsComplete=e.courseAttainment._isComplete,C(e)}),t.attainmentAchievementComponentCompletedEpic=(e,t)=>e.filter(e=>{const n=t.getState();if(!n.app.isDataReady||"ACHIEVEMENTS_COMPONENT_COMPLETED"!==e.type)return!1;const{courseAttainment:o}=n;return o&&o._isEnabled}).map(()=>{const e=i({},t.getState());return e._prevIsComplete=e.courseAttainment._isComplete,A(e)}),t.setVariableOnProgressChangedEpic=(e,t)=>e.ofType(E,g,s,c).filter(()=>{const{app:e,courseAttainment:n,course:{_courseAttainment:o}}=t.getState();return e.hasAppStarted&&n._isEnabled&&o._canSaveToVariable&&o._variableId}).map(()=>Math.floor(t.getState().courseAttainment._progress)).distinctUntilChanged().map(e=>{const{course:{_courseAttainment:n}}=t.getState();return u(n._variableId,e,n._variableUpdateType)}),t.attainmentCompletionEpic=(e,t)=>e.ofType(E,g).mergeMap(e=>{const n=e.payload._prevIsComplete,{theme:i,courseAttainment:s}=t.getState();if(n!==s._isComplete&&s._isComplete){const e=[v()];if(s._shouldHideNotificationPopup||e.push(m(function(e,t){let n={};e._shouldCloseWindowOnCourseAttained?(n={title:e.completionNotifyTitle,body:e.completionNotifyBody,_action:{text:e.closeWindowText,onClick:()=>{window._exitCourse()}}},e._shouldHidePromptDismissButton&&(n._dismiss={_isHidden:!0})):(n={title:e.completionNotifyTitle,body:e.completionNotifyBody},e._shouldHideSummaryAndIcon||(n._action={text:e.completionTitle,_link:{_link:"courseAttainment",_linkType:"extensions"}}));const i=o(e,"_notifyIcon"),r=o(t,"_extensions._courseAttainment._settings._notifyIcon"),s=i||r;return s&&(n._glyph={_type:"icon",_className:"ev-icon-"+s}),n}(s,i))),s._shouldHideSummaryAndIcon||(e.push(l({parent:"navigationSide",name:"courseAttainment",component:p,props:{link:"/courseAttainment",icon:d("_courseAttainment","_navigationIcon","license2"),label:s.title}})),e.push(l({parent:"router",name:"courseAttainment",path:"/courseAttainment",exact:!0,component:h}))),e.length)return r.of(...e)}return r.empty()})},2247:function(e,t,n){"use strict";const o=n(8),i=n(2),r=n(1),s=n(0),{connect:a}=n(6),c=n(7),{ContentContainer:l,HeroImage:m}=n(302),p=n(174),u=n(62),d=n(33),_=n(24),h=i({displayName:"CourseAttainment",propTypes:{courseAttainment:r.shape({title:r.string,completionBody:r.string,ariaLabel:r.string,_heroImage:r.object,_headerIcon:r.string}).isRequired,theme:r.object.isRequired,isReady:r.bool.isRequired},renderTitle(){if(this.props.courseAttainment.title)return s.createElement("div",{className:"ev-course-attainment-header-title ev-header-title"},s.createElement(_,{element:"h1",className:"ev-course-attainment-header-title-inner ev-header-title-inner",html:this.props.courseAttainment.title}))},renderContent(){if(this.props.courseAttainment.completionBody)return s.createElement("div",{className:"ev-content"},s.createElement("div",{className:"ev-content-inner"},s.createElement("div",{className:"ev-content-row"},s.createElement("div",{className:"ev-content-row-inner"},s.createElement("div",{className:"ev-component-container"},s.createElement("div",{className:"ev-component"},s.createElement("div",{className:"ev-component-inner"},s.createElement(d,{className:"ev-component-body",innerClassName:"ev-component-body-inner",body:this.props.courseAttainment.completionBody}))))))))},renderHeroImage(){const e=this.props.courseAttainment._heroImage;if(null!=e&&e._isEnabled)return s.createElement(u.Provider,{value:this.props.courseAttainment.title?2:1},s.createElement(m,{title:e.title,body:e.body,graphic:e._graphic,_contentWidth:e._contentWidth,layout:e.layout,floatingGraphic:e._floatingGraphic,parentSelector:".ev-extension-hero-container",theme:this.props.theme,isReady:this.props.isReady}))},render(){var e;const{props:t}=this,n=null===(e=t.courseAttainment)||void 0===e?void 0:e._headerIcon,i=o(t.theme,"_extensions._courseAttainment._settings._headerIcon"),r=n||i;return s.createElement(l,{region:"course attainment",className:"ev-extension ev-course-attainment",ariaLabel:t.courseAttainment.ariaLabel},s.createElement("div",{className:"ev-course-attainment-inner ev-extension-inner"},t.isReady?null:s.createElement(p,null),s.createElement("div",{className:"ev-extension-hero-container"},this.renderHeroImage()),s.createElement("div",{className:"ev-header"},s.createElement("div",{className:c("ev-header-inner ev-clearfix",{"ev-no-graphic":!r})},s.createElement("div",{className:"ev-header-left"},this.renderTitle()),r&&s.createElement("div",{className:"ev-header-right"},s.createElement("i",{className:"ev-icon ev-icon-"+r})))),this.renderContent()))}});e.exports=a(e=>({courseAttainment:e.courseAttainment,theme:e.theme,isReady:e.location.isLocationReady}))(h)},2248:function(e,t,n){"use strict";e.exports={_isComplete:{fieldKey:"_isComplete",type:"Boolean",shouldRestore:!0},_progress:{fieldKey:"_progress",type:"Number",shouldRestore:!0}}}}]);