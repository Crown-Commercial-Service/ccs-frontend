(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{1339:function(e,t,a){"use strict";const{registerReducer:i,registerEpics:n}=a(4),o=a(2355),{xapiSetupEpic:r,xapiLoadWrapperEpic:s,xapiLoadStateEpic:c,xapiComponentCompleteEpic:p,xapiTrackableChangeEpic:l,xapiTrackingChangedEpic:d,xapiCourseStatusChangedEpic:b}=a(2356);i("_xapi",o),n(r,s,c,p,l,d,b)},1618:function(e,t,a){"use strict";t.XAPI_LOAD_WRAPPER="XAPI_LOAD_WRAPPER",t.XAPI_SET_ACTIVE="XAPI_SET_ACTIVE",t.XAPI_LOAD_STATE="XAPI_LOAD_STATE",t.XAPI_TRACKABLE_CHANGE="XAPI_TRACKABLE_CHANGE",t.xapiLoadWrapper=()=>({type:t.XAPI_LOAD_WRAPPER}),t.xapiSetActive=e=>({type:t.XAPI_SET_ACTIVE,payload:e}),t.xapiLoadState=()=>({type:t.XAPI_LOAD_STATE}),t.xapiTrackableChange=e=>({type:t.XAPI_TRACKABLE_CHANGE,payload:e})},2355:function(e,t,a){"use strict";const i=a(10),n=a(304),{FETCH_COURSE_DATA:o}=a(9),{XAPI_SET_ACTIVE:r}=a(1618),s={_isEnabled:!1,isActive:!1,_useEndPoint:!1,_lrsConfig:{}};e.exports=(e=s,t)=>{if(t.type===o){const a=t.payload.config._xapi;return a&&a._isEnabled?i({},e,a):s}if(!e._isEnabled)return s;switch(t.type){case r:return n({},e,t.payload);default:return e}}},2356:function(e,t,a){"use strict";(function(e){var i=a(5);const n=a(8),{setAppReadyState:o,setLearner:r,DATA_READY:s}=a(9),{TRACKABLE_CHANGE:c}=a(96),{COMPONENT_COMPLETED:p}=a(61),{setTracking:l,getTrackingImmediately:d}=a(487),{xapiLoadWrapper:b,xapiSetActive:A,xapiLoadState:_,xapiTrackableChange:u,XAPI_LOAD_WRAPPER:g,XAPI_LOAD_STATE:E,XAPI_TRACKABLE_CHANGE:f}=a(1618),v=a(2357);let T,m,x=(new Date).getTime();function C(e,t){T.getState(e,{callback:(e,a)=>{t(e,a)}})}function S(e,t,a){T.setState(e,t,{contentType:"application/json",overwriteJSON:!0,callback:(e,t)=>{a(e,t)}})}function O(t,a){const{course:i,components:n}=a,o=n[t],r=o.displayTitle||o.title,s=e(`<div>${r}</div>`).text();let c=v.interacted;return o._isQuestionType&&(c=v.answered),{object:{id:`http://evolve/${i._id}/${o._id}`,definition:{name:{"en-US":s}}},verb:c}}function P(t,a){const{course:i}=t,n=a._status;if("incomplete"===n)return null;const o=e(`<div>${i.title}</div>`).text(),r={completion:!0,duration:m((new Date).getTime()-x)};return"passed"!==n&&"failed"!==n||(r.success="passed"===n),r.score={raw:a._score,min:0,max:100},{object:{id:"http://evolve/"+i._id,definition:{name:{"en-US":o}}},verb:v.completed,result:r}}t.xapiSetupEpic=(e,t)=>e.filter(e=>{if(e.type!==s)return!1;const{_xapi:a}=t.getState();return a&&a._isEnabled}).mergeMap(()=>i.Observable.concat(i.Observable.of(o("xapi",!1)),i.Observable.of(b()))),t.xapiLoadWrapperEpic=(t,a)=>t.filter(({type:e})=>{if(e!==g)return!1;const{_xapi:t}=a.getState();return t&&t._isEnabled}).mergeMap(()=>{const{app:t,course:o,_xapi:s}=a.getState(),c=t.isLivePreview?"../../../public/player/":"";return i.Observable.bindCallback(e.getScript)(c+"libraries/tincan.js").mergeMap(()=>{const t=e(`<div>${o.title}</div>`).text(),a=[];if(s._useEndPoint){const{endpoint:e,key:t,secret:i}=s._lrsConfig;e&&t&&i&&a.push({endpoint:e,auth:"Basic "+window.TinCan.Utils.getBase64String(`${t}:${i}`)})}const c={activity:{id:"http://evolve/"+o._id,definition:{name:{"en-US":t}}},url:window.location.href.replace(window.location.hash,""),recordStores:a};T=new window.TinCan(c),m=window.TinCan.Utils.convertMillisecondsToISO8601Duration;const p=n(T,"actor.name");let l={};if(p){const e=p.split(" ");e.length&&(l={_id:p,firstName:e[0],lastName:e[1]})}const d={object:{id:"http://evolve/"+o._id,definition:{name:{"en-US":t}}},verb:{id:"http://adlnet.gov/expapi/verbs/initialized",display:{"en-US":"initialized"}}};return i.Observable.bindCallback(T.sendStatement.bind(T))(d).mergeMap(()=>i.Observable.concat(i.Observable.of(A({isActive:!0})),i.Observable.of(_()),i.Observable.of(r(l))))})}).catch(e=>(console.log("xAPI wrapper failed to load",e),i.Observable.concat(i.Observable.of(A({isActive:!1})),i.Observable.of(o("xapi",!0))))),t.xapiLoadStateEpic=(e,t)=>e.filter(e=>{if(e.type!==E)return!1;const{_xapi:a}=t.getState();return a&&a._isEnabled&&a.isActive}).mergeMap(()=>i.Observable.bindCallback(C)("TRACKING_DATA").mergeMap(([e,t])=>{if(e||!t||!t.contents)return console.log("xapi state not found"),i.Observable.of({tracking:null});if("string"==typeof t.contents)try{t.contents=JSON.parse(t.contents)}catch(e){return console.log("Error parsing XAPI state.contents: ",t.contents),i.Observable.of({tracking:null})}return x=new Date(t.contents._createdAt).getTime(),i.Observable.of({tracking:t.contents})})).mergeMap(e=>(e.tracking&&l(e.tracking,!0),i.Observable.of(o("xapi",!0)))),t.xapiComponentCompleteEpic=(e,t)=>e.filter(e=>{if(e.type!==p)return!1;const{_xapi:a}=t.getState();return a&&a._isEnabled&&a.isActive}).mergeMap(e=>{const a=t.getState(),n=[O(e.payload.componentId,a)];return console.log("xAPI: component statement",n),i.Observable.bindCallback(T.sendStatements.bind(T))(n)}).ignoreElements().catch(e=>(console.log("xAPI tracking failed",e),i.Observable.of({type:"XAPI_ERROR",payload:e}))),t.xapiTrackableChangeEpic=(e,t)=>e.ofType(c,p).filter(()=>{const{_xapi:e}=t.getState();return e&&e._isEnabled&&e.isActive}).map(()=>u(d())),t.xapiTrackingChangedEpic=e=>e.ofType(f).mergeMap(e=>(console.log("xAPI: tracking changed"),i.Observable.bindCallback(S)("TRACKING_DATA",e.payload))).ignoreElements().catch(e=>(console.log("xAPI tracking failed",e),i.Observable.of({type:"XAPI_ERROR",payload:e}))),t.xapiCourseStatusChangedEpic=(e,t)=>e.ofType(f).map(({payload:e})=>({_status:e._status,_score:e._score})).distinctUntilChanged((e,t)=>e._status===t._status).filter(e=>"incomplete"!==e._status).mergeMap(e=>{const a=[P(t.getState(),e)];return console.log("xAPI: course status changed",a),i.Observable.bindCallback(T.sendStatements.bind(T))(a)}).ignoreElements().catch(e=>(console.log("xAPI tracking failed",e),i.Observable.of({type:"XAPI_ERROR",payload:e})))}).call(this,a(29))},2357:function(e,t,a){"use strict";e.exports={experienced:"experienced",attended:"attended",attempted:"attempted",completed:"completed",passed:"passed",failed:"failed",answered:"answered",interacted:"interacted",imported:"imported",created:"created",shared:"shared",voided:"voided"}}}]);