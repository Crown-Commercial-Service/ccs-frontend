(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{1337:function(e,t,r){"use strict";const{registerEpics:a,registerReducer:n}=r(4),c=r(2346),{trackerSetupEpic:i,trackerLoadDataEpic:o,trackerLoadTrackingEpic:s,trackerTrackEpic:p,trackerTrackDevEpic:l}=r(2347);n("tracker",c),a(i,o,s,p,l)},2346:function(e,t,r){"use strict";const a=r(10),{FETCH_COURSE_DATA:n}=r(9),{SET_TRACKER_AUTH:c}=r(484),i={_isEnabled:!1,_auth:{}};e.exports=(e=i,t)=>t.type===n&&t.payload.config._tracker&&t.payload.config._tracker._isEnabled?a({},e,{_isEnabled:!0}):e._isEnabled?t.type===c?a({},e,t.payload):e:i},2347:function(e,t,r){"use strict";(function(e){const{Observable:a}=r(5),n=r(8),c=r(0),{ajax:i}=r(227),o=r(4),s=r(2),{addElement:p}=r(42),{adjustNavigationHeight:l}=r(327),{COMPONENT_COMPLETED:u,COMPONENT_TRACKABLE_CHANGE:_}=r(61),{TRACKABLE_CHANGE:d}=r(96),{WINDOW_UNLOAD:g}=r(123),{DATA_READY:k,APP_STARTED:f,setAppReadyState:E,setLearner:m}=r(9),{setTracking:T,getTracking:w,getTrackingImmediately:y}=r(487),{trackerLoadData:S,trackerSaveSession:A,setTrackerAuth:b,saveTrackingDone:v,TRACKER_LOAD_DATA:C,TRACKER_SAVE_SESSION:h,SET_TRACKER_AUTH:D}=r(484);let R=null;t.trackerSetupEpic=(e,t)=>e.filter(e=>{if(e.type!==k)return!1;const{app:r,config:a}=t.getState(),n=a._tracker;return!r.isLivePreview&&n&&n._isEnabled}).take(1).mergeMap(()=>a.of(E("tracker",!1),S())).catch(e=>(console.warn("Tracker extension error: ",e),E("tracker",!0))),t.trackerLoadDataEpic=(t,r)=>t.ofType(C).mergeMap(()=>{const{config:t}=r.getState(),u=t._tracker;switch(u._platform){case"exceed":return function(e,t){const{inline:r}=t.getState(),c=function(e,t){if(t){return n(window,"evolve.courseId")}e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const r=new RegExp(`[\\?&]${e}=([^&#]*)`).exec(window.location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}("_courseId",r.isEnabled);c||window.location.replace("/404");return a.forkJoin(i.getJSON(`${e._auth}?course_id=${c}`),i.getJSON("/monitor/heartbeat")).mergeMap(([e,t])=>{if(e.authenticated){const r=1e3*t,n=(new Date).getTime();window.TIME_DIFFERENCE=n-r;const{user_id:c,first_name:i,last_name:o}=e;return a.of(m({_id:c,firstName:i,lastName:o,userData:e}),b(e))}return a.of(b({authenticated:!1}))}).catch(e=>{console.log("error",e)})}(u,r);default:return function(t,r){return a.bindCallback(e.getScript)("../../bloom/bloomAPI.js").mergeMap(()=>{if(window.BLOOM_API)return a.bindCallback(window.BLOOM_API.init)({store:r,actions:{addElement:p,adjustNavigationHeight:l,trackerSaveSession:A},libraries:{React:c,Observable:a,createReactClass:s},player:o})}).mergeMap(()=>i.getJSON(t._auth)).mergeMap(e=>a.of(b(e))).catch(e=>{console.log("error",e)})}(u,r)}}),t.trackerTrackEpic=(e,t)=>e.filter(e=>{const{app:r,config:a}=t.getState();if(e.type===u||e.type===_||e.type===f||e.type===g||e.type===h||e.type===d){const e=a._tracker;return!r.isLivePreview&&e&&e._isEnabled}return!1}).mergeMap(e=>{if(e.type===g||e.type===h){const e=y();return a.of(e)}return a.bindCallback(w)()}).mergeMap(e=>function(e,t){const{config:r,tracker:c}=t.getState();switch(r._tracker._platform){case"exceed":return function(e,t,r){if(r){const r=`${t._pushData}/${R}`;return i.put(r,e,{"Content-Type":"application/json"}).catch(()=>{window.location.reload()})}return a.empty()}(e,r._tracker,c.authenticated);default:return function(e,t){const r=e._user,a=e._course,c=`${t._pushData}/${r}/${a}`;return i.put(c,e,{"Content-Type":"application/json"}).catch(e=>{n(e,"response._isLoginRequired",!1)&&window.location.reload()})}(e,r._tracker)}}(e,t)).mergeMap(()=>a.of(v())),t.trackerTrackDevEpic=(e,t)=>e.filter(e=>{const{app:r,tracking:a}=t.getState();return(e.type===u||e.type===_||e.type===f||e.type===g||e.type===h||e.type===d)&&(r.isLivePreview&&a._isTrackingDevLogEnabled)}).mergeMap(e=>(console.log("TRACKER - action type:"+e.type,y()),a.empty())),t.trackerLoadTrackingEpic=(t,r)=>t.ofType(D).mergeMap(()=>{const{config:t}=r.getState();switch(t._tracker._platform){case"exceed":return function(t){const{config:r,tracker:n}=t.getState();if(n.authenticated&&n.enrollment_course_activity_id&&n.user_id){R=n.enrollment_course_activity_id;const u=`/evolve/api/v1/enrollment_course_activities/${R}/decorator.js`;return a.bindCallback(e.getScript)(u).mergeMap(()=>{if(window.EXCEED_API)return a.bindCallback(window.EXCEED_API.init)({store:t,actions:{addElement:p,adjustNavigationHeight:l,trackerSaveSession:A},libraries:{React:c,Observable:a,createReactClass:s},player:o})}).mergeMap(()=>{const e=`${r._tracker._getData}/${R}`;return i.getJSON(e)}).mergeMap(e=>(T(e,!0),a.of(E("tracker",!0))))}return a.of(E("tracker",!0))}(r);default:return function(e){const{config:t,tracker:r}=e.getState(),n=t._courseId,c=`${t._tracker._getData}/${r._user._id}/${n}`;return i.getJSON(c).mergeMap(e=>{T(e,!0);const{_id:t,firstName:n,lastName:c}=r._user;return a.of(E("tracker",!0),m({_id:t,firstName:n,lastName:c}))})}(r)}})}).call(this,r(29))}}]);