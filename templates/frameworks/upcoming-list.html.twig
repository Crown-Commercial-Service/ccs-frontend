{% extends 'base.html.twig' %}

{% block title %}Upcoming agreements - CCS{% endblock %}

{% block header %}
    {% embed '/includes/header.html.twig' %}
        {% block bannerarea %}
        {% endblock %}
    {% endembed %}
{% endblock %}

{% block body %}


    <!-- required wrapper 1 -->
    <div class="govuk-width-container">

        <!-- If your design requires them, you should place components such as breadcrumbs, back link and phase banner inside this wrapper so that they sit directly underneath the header. -->

        <div class="govuk-phase-banner">
            {% include '/includes/phase-banner-content.html.twig' %}
        </div>


        <div class="govuk-breadcrumbs">
            <ol class="govuk-breadcrumbs__list">
                <li class="govuk-breadcrumbs__list-item">
                    <a class="govuk-breadcrumbs__link" href="/">Home</a>
                </li>
                {% if upcoming_deals_content and upcoming_deals_content.upcomingDealsInfo.title %}

                    <li class="govuk-breadcrumbs__list-item" aria-current="page">
                        {{upcoming_deals_content.upcomingDealsInfo.title}}
                    </li>

                {% else %}
                    <li class="govuk-breadcrumbs__list-item" aria-current="page">
                        Upcoming agreements
                    </li>
                {% endif %}
            </ol>
        </div>





        <!-- required wrapper 2 -->
        <main id="main-content" role="main"  class="govuk-main-wrapper">
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-full">
                    {% if upcoming_deals_content and upcoming_deals_content.upcomingDealsInfo.title and upcoming_deals_content.upcomingDealsInfo.page_description  %}

                        <h1 class="govuk-heading-xl page-title">{{upcoming_deals_content.upcomingDealsInfo.title}}</h1>

                        {# raw html #}
                        {{upcoming_deals_content.upcomingDealsInfo.page_description | raw }}

                    {% else %}

                        <h1 class="govuk-heading-xl page-title">Upcoming agreements</h1>

                        <p class="govuk-body-l govuk-!-width-three-quarters">If you would like to find out more about the scope of any of these procurements please
                            <a href="/contact">contact us</a>.</p>

                    {% endif %}
                </div>
            </div>
            <br />

            <div class="govuk-grid-row">
                <div class="govuk-grid-column-one-third">
                    <div class="govuk-accordion ccs-accordion ccs-accordion--clean" data-module="govuk-accordion" id="accordion-with-summary-sections">
                        <div class="govuk-accordion__controls">
                            <button type="button" class="govuk-accordion__show-all" aria-expanded="true">
                            <span class="govuk-accordion-nav__chevron"></span>
                            <span class="govuk-accordion__show-all-text">Hide all sections</span>
                            </button>
                        </div>
                        <div class="govuk-accordion__section ccs-accordion__section--clean govuk-form-group govuk-form-group--enclosure ccs-form-group--enclosure--tight govuk-accordion__section--expanded">
                            <div class="govuk-accordion__section-header">
                            <h2 class="govuk-accordion__section-heading">
                                <button type="button" aria-controls="accordion-with-summary-sections-content-1" class="no-top-line govuk-accordion__section-button ccs-accordion__section-button" aria-expanded="true" aria-label="Filter by agreement status , Hide this section">
                                <span class="govuk-accordion__section-heading-text" id="accordion-with-summary-sections-heading-3">
                                    <span class="govuk-accordion__section-heading-text-focus"> Filter by agreement status </span>
                                </span>
                                <span class="govuk-visually-hidden govuk-accordion__section-heading-divider"> </span>
                                </button>
                            </h2>
                            <span class="govuk-body-s"><span class="upcoming-num-selected">1</span> selected</span>
                            </div>
                            <div id="accordion-with-summary-sections-content-3" class="govuk-accordion__section-content" aria-labelledby="accordion-with-summary-sections-heading-3">
                            <div class="govuk-checkboxes__item govuk-checkboxes__item--small">
                                <input onchange="toggleAll()" class="govuk-checkboxes__input govuk-checkboxes__input--small view-all-checkbox" id="all" name="statuses[]" type="checkbox" value="all" checked>
                                <label class="govuk-label govuk-checkboxes__label" for="all"> View All </label>
                            </div>
                            <div class="govuk-checkboxes__item govuk-checkboxes__item--small">
                                <input onchange="toggleAgreements()" class="govuk-checkboxes__input govuk-checkboxes__input--small upcoming-agreement-filter" id="future-pipeline" name="statuses[]" type="checkbox" value="future">
                                <label class="govuk-label govuk-checkboxes__label" for="future-pipeline"> Future pipeline </label>
                            </div>
                            <div class="govuk-checkboxes__item govuk-checkboxes__item--small">
                                <input onchange="toggleAgreements()" class="govuk-checkboxes__input govuk-checkboxes__input--small upcoming-agreement-filter" id="planned-procurement" name="statuses[]" type="checkbox" value="planned">
                                <label class="govuk-label govuk-checkboxes__label" for="planned-procurement"> Planned procurements </label>
                            </div>
                            <div class="govuk-checkboxes__item govuk-checkboxes__item--small">
                                <input onchange="toggleAgreements()" class="govuk-checkboxes__input govuk-checkboxes__input--small upcoming-agreement-filter" id="procurement-progress" name="statuses[]" type="checkbox" value="proc">
                                <label class="govuk-label govuk-checkboxes__label" for="procurement-progress"> Procurements in progress </label>
                            </div>
                            <div class="govuk-checkboxes__item govuk-checkboxes__item--small">
                                <input onchange="toggleAgreements()" class="govuk-checkboxes__input govuk-checkboxes__input--small upcoming-agreement-filter" id="recently-awarded" name="statuses[]" type="checkbox" value="awarded">
                                <label class="govuk-label govuk-checkboxes__label" for="recently-awarded"> Recently awarded </label>
                            </div>
                            <div class="govuk-checkboxes__item govuk-checkboxes__item--small">
                                <input onchange="toggleAgreements()" class="govuk-checkboxes__input govuk-checkboxes__input--small upcoming-agreement-filter" id="dps" name="statuses[]" type="checkbox" value="dps">
                                <label class="govuk-label govuk-checkboxes__label" for="dps"> Dynamic purchase system </label>
                            </div>
                            </div>
                        </div>
                    </div>

                    {% include '/frameworks/_helpful_info.html.twig' with {'page': 'upcoming'} %}

                </div>
                
                <div class="govuk-grid-column-two-thirds">

                     <div class="future upcoming-type-wrapper">
                        {% if upcoming_deals_content and upcoming_deals_content.table_4.title %}

                            <h2 class="govuk-heading-l govuk-!-margin-bottom-2 govuk-!-font-size-24 govuk-!-font-weight-bold">{{ upcoming_deals_content.table_4.title }}</h2>

                        {% else %}

                            <h2 class="govuk-heading-l govuk-!-margin-bottom-2 govuk-!-font-size-24 govuk-!-font-weight-bold">Future pipeline</h2>

                        {% endif %}

                        {% if future_pipeline|length >= 1 %}

                                {% if upcoming_deals_content and upcoming_deals_content.table_4.caption|length > 0 %}

                                    <p class="govuk-!-font-size-19 govuk-!-font-weight-regular">{{ upcoming_deals_content.table_4.caption }}</p>

                                {% endif %}
                                <ul class="govuk-list govuk-list--frameworks govuk-list-upcoming">

                                    {% for upcoming_deal in future_pipeline %}                             
                                            <li>
                                                <p class="govuk-body ccs-heading-link ccs-heading-link--inline govuk-!-margin-bottom-2 ccs-font-weight-semibold">
                                                    <a href="{{ path('frameworks_show', {'rmNumber':  upcoming_deal.rm_number }) }}">{{ upcoming_deal.title }}</a>
                                                </p>
                                                
                                                <ul class="list--inline govuk-body-s govuk-!-margin-bottom-2">
                                                    <li> <strong>Agreement ID:</strong> {{ upcoming_deal.rm_number }} </li>

                                                    {% if upcoming_deal.tenders_open_date is not null %}
                                                        <li> <strong>Tenders Open:</strong> {{ upcoming_deal.tenders_open_date.format('d/m/Y') }} </li>
                                                    {% endif %}

                                                    {% if upcoming_deal.expected_live_date is not null %}
                                                       <li> <strong>Expected Live:</strong> {{ upcoming_deal.expected_live_date.format('d/m/Y') }} </li>
                                                    {% endif %}
                                                

                                                </ul>
                                                <p class="govuk-body-s">{{ upcoming_deal.upcoming_deal_summary | striptags | raw }}</p>
                                            </li>
                                    {% endfor %}
                                </ul>

                            {% else %}

                                <p>No future pipelines at the moment.</p>

                        {% endif %}
                    </div>

                     <div class="planned-proc upcoming-type-wrapper">
                        {% if upcoming_deals_content and upcoming_deals_content.table_3.title %}

                            <h2 class="govuk-heading-l govuk-!-margin-bottom-2 govuk-!-font-size-24 govuk-!-font-weight-bold">{{ upcoming_deals_content.table_3.title }}</h2>

                        {% else %}

                            <h2 class="govuk-heading-l govuk-!-margin-bottom-2 govuk-!-font-size-24 govuk-!-font-weight-bold">Planned procurements</h2>

                        {% endif %}

                        {% if planned_pipeline|length >= 1 %}

                                {% if upcoming_deals_content and upcoming_deals_content.table_3.caption|length > 0 %}

                                    <p class="govuk-!-font-size-19 govuk-!-font-weight-regular">{{ upcoming_deals_content.table_3.caption }}</p>

                                {% endif %}
                                <ul class="govuk-list govuk-list--frameworks govuk-list-upcoming">

                                    {% for upcoming_deal in planned_pipeline %}

                                    <li>
                                            <p class="govuk-body ccs-heading-link ccs-heading-link--inline govuk-!-margin-bottom-2 ccs-font-weight-semibold">
                                                <a href="{{ path('frameworks_show', {'rmNumber':  upcoming_deal.rm_number }) }}">{{ upcoming_deal.title }}</a>
                                            </p>
                                            
                                            <ul class="list--inline govuk-body-s govuk-!-margin-bottom-2">
                                                <li> <strong>Agreement ID:</strong> {{ upcoming_deal.rm_number }} </li>

                                                {% if upcoming_deal.tenders_open_date is not null %}
                                                    <li> <strong>Tenders Open:</strong> {{ upcoming_deal.tenders_open_date.format('d/m/Y') }} </li>
                                                {% endif %}

                                                {% if upcoming_deal.expected_live_date is not null %}
                                                    <li> <strong>End Live:</strong> {{ upcoming_deal.expected_live_date.format('d/m/Y') }} </li>
                                                {% endif %}
                                            </ul>
                                            <p class="govuk-body-s">{{ upcoming_deal.upcoming_deal_summary | striptags | raw }}</p>
                                    </li>

                                    {% endfor %}
                                </ul>

                            {% else %}

                                <p>No planned procurements at the moment.</p>

                        {% endif %}
                    </div>

                    <div class="proc-in-progress upcoming-type-wrapper">
                        {% if upcoming_deals_content and upcoming_deals_content.table_1.title %}

                            <h2 class="govuk-heading-l govuk-!-margin-bottom-2 govuk-!-font-size-24 govuk-!-font-weight-bold">{{ upcoming_deals_content.table_1.title }}</h2>

                        {% else %}

                            <h2 class="govuk-heading-l govuk-!-margin-bottom-2 govuk-!-font-size-24 govuk-!-font-weight-bold">Procurements in progress</h2>

                        {% endif %}

                        {% if underway_pipeline|length >= 1 %}


                                {% if upcoming_deals_content and upcoming_deals_content.table_1.caption %}

                                    <p class="govuk-!-font-size-19 govuk-!-font-weight-regular">{{ upcoming_deals_content.table_1.caption }}</p>

                                {% else %}

                                    <p class="govuk-!-font-size-19 govuk-!-font-weight-regular">The links provided in the agreement section below give further information about the procurement, including the OJEU notice and details on how to tender for interested suppliers.
                                    </p>

                                {% endif %}

                            <ul class="govuk-list govuk-list--frameworks govuk-list-upcoming">
                                {% for upcoming_deal in underway_pipeline %}

                                    <li>
                                        <p class="govuk-body ccs-heading-link ccs-heading-link--inline govuk-!-margin-bottom-2 ccs-font-weight-semibold">
                                            <a href="{{ path('frameworks_show', {'rmNumber':  upcoming_deal.rm_number }) }}">{{ upcoming_deal.title }}</a>
                                        </p>
                                        
                                        <ul class="list--inline govuk-body-s govuk-!-margin-bottom-2">
                                            <li> <strong>Agreement ID:</strong> {{ upcoming_deal.rm_number }} </li>

                                            {% if upcoming_deal.tenders_close_date is not null %}
                                                <li> <strong>Tenders Close:</strong> {{ upcoming_deal.tenders_close_date.format('d/m/Y') }} </li>
                                            {% endif %}

                                            {% if upcoming_deal.expected_award_date is not null %}
                                                <li> <strong>Expected Award:</strong> {{ upcoming_deal.expected_award_date.format('d/m/Y') }} </li>
                                            {% endif %}
                                        </ul>
                                        <p class="govuk-body-s">{{ upcoming_deal.upcoming_deal_summary | striptags | raw }}</p>
                                    </li>

                                {% endfor %}
                            </ul>
                        {% else %}

                            <p>No procurements in progress at the moment.</p>

                        {% endif %}
                    </div>

                    <div class="proc-recent-awarded upcoming-type-wrapper">
                        {% if upcoming_deals_content and upcoming_deals_content.table_0.title %}

                            <h2 class="govuk-heading-l govuk-!-margin-bottom-2 govuk-!-font-size-24 govuk-!-font-weight-bold">{{ upcoming_deals_content.table_0.title }}</h2>

                        {% else %}

                            <h2 class="govuk-heading-l govuk-!-margin-bottom-2 govuk-!-font-size-24 govuk-!-font-weight-bold">Procurements recently awarded</h2>

                        {% endif %}
                        
                        {% if awarded_pipeline|length >= 1 %}

                                {% if upcoming_deals_content and upcoming_deals_content.table_0.caption|length > 0 %}

                                    <p class="govuk-!-font-size-19 govuk-!-font-weight-regular">{{ upcoming_deals_content.table_0.caption }}</p>

                                {% endif %}
                                <ul class="govuk-list govuk-list--frameworks govuk-list-upcoming">
                                    {% for upcoming_deal in awarded_pipeline %}
                                        <li>
                                            <p class="govuk-body ccs-heading-link ccs-heading-link--inline govuk-!-margin-bottom-2 ccs-font-weight-semibold">
                                                <a href="{{ path('frameworks_show', {'rmNumber':  upcoming_deal.rm_number }) }}">{{ upcoming_deal.title }}</a>
                                            </p>
                                            
                                            <ul class="list--inline govuk-body-s govuk-!-margin-bottom-2">
                                                <li> <strong>Agreement ID:</strong> {{ upcoming_deal.rm_number }} </li>

                                                {% if upcoming_deal.expected_award_date is not null %}
                                                    <li> <strong>Awarded Date:</strong> {{ upcoming_deal.expected_award_date.format('d/m/Y') }} </li>
                                                {% endif %}

                                                {% if upcoming_deal.expected_live_date is not null %}
                                                    <li> <strong>Expected Live:</strong> {{ upcoming_deal.expected_live_date.format('d/m/Y') }} </li>
                                                {% endif %}
                                            </ul>
                                            <p class="govuk-body-s">{{ upcoming_deal.upcoming_deal_summary | striptags | raw }}</p>
                                        </li>
                                    {% endfor %}
                                </ul>

                        {% else %}

                            <p>No procurements recently awarded at the moment.</p>

                        {% endif %}
                    </div>

                    <div class="dps upcoming-type-wrapper">
                        {% if upcoming_deals_content and upcoming_deals_content.table_2.title %}

                            <h2 class="govuk-heading-l govuk-!-margin-bottom-2 govuk-!-font-size-24 govuk-!-font-weight-bold">{{ upcoming_deals_content.table_2.title }}</h2>

                        {% else %}

                            <h2 class="govuk-heading-l govuk-!-margin-bottom-2 govuk-!-font-size-24 govuk-!-font-weight-bold">Dynamic Purchasing Systems currently open</h2>

                        {% endif %}

                        {% if dynamic_purchasing_systems|length >= 1 %}

                                {% if upcoming_deals_content and upcoming_deals_content.table_2.caption|length > 0 %}

                                    <p class="govuk-!-font-size-19 govuk-!-font-weight-regular">{{ upcoming_deals_content.table_2.caption }}</p>

                                {% endif %}

                                <ul class="govuk-list govuk-list--frameworks govuk-list-upcoming">
                                    {% for upcoming_deal in dynamic_purchasing_systems %}

                                         <li>
                                            <p class="govuk-body ccs-heading-link ccs-heading-link--inline govuk-!-margin-bottom-2 ccs-font-weight-semibold">
                                                <a href="{{ path('frameworks_show', {'rmNumber':  upcoming_deal.rm_number }) }}">{{ upcoming_deal.title }}</a>
                                            </p>
                                            
                                            <ul class="list--inline govuk-body-s govuk-!-margin-bottom-2">
                                                <li> <strong>Agreement ID:</strong> {{ upcoming_deal.rm_number }} </li>

                                                {% if upcoming_deal.expected_live_date is not null %}
                                                    <li> <strong>Live Date:</strong> {{ upcoming_deal.expected_live_date.format('d/m/Y') }} </li>
                                                {% endif %}

                                                {% if upcoming_deal.end_date is not null %}
                                                    <li> <strong>End Date:</strong> {{ upcoming_deal.end_date.format('d/m/Y') }} </li>
                                                {% endif %}
                                            </ul>
                                            <p class="govuk-body-s">{{ upcoming_deal.upcoming_deal_summary | striptags | raw }}</p>
                                        </li>

                                    {% endfor %}
                                </ul>

                        {% else %}

                            <p>No Dynamic Purchasing Systems currently open at the moment.</p>

                        {% endif %}
                    </div>

                </div>

            </div>

        </main>
    </div>

<script>
pushToDataLayer({'event': 'page_view', 'page_referrer': window.location.href});

// filter upcoming agreement
    var numSelectedElem = document.querySelector(".upcoming-num-selected");
    var viewAll = document.querySelector(".view-all-checkbox");
    var filterCheckboxes = document.getElementsByClassName("upcoming-agreement-filter");
    
    var upcomingAgreements = {
        "future" :  document.querySelector(".future"),
        "planned" : document.querySelector(".planned-proc"),
        "proc" : document.querySelector(".proc-in-progress"),
        "awarded": document.querySelector(".proc-recent-awarded"),
        "dps" : document.querySelector(".dps")
    }

    
    function toggleAgreements() {
        var numSelected = 0;

        for(var checkbox of filterCheckboxes) {
            if (checkbox.checked) {
                numSelected++;
                viewAll.checked = false;
                toggleAgreement(upcomingAgreements[checkbox.value], true);
                
            } else {
                toggleAgreement(upcomingAgreements[checkbox.value], false);
            }
            
        }

        if (numSelected == 5 || numSelected == 0) {
            resetFilterUpcoming();
            toggleAll();
            numSelected = 1;
        } 

        numSelectedElem.innerHTML = numSelected;
    }

    function toggleAll() {
        if (viewAll.checked) {
             for(var checkbox of filterCheckboxes) {
                checkbox.checked = false;
             }

            Object.keys(upcomingAgreements).forEach(function(agreement) {
                upcomingAgreements[agreement].style.display = "block";
            });

            numSelectedElem.innerHTML = 1;
        } else {
            Object.keys(upcomingAgreements).forEach(function(agreement) {
                upcomingAgreements[agreement].style.display = "none";
            });
        }
        
    }

    function toggleAgreement (agreement, agreementDisplay) {
        if (agreementDisplay) {
            agreement.style.display = "block";
        } else {
            agreement.style.display = "none";
        }
    }

    function resetFilterUpcoming () {
         for(var checkbox of filterCheckboxes) {
            if (checkbox.checked) {
                checkbox.checked = false;
            }  
        }

        viewAll.checked = true;
    }

</script>
{% endblock %}
