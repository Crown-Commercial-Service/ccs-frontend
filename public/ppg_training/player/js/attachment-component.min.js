(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{1245:function(e,t,n){"use strict";const{registerComponent:i,registerEpics:o}=n(4),{attachmentUploaded:s}=n(1503),r=n(1635);i("attachment",{component:n(1636),actions:{attachmentUploaded:s},reducer:r,mapStateToProps:e=>({buttons:e.course._buttons,isLivePreview:e.app.isLivePreview||e.course._isShareable}),trackingMap:n(1658)})},1370:function(e,t,n){"use strict";const i=n(7);e.exports=function(e){return i(`ev-${e._component}-widget ev-component-widget ev-clearfix`,{"ev-disabled":!e._isEnabled,"ev-complete ev-show-user-answer":e._isComplete&&!e._isEnabled,"ev-correct":e._isCorrect&&!e._isEnabled,"ev-submitted":e._isSubmitted})}},1503:function(e,t,n){"use strict";t.ATTACHMENT_UPLOADED="ATTACHMENT_UPLOADED",t.attachmentUploaded=(e,n)=>({type:t.ATTACHMENT_UPLOADED,payload:{componentId:e,attachment:n}})},1635:function(e,t,n){"use strict";const i=n(10),{ATTACHMENT_UPLOADED:o}=n(1503);e.exports=(e,t)=>t.type===o?i({},e,{_attachment:t.payload.attachment}):e},1636:function(e,t,n){"use strict";const i=n(2),o=n(1),s=n(0),r=n(1637),{Component:a}=n(468),c=n(1370),l=n(24),p=n(1656),u=n(1657),d=r.CancelToken,m=i({displayName:"Attachment",propTypes:{component:o.object.isRequired,setComponentAsReady:o.func.isRequired,setComponentAsComplete:o.func.isRequired,setComponentAsViewed:o.func.isRequired,setComponentAsStarted:o.func.isRequired,buttons:o.object.isRequired,isLivePreview:o.bool.isRequired,attachmentUploaded:o.func.isRequired},getInitialState:function(){return this.getDefaultState()},componentDidMount:function(){const{props:e}=this;this._isMounted=!0,e.setComponentAsReady(e.component._id)},componentWillUnmount:function(){this._isMounted=!1,this._cancelToken&&this._cancelToken.cancel()},getDefaultState:function(){return{_fileSelected:null,_isUploading:!1,_progress:0}},uploadFile:function(){const{props:e,state:t}=this,n=t._fileSelected,i=new FormData;i.append("files[]",n,n.name),this._cancelToken=d.source(),this.setState({_isUploading:!0}),r.post("../../api/assets",i,{onUploadProgress:this.onUploadProgress,cancelToken:this._cancelToken.token}).then(this.onUploadComplete).catch(this.onUploadError)},resetState:function(){this._cancelToken=void 0,this.setState(this.getDefaultState())},onUploadProgress:function(e){const t=Math.round(100*e.loaded/e.total);this.setState({_progress:t})},onUploadComplete:function({data:e}){const{props:t}=this;this.resetState(),t.attachmentUploaded(t.component._id,e._url),t.setComponentAsComplete(t.component._id)},onUploadError:function(e){r.isCancel(e)||this.showErrorPrompt(),this._isMounted&&this.resetState()},showErrorPrompt:function(){this.props.showPrompt({title:"Error Uploading Attachment",body:"The file could not be uploaded"})},onFileInputChanged:function(e){const{props:t}=this;t.component._hasStarted||t.setComponentAsStarted(t.component._id),this.setState({_fileSelected:e})},onCancelClicked:function(){this.setState({_fileSelected:null,_isUploading:!1}),this._cancelToken&&this._cancelToken.cancel()},onFileUploadClicked:function(){this.uploadFile()},onVisibilityChange:function(e,{top:t,bottom:n}){const{props:i}=this;t&&(this.isInviewTop=!0),n&&(this.isInviewBottom=!0),this.isInviewTop&&this.isInviewBottom&&i.setComponentAsViewed(i.component._id)},getIsVisibilitySensorActive:function(){const{component:e,isPageReady:t}=this.props;return!0===t&&!0===e._isReady&&!0!==e._hasBeenViewed},renderComponentNotAvailable:function(){const{props:e}=this;if(e.isLivePreview)return s.createElement("div",{className:"ev-attachment-preview-mode"},"This component is only available when taking a course")},renderPreview:function(){const{component:e}=this.props;if(e._attachment)return s.createElement(u,{attachment:e._attachment})},renderAssignmentSubmitted:function(){const{component:e}=this.props;if(e._isComplete)return s.createElement("div",{className:"ev-component-assignment-submitted"},s.createElement("div",{className:"ev-component-assignment-submitted-inner"},s.createElement("i",{className:"ev-component-assignment-submitted-icon ev-icon ev-icon-paper-plane"}),s.createElement(l,{className:"ev-component-assignment-submitted-message",html:e._assignment.submittedMessage})))},renderWidget:function(){const{props:e,state:t}=this;if(!e.isLivePreview)return s.createElement("div",null,this.renderPreview(),s.createElement(p,{ariaLabel:e.component.inputAriaLabel,isUploaded:!!e.component._attachment,isUploading:t._isUploading,uploadProgress:t._progress,submitButtonText:e.buttons._submit.buttonText,clearButtonText:e.component.clearButton,removeButtonText:e.component.removeButton,fileSelected:t._fileSelected,onFileInputChange:this.onFileInputChanged,onFileUploadClick:this.onFileUploadClicked,onCancelClick:this.onCancelClicked}),this.renderAssignmentSubmitted())},render:function(){const{props:e}=this;return s.createElement(a,{component:e.component,styles:e.styles,isVisibilitySensorActive:this.getIsVisibilitySensorActive(),onVisibilityChange:this.onVisibilityChange},s.createElement("div",{className:c(e.component)},this.renderComponentNotAvailable(),this.renderWidget()))}});e.exports=m},1656:function(e,t,n){"use strict";const i=n(2),o=n(1),s=n(0),r=n(48),a=i({displayName:"AttachmentUploader",propTypes:{ariaLabel:o.string,isUploaded:o.bool.isRequired,isUploading:o.bool.isRequired,uploadProgress:o.number.isRequired,fileSelected:o.object,onFileInputChange:o.func.isRequired,onFileUploadClick:o.func.isRequired,onCancelClick:o.func.isRequired,submitButtonText:o.string.isRequired,clearButtonText:o.string.isRequired,removeButtonText:o.string.isRequired},onFileInputChange:function(){const e=r.findDOMNode(this._input);let t=null;e.files.length>0&&(t=e.files[0]),this.props.onFileInputChange(t)},onFileImportClick:function(e){e.preventDefault(),e.currentTarget.blur(),this.props.onFileUploadClick()},onCancelImportClick:function(e){e.preventDefault(),e.currentTarget.blur(),this.props.onCancelClick()},renderPreviewName:function(){const{fileSelected:e}=this.props;if(e)return s.createElement("div",{className:"ev-attachment-uploader-preview"},s.createElement("div",{className:"ev-attachment-uploader-preview-name"},e.name),s.createElement("button",{className:"ev-button ev-attachment-uploader-preview-clear-button",onClick:this.onCancelImportClick},this.props.clearButtonText))},renderClearButton:function(){if(this.props.fileSelected)return s.createElement("button",{className:"ev-button",onClick:this.onCancelImportClick},this.props.clearButtonText)},renderInput:function(){const{props:e}=this;if(!e.fileSelected&&!e.isUploaded)return s.createElement("input",{className:"ev-input-text","aria-label":e.ariaLabel,ref:e=>this._input=e,type:"file",onChange:this.onFileInputChange})},renderProgressBar:function(){const{props:e}=this;if(e.isUploading)return s.createElement("div",{className:"ev-attachment-uploader-progress"},s.createElement("div",{className:"ev-attachment-uploader-progress-bar",style:{width:e.uploadProgress+"px"}}))},render:function(){const{props:e}=this;return s.createElement("div",{className:"ev-attachment-uploader"},this.renderInput(),this.renderPreviewName(),this.renderProgressBar(),s.createElement("div",{className:"ev-attachment-buttons"},s.createElement("button",{className:"ev-button",disabled:!e.fileSelected||e.isUploaded||e.isUploading,onClick:this.onFileImportClick},this.props.submitButtonText)))}});e.exports=a},1657:function(e,t,n){"use strict";const i=n(2),o=n(0),s=i({displayName:"AttachmentPreview",getAttachmentType:function(){return this.props.attachment.split("/")[1]},getAttachmentUrl:function(){return"../../"+this.props.attachment},renderVideo:function(e){return o.createElement("video",{src:e,controls:!0})},renderImage:function(e){return o.createElement("img",{src:e})},renderAudio:function(e){return o.createElement("audio",{controls:!0},o.createElement("source",{src:e,type:"audio/mpeg"}))},renderFile:function(e){return o.createElement("a",{className:"ev-button ev-primary",href:e,target:"_blank"},"Click to view file")},renderPreview:function(){const e=this.getAttachmentType(),t=this.getAttachmentUrl();switch(e){case"videos":return this.renderVideo(t);case"images":return this.renderImage(t);case"audios":return this.renderAudio(t);case"files":return this.renderFile(t)}},render:function(){return o.createElement("div",{className:"ev-attachment-preview"},this.renderPreview())}});e.exports=s},1658:function(e,t,n){"use strict";e.exports={_interactionType:{type:"String",default:"interaction",shouldRestore:!1},_attachment:{fieldKey:"_attachment",type:"String",shouldRestore:!0},_assignment:{fieldKey:"_assignment",type:"Object",shouldRestore:!0},_assignmentAttempts:{fieldKey:"_assignmentAttempts",type:"Object",shouldRestore:!0}}}}]);